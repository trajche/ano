var Ano=(()=>{var fe=Object.defineProperty;var lt=Object.getOwnPropertyDescriptor;var ct=Object.getOwnPropertyNames;var dt=Object.prototype.hasOwnProperty;var pt=(e,t)=>{for(var n in t)fe(e,n,{get:t[n],enumerable:!0})},ut=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of ct(t))!dt.call(e,o)&&o!==n&&fe(e,o,{get:()=>t[o],enumerable:!(r=lt(t,o))||r.enumerable});return e};var ft=e=>ut(fe({},"__esModule",{value:!0}),e);var Yt={};pt(Yt,{clear:()=>Dt,destroy:()=>Bt,endSession:()=>Ft,export:()=>Ut,getAll:()=>zt,import:()=>jt,importFile:()=>Ht,init:()=>Ot,setMode:()=>Xt,startSession:()=>_t,toJSON:()=>Pt});var gt={theme:"light",mode:"navigate",highlightColor:"#fde047",pinColor:"#3b82f6",drawColor:"#ef4444",drawWidth:3,shortcuts:!0,recordMaxDuration:3e4,recordFrameRate:30,sessionMaxDuration:3e5,videoRecording:!1};function ve(e={}){return{...gt,...e}}function le(){let e=new Map;return{on(t,n){return e.has(t)||e.set(t,new Set),e.get(t).add(n),()=>e.get(t)?.delete(n)},off(t,n){e.get(t)?.delete(n)},emit(t,...n){e.get(t)?.forEach(r=>r(...n))},clear(){e.clear()}}}var ye="abcdefghijklmnopqrstuvwxyz0123456789";function xe(){let e="",t=crypto.getRandomValues(new Uint8Array(8));for(let n=0;n<8;n++)e+=ye[t[n]%ye.length];return e}function we(){let e=new Map,t=le(),n=0;function r(v){let m=v.id||xe(),A={...v,id:m,createdAt:v.createdAt||Date.now()};return A.type==="pin"&&A.index==null&&(n++,A.index=n),e.set(m,A),t.emit("add",A),t.emit("change",{type:"add",annotation:A}),A}function o(v,m){let A=e.get(v);if(!A)return null;let w={...A,...m,id:v};return e.set(v,w),t.emit("update",w),t.emit("change",{type:"update",annotation:w}),w}function a(v){let m=e.get(v);return m?(e.delete(v),t.emit("remove",m),t.emit("change",{type:"remove",annotation:m}),!0):!1}function s(v){return e.get(v)||null}function f(){return Array.from(e.values())}function l(v){return f().filter(m=>m.type===v)}function i(){let v=f();e.clear(),n=0,t.emit("clear",v),t.emit("change",{type:"clear",annotations:v})}function c(){let v=l("pin");n=v.length>0?Math.max(...v.map(m=>m.index)):0}return{add:r,update:o,remove:a,get:s,getAll:f,getByType:l,clear:i,resetPinCounter:c,on:t.on,off:t.off,emit:t.emit,destroy:t.clear}}function ke(e){let t=e.toString();if(!t)return null;let n=document.body,r=n.textContent||"",o=document.createRange();o.setStart(n,0),o.setEnd(e.startContainer,e.startOffset);let a=o.toString(),s=Math.max(0,a.length-32),f=a.slice(s),l=document.createRange();l.setStart(e.endContainer,e.endOffset),l.setEnd(n,n.childNodes.length);let c=l.toString().slice(0,32);return{type:"TextQuoteSelector",exact:t,prefix:f,suffix:c}}function Ce(e){if(!e||!e.exact)return null;let n=document.body.textContent||"",{exact:r,prefix:o,suffix:a}=e,s=[],f=0;for(;;){let c=n.indexOf(r,f);if(c===-1)break;s.push(c),f=c+1}if(s.length===0)return null;let l=s[0],i=-1;for(let c of s){let v=0;if(o){let m=n.slice(Math.max(0,c-o.length),c);m===o?v+=2:m.endsWith(o.slice(-8))&&(v+=1)}if(a){let m=n.slice(c+r.length,c+r.length+a.length);m===a?v+=2:m.startsWith(a.slice(0,8))&&(v+=1)}v>i&&(i=v,l=c)}return ht(l,l+r.length)}function ht(e,t){let n=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT),r=0,o=null,a=0,s=null,f=0;for(;n.nextNode();){let l=n.currentNode,i=l.textContent.length;if(!o&&r+i>e&&(o=l,a=e-r),r+i>=t){s=l,f=t-r;break}r+=i}if(!o||!s)return null;try{let l=document.createRange();return l.setStart(o,a),l.setEnd(s,f),l}catch{return null}}function Se(e){let t=document.body,n=document.createRange();n.setStart(t,0),n.setEnd(e.startContainer,e.startOffset);let r=n.toString().length,o=r+e.toString().length;return{type:"TextPositionSelector",start:r,end:o}}function Te(e){if(!e||e.start==null||e.end==null)return null;let{start:t,end:n}=e,r=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT),o=0,a=null,s=0,f=null,l=0;for(;r.nextNode();){let i=r.currentNode,c=i.textContent.length;if(!a&&o+c>t&&(a=i,s=t-o),o+c>=n){f=i,l=n-o;break}o+=c}if(!a||!f)return null;try{let i=document.createRange();return i.setStart(a,s),i.setEnd(f,l),i}catch{return null}}function Z(e){if(e.id){let o=`#${CSS.escape(e.id)}`;if(Ee(o))return o}let t=[],n=e;for(;n&&n!==document.body&&n!==document.documentElement;){let o=n.tagName.toLowerCase();if(n.id){o=`#${CSS.escape(n.id)}`,t.unshift(o);break}let a=n.parentElement;if(a){let s=Array.from(a.children).filter(f=>f.tagName===n.tagName);if(s.length>1){let f=s.indexOf(n)+1;o+=`:nth-of-type(${f})`}}t.unshift(o),n=a}t[0]&&!t[0].startsWith("#")&&t.unshift("body");let r=t.join(" > ");return Ee(r),r}function Me(e){return{tagName:e.tagName,textContent:(e.textContent||"").trim().slice(0,100),className:e.className||""}}function ge(e,t){try{let n=document.querySelector(e);if(n)return n}catch{}if(t){let n=document.querySelectorAll(t.tagName?.toLowerCase()||"*");for(let r of n)if((r.textContent||"").trim().slice(0,100)===t.textContent)return r}return null}function Ee(e){try{return document.querySelectorAll(e).length===1}catch{return!1}}function Ne(e){if(!e)return null;if(e.textPosition){let t=Te(e.textPosition);if(t&&mt(t,e.textQuote?.exact))return t}if(e.textQuote){let t=Ce(e.textQuote);if(t)return t}return null}function mt(e,t){return t?e.toString()===t:!0}function Ae(e){let{store:t,config:n}=e,r=!1,o=new Map;function a(){r||(r=!0,document.addEventListener("mouseup",f,!0))}function s(){r=!1,document.removeEventListener("mouseup",f,!0)}function f(p){if($e(p.target))return;let x=window.getSelection();if(!x||x.isCollapsed||!x.rangeCount)return;let b=x.getRangeAt(0),C=b.toString().trim();if(!C)return;let $={textQuote:ke(b),textPosition:Se(b)},H=w(b,C),g=l(b);if(g.length===0)return;let y=t.add({type:"highlight",text:C,comment:"",selectors:$,context:H,color:n.highlightColor});o.set(y.id,g),g.forEach(k=>{k.dataset.anoId=y.id}),x.removeAllRanges(),e.events.emit("highlight:created",y)}function l(p){let x=[],b=i(p);if(b.length===0)return x;for(let C=0;C<b.length;C++){let $=b[C],H=0,g=$.textContent.length;if(C===0&&(H=$===p.startContainer?p.startOffset:0),C===b.length-1&&(g=$===p.endContainer?p.endOffset:$.textContent.length),H===g)continue;let y=$;H>0&&(y=$.splitText(H),g-=H),g<y.textContent.length&&y.splitText(g);let k=document.createElement("mark");k.className="ano-highlight",y.parentNode.insertBefore(k,y),k.appendChild(y),x.push(k)}return x}function i(p){let x=[],b=document.createTreeWalker(p.commonAncestorContainer.nodeType===Node.TEXT_NODE?p.commonAncestorContainer.parentNode:p.commonAncestorContainer,NodeFilter.SHOW_TEXT),C=!1;for(;b.nextNode();){let $=b.currentNode;if(($===p.startContainer||p.startContainer.nodeType!==Node.TEXT_NODE&&p.startContainer.contains($))&&(C=!0),C&&!$e($.parentNode)&&x.push($),$===p.endContainer||p.endContainer.nodeType!==Node.TEXT_NODE&&p.endContainer.contains($))break}return x}function c(p){if(o.has(p.id))return!0;let x=Ne(p.selectors);if(!x)return!1;let b=l(x);return b.length===0?!1:(o.set(p.id,b),b.forEach(C=>{C.dataset.anoId=p.id,p.color&&C.style.setProperty("--ano-hl-color",p.color)}),!0)}function v(p){let x=o.get(p);if(x){for(let b of x){let C=b.parentNode;if(C){for(;b.firstChild;)C.insertBefore(b.firstChild,b);C.removeChild(b),C.normalize()}}o.delete(p)}}function m(){for(let p of[...o.keys()])v(p)}function A(p){return o.get(p)||[]}function w(p,x){let b=p.commonAncestorContainer;b.nodeType===Node.TEXT_NODE&&(b=b.parentElement);let C=L(b),$={selector:Z(C),tagName:C.tagName,text:B(P(C),200)},H=[],g=C;for(;g&&g!==document.body;){let j=g.tagName.toLowerCase(),X=g.id?`#${g.id}`:"",h=g.getAttribute("role")||"",T=j+X;h&&(T+=`[role=${h}]`),H.unshift(T),g=g.parentElement}let y=C.textContent||"",k=y.indexOf(x),U="";if(k!==-1){let j=y.slice(Math.max(0,k-80),k).trim(),X=y.slice(k+x.length,k+x.length+80).trim();U=(j?"..."+j+" ":"")+"["+B(x,100)+"]"+(X?" "+X+"...":"")}return{element:$,pagePath:H,surroundingText:U}}function L(p){let x=new Set(["P","H1","H2","H3","H4","H5","H6","LI","TD","TH","BLOCKQUOTE","FIGCAPTION","CAPTION","LABEL","A","BUTTON","ARTICLE","SECTION","NAV","HEADER","FOOTER","MAIN","ASIDE","DETAILS","SUMMARY"]),b=p;for(;b&&b!==document.body;){if(x.has(b.tagName)||b.id||b.getAttribute("role"))return b;b=b.parentElement}return p}function P(p){if(p.children.length===0)return(p.textContent||"").trim();let x="";for(let b of p.childNodes)if(b.nodeType===Node.TEXT_NODE)x+=b.textContent;else if(b.nodeType===Node.ELEMENT_NODE){let C=getComputedStyle(b).display;(C==="inline"||C==="inline-block")&&(x+=b.textContent)}return x.trim()||(p.textContent||"").trim().slice(0,200)}function B(p,x){return p.length>x?p.slice(0,x)+"...":p}function R(){s(),m()}return{enable:a,disable:s,applyHighlight:c,removeHighlight:v,removeAll:m,getMarksForAnnotation:A,destroy:R}}function $e(e){if(!e)return!1;if(e.closest&&e.closest("[data-ano]"))return!0;let t=e;for(;t;){if(t.host&&t.host.dataset&&t.host.dataset.ano!==void 0||t.dataset&&t.dataset.ano!==void 0)return!0;t=t.parentNode}return!1}function Le(e){let{store:t,config:n}=e,r=!1,o=new Map,a=null,s=null;function f(){r||(r=!0,i(),document.addEventListener("mousemove",m,!0))}function l(){r=!1,c(),document.removeEventListener("mousemove",m,!0)}function i(){s=document.createElement("div"),s.className="ano-pin-overlay active",s.dataset.ano="",s.addEventListener("click",A,!0),s.addEventListener("mousemove",v),document.body.appendChild(s),a=document.createElement("div"),a.className="ano-pin-hover-outline",a.dataset.ano="",document.body.appendChild(a)}function c(){s&&(s.removeEventListener("click",A,!0),s.removeEventListener("mousemove",v),s.remove(),s=null),a&&(a.remove(),a=null)}function v(g){s.style.pointerEvents="none";let y=document.elementFromPoint(g.clientX,g.clientY);if(s.style.pointerEvents="auto",y&&y!==document.body&&y!==document.documentElement&&!Re(y)){let k=y.getBoundingClientRect();a.style.display="block",a.style.left=`${k.left+window.scrollX}px`,a.style.top=`${k.top+window.scrollY}px`,a.style.width=`${k.width}px`,a.style.height=`${k.height}px`}else a.style.display="none"}function m(){}function A(g){g.preventDefault(),g.stopPropagation(),s.style.pointerEvents="none";let y=document.elementFromPoint(g.clientX,g.clientY);if(s.style.pointerEvents="auto",!y||y===document.body||y===document.documentElement||Re(y))return;let k=Z(y),U=Me(y),j=b(y),X=t.add({type:"pin",comment:"",targetSelector:k,targetMeta:U,context:j});w(X,y),e.events.emit("pin:created",X)}function w(g,y){let k=document.createElement("div");k.className="ano-pin-marker",k.dataset.ano="",k.dataset.anoId=g.id,k.textContent=g.index,k.style.setProperty("--ano-pin-color",n.pinColor),document.body.appendChild(k),L(k,y),o.set(g.id,{marker:k,target:y}),k.addEventListener("click",U=>{U.stopPropagation(),e.events.emit("pin:click",g)})}function L(g,y){let k=y.getBoundingClientRect();g.style.left=`${k.left+window.scrollX-12}px`,g.style.top=`${k.top+window.scrollY-12}px`}function P(){for(let[g,{marker:y,target:k}]of o)document.body.contains(k)&&L(y,k)}function B(g){if(o.has(g.id))return!0;let y=ge(g.targetSelector,g.targetMeta);return y?(w(g,y),!0):!1}function R(g){let y=o.get(g);y&&(y.marker.remove(),o.delete(g))}function p(){for(let[g]of[...o])R(g)}function x(g){let y=o.get(g);y&&y.target.scrollIntoView({behavior:"smooth",block:"center"})}function b(g){let y=g.tagName.toLowerCase(),k={},U=["href","src","action","type","name","placeholder","value","alt","title","role","aria-label","aria-describedby","data-testid","for","method"];for(let M of U){let z=g.getAttribute(M);z&&(k[M]=z.length>120?z.slice(0,120)+"...":z)}let j=C(g),X=[],h=g;for(;h&&h!==document.body;){let M=h.tagName.toLowerCase();if(h.id)M+=`#${h.id}`;else if(h.className&&typeof h.className=="string"){let z=h.className.trim().split(/\s+/).slice(0,2).join(".");z&&(M+=`.${z}`)}h.getAttribute("role")&&(M+=`[role=${h.getAttribute("role")}]`),X.unshift(M),h=h.parentElement}let T=[],D=g.parentElement;if(D)for(let M of D.children){if(M===g)continue;let z=M.tagName.toLowerCase(),_=$((M.textContent||"").trim(),60);if(_&&T.push(`${z}("${_}")`),T.length>=4)break}let E=`${y}`;j&&(E+=`("${$(j,80)}")`),k.type&&(E+=`[type=${k.type}]`),k.href&&(E+=`[href=${$(k.href,60)}]`),k.role&&(E+=`[role=${k.role}]`);let O=D?D.tagName.toLowerCase():"";return O&&(E+=` inside ${O}`),D?.id&&(E+=`#${D.id}`),{description:E,attributes:Object.keys(k).length>0?k:void 0,visibleText:j||void 0,pagePath:X,siblings:T.length>0?T:void 0}}function C(g){let y=g.getAttribute("aria-label");if(y)return y.trim();let k=g.getAttribute("alt");if(k)return k.trim();let U=g.getAttribute("title");if(U)return U.trim();let j="";for(let X of g.childNodes)X.nodeType===Node.TEXT_NODE&&(j+=X.textContent);return j=j.trim(),j||(g.textContent||"").trim().slice(0,150)}function $(g,y){return g.length>y?g.slice(0,y)+"...":g}function H(){l(),p()}return{enable:f,disable:l,applyPin:B,removePin:R,removeAll:p,repositionAll:P,scrollToPin:x,destroy:H}}function Re(e){if(!e)return!1;let t=e;for(;t;){if(t.dataset&&t.dataset.ano!==void 0||t.host&&t.host.dataset&&t.host.dataset.ano!==void 0)return!0;t=t.parentNode}return!1}var Ie={light:{"--ano-bg":"#ffffff","--ano-bg-secondary":"#f8fafc","--ano-bg-hover":"#f1f5f9","--ano-border":"#e2e8f0","--ano-text":"#1e293b","--ano-text-secondary":"#64748b","--ano-accent":"#3b82f6","--ano-accent-hover":"#2563eb","--ano-highlight":"#fde047","--ano-pin":"#3b82f6","--ano-draw":"#ef4444","--ano-danger":"#ef4444","--ano-danger-hover":"#dc2626","--ano-shadow":"0 4px 24px rgba(0,0,0,0.12)","--ano-shadow-sm":"0 2px 8px rgba(0,0,0,0.08)"},dark:{"--ano-bg":"#1e293b","--ano-bg-secondary":"#0f172a","--ano-bg-hover":"#334155","--ano-border":"#475569","--ano-text":"#f1f5f9","--ano-text-secondary":"#94a3b8","--ano-accent":"#60a5fa","--ano-accent-hover":"#3b82f6","--ano-highlight":"#fbbf24","--ano-pin":"#60a5fa","--ano-draw":"#f87171","--ano-danger":"#f87171","--ano-danger-hover":"#ef4444","--ano-shadow":"0 4px 24px rgba(0,0,0,0.4)","--ano-shadow-sm":"0 2px 8px rgba(0,0,0,0.3)"}};var Oe=`
  :host {
    all: initial;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  .ano-toolbar {
    position: fixed;
    top: 12px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 2px;
    padding: 4px;
    background: var(--ano-bg);
    border: 1px solid var(--ano-border);
    border-radius: 10px;
    box-shadow: var(--ano-shadow);
    z-index: 2147483646;
    user-select: none;
  }
  .ano-toolbar-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    border-radius: 8px;
    border: none;
    background: transparent;
    color: var(--ano-text-secondary);
    cursor: pointer;
    transition: all 0.15s;
    font-size: 18px;
    position: relative;
  }
  .ano-toolbar-btn:hover {
    background: var(--ano-bg-hover);
    color: var(--ano-text);
  }
  .ano-toolbar-btn.active {
    background: var(--ano-accent);
    color: #fff;
  }
  .ano-toolbar-btn .tooltip {
    position: absolute;
    bottom: -30px;
    left: 50%;
    transform: translateX(-50%);
    padding: 3px 8px;
    background: var(--ano-text);
    color: var(--ano-bg);
    font-size: 11px;
    border-radius: 4px;
    white-space: nowrap;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.15s;
  }
  .ano-toolbar-btn:hover .tooltip {
    opacity: 1;
  }
  .ano-toolbar-divider {
    width: 1px;
    margin: 6px 3px;
    background: var(--ano-border);
    flex-shrink: 0;
  }
  .ano-start-session {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 6px 14px;
    border-radius: 8px;
    border: none;
    background: var(--ano-accent);
    color: #fff;
    cursor: pointer;
    transition: all 0.15s;
    font-size: 13px;
    font-weight: 600;
    font-family: inherit;
    white-space: nowrap;
  }
  .ano-start-session:hover {
    background: var(--ano-accent-hover);
  }
  .ano-video-toggle {
    display: flex;
    align-items: center;
    gap: 5px;
    padding: 0 8px;
    font-size: 12px;
    color: var(--ano-text-secondary);
    cursor: pointer;
    user-select: none;
    white-space: nowrap;
  }
  .ano-video-toggle input {
    margin: 0;
    cursor: pointer;
  }
  .ano-session-status {
    display: flex;
    align-items: center;
    gap: 8px;
  }
  @keyframes ano-pulse-dot { 0%,100%{opacity:1} 50%{opacity:.3} }
  .ano-session-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: #22c55e;
    animation: ano-pulse-dot 1s ease-in-out infinite;
    flex-shrink: 0;
  }
  .ano-session-timer {
    font-size: 13px;
    font-weight: 600;
    font-variant-numeric: tabular-nums;
    color: var(--ano-text);
    min-width: 36px;
  }
  .ano-session-count {
    font-size: 12px;
    color: var(--ano-text-secondary);
    white-space: nowrap;
  }
  .ano-end-session {
    display: flex;
    align-items: center;
    gap: 5px;
    padding: 5px 12px;
    border-radius: 8px;
    border: none;
    background: var(--ano-danger);
    color: #fff;
    cursor: pointer;
    transition: all 0.15s;
    font-size: 12px;
    font-weight: 600;
    font-family: inherit;
    white-space: nowrap;
  }
  .ano-end-session:hover {
    background: var(--ano-danger-hover);
  }
  .ano-btn-label {
    font-family: inherit;
  }
`,De=`
  :host {
    all: initial;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    font-size: 14px;
    color: var(--ano-text);
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  .ano-popover {
    position: fixed;
    width: 280px;
    background: var(--ano-bg);
    border: 1px solid var(--ano-border);
    border-radius: 10px;
    box-shadow: var(--ano-shadow);
    z-index: 2147483647;
    overflow: hidden;
  }
  .ano-popover-body {
    padding: 12px;
  }
  .ano-popover textarea {
    width: 100%;
    min-height: 60px;
    padding: 8px;
    border: 1px solid var(--ano-border);
    border-radius: 6px;
    background: var(--ano-bg-secondary);
    color: var(--ano-text);
    font-family: inherit;
    font-size: 13px;
    resize: vertical;
    outline: none;
    transition: border-color 0.15s;
  }
  .ano-popover textarea:focus {
    border-color: var(--ano-accent);
  }
  .ano-popover-actions {
    display: flex;
    justify-content: flex-end;
    gap: 6px;
    padding: 8px 12px;
    border-top: 1px solid var(--ano-border);
    background: var(--ano-bg-secondary);
  }
  .ano-popover-btn {
    padding: 5px 12px;
    border-radius: 6px;
    border: 1px solid var(--ano-border);
    background: var(--ano-bg);
    color: var(--ano-text);
    font-size: 12px;
    cursor: pointer;
    transition: all 0.15s;
  }
  .ano-popover-btn:hover {
    background: var(--ano-bg-hover);
  }
  .ano-popover-btn.save {
    background: var(--ano-accent);
    color: #fff;
    border-color: var(--ano-accent);
  }
  .ano-popover-btn.save:hover {
    background: var(--ano-accent-hover);
  }
  .ano-popover-btn.delete {
    color: var(--ano-danger);
    border-color: var(--ano-danger);
  }
  .ano-popover-btn.delete:hover {
    background: var(--ano-danger);
    color: #fff;
  }
  .ano-popover-arrow {
    position: absolute;
    width: 12px;
    height: 12px;
    background: var(--ano-bg);
    border: 1px solid var(--ano-border);
    transform: rotate(45deg);
  }
  .ano-popover-arrow.top {
    bottom: -7px;
    border-top: none;
    border-left: none;
  }
  .ano-popover-arrow.bottom {
    top: -7px;
    border-bottom: none;
    border-right: none;
  }
`,Be=`
  :host {
    all: initial;
  }
  .ano-canvas-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    z-index: 2147483645;
    pointer-events: none;
  }
  .ano-canvas-overlay.active {
    pointer-events: auto;
    cursor: crosshair;
  }
`,bt=`
  .ano-highlight {
    background-color: var(--ano-hl-color, #fde047);
    cursor: pointer;
    border-radius: 2px;
    transition: background-color 0.15s;
  }
  .ano-highlight:hover {
    filter: brightness(0.9);
  }
`,vt=`
  .ano-pin-marker {
    position: absolute;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: var(--ano-pin-color, #3b82f6);
    color: #fff;
    font-size: 12px;
    font-weight: 700;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 2147483644;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    transition: transform 0.15s;
    pointer-events: auto;
    user-select: none;
  }
  .ano-pin-marker:hover {
    transform: scale(1.2);
  }
  .ano-pin-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    z-index: 2147483643;
    pointer-events: none;
  }
  .ano-pin-overlay.active {
    pointer-events: auto;
    cursor: crosshair;
  }
  .ano-pin-hover-outline {
    position: absolute;
    border: 2px dashed #3b82f6;
    background: rgba(59, 130, 246, 0.08);
    border-radius: 3px;
    pointer-events: none;
    z-index: 2147483643;
    transition: all 0.1s;
  }
`,ze=`
  :host {
    all: initial;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    font-size: 14px;
    color: var(--ano-text);
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  .ano-end-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0,0,0,0.4);
    z-index: 2147483647;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .ano-end-dialog {
    background: var(--ano-bg);
    border: 1px solid var(--ano-border);
    border-radius: 14px;
    box-shadow: var(--ano-shadow);
    width: 400px;
    max-width: 90vw;
    overflow: hidden;
  }
  .ano-end-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px 20px;
    border-bottom: 1px solid var(--ano-border);
  }
  .ano-end-header h2 {
    font-size: 16px;
    font-weight: 700;
    color: var(--ano-text);
  }
  .ano-end-close {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 28px;
    height: 28px;
    border-radius: 6px;
    border: none;
    background: transparent;
    color: var(--ano-text-secondary);
    cursor: pointer;
    transition: all 0.15s;
    font-size: 18px;
  }
  .ano-end-close:hover {
    background: var(--ano-bg-hover);
    color: var(--ano-text);
  }
  .ano-end-summary {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    padding: 20px;
  }
  .ano-end-stat {
    padding: 12px;
    border-radius: 10px;
    background: var(--ano-bg-secondary);
    border: 1px solid var(--ano-border);
    text-align: center;
  }
  .ano-end-stat-value {
    font-size: 22px;
    font-weight: 700;
    color: var(--ano-text);
    font-variant-numeric: tabular-nums;
  }
  .ano-end-stat-label {
    font-size: 11px;
    color: var(--ano-text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-top: 2px;
  }
  .ano-end-badge {
    grid-column: 1 / -1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    padding: 8px;
    border-radius: 8px;
    background: var(--ano-bg-secondary);
    border: 1px solid var(--ano-border);
    font-size: 12px;
    color: var(--ano-text-secondary);
  }
  .ano-end-actions {
    display: flex;
    gap: 8px;
    padding: 16px 20px;
    border-top: 1px solid var(--ano-border);
    justify-content: flex-end;
  }
  .ano-end-actions button {
    padding: 7px 16px;
    border-radius: 8px;
    border: 1px solid var(--ano-border);
    background: var(--ano-bg);
    color: var(--ano-text);
    font-size: 13px;
    font-family: inherit;
    cursor: pointer;
    transition: all 0.15s;
  }
  .ano-end-actions button:hover {
    background: var(--ano-bg-hover);
  }
  .ano-end-actions button.primary {
    background: var(--ano-accent);
    color: #fff;
    border-color: var(--ano-accent);
  }
  .ano-end-actions button.primary:hover {
    background: var(--ano-accent-hover);
  }
  .ano-end-actions button:disabled {
    opacity: 0.5;
    cursor: default;
  }
  .ano-end-link-result {
    display: flex;
    gap: 6px;
    padding: 0 20px 16px;
  }
  .ano-end-link-input {
    flex: 1;
    padding: 7px 10px;
    border-radius: 8px;
    border: 1px solid var(--ano-border);
    background: var(--ano-bg-secondary);
    color: var(--ano-text);
    font-size: 12px;
    font-family: monospace;
    outline: none;
  }
  .ano-end-link-copy {
    padding: 7px 14px;
    border-radius: 8px;
    border: 1px solid var(--ano-accent);
    background: var(--ano-accent);
    color: #fff;
    font-size: 13px;
    font-family: inherit;
    cursor: pointer;
    transition: all 0.15s;
    white-space: nowrap;
  }
  .ano-end-link-copy:hover {
    background: var(--ano-accent-hover);
  }
  .ano-end-annotations {
    padding: 0 20px 16px;
  }
  .ano-end-annotations h3 {
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--ano-text-secondary);
    margin-bottom: 8px;
  }
  .ano-end-ann-list {
    max-height: 280px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 6px;
  }
  .ano-end-ann-card {
    padding: 8px 10px;
    border: 1px solid var(--ano-border);
    border-radius: 8px;
    background: var(--ano-bg-secondary);
  }
  .ano-end-ann-type {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 3px;
  }
  .ano-end-ann-type .dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    flex-shrink: 0;
  }
  .ano-end-ann-type.highlight { color: #ca8a04; }
  .ano-end-ann-type.highlight .dot { background: var(--ano-highlight); }
  .ano-end-ann-type.pin { color: var(--ano-pin); }
  .ano-end-ann-type.pin .dot { background: var(--ano-pin); }
  .ano-end-ann-type.drawing { color: var(--ano-draw); }
  .ano-end-ann-type.drawing .dot { background: var(--ano-draw); }
  .ano-end-ann-text {
    font-size: 13px;
    color: var(--ano-text);
    line-height: 1.4;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
  }
  .ano-end-ann-comment {
    font-size: 12px;
    color: var(--ano-text-secondary);
    font-style: italic;
    line-height: 1.4;
    margin-top: 2px;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
  }
`;function Pe(){let e="ano-host-styles";if(document.getElementById(e))return;let t=document.createElement("style");t.id=e,t.textContent=bt+vt,document.head.appendChild(t)}function Ue(){document.getElementById("ano-host-styles")?.remove()}function ne(e,t){let n=Ie[t]||Ie.light;for(let[r,o]of Object.entries(n))e.style.setProperty(r,o)}function He(e){let{store:t,config:n}=e,r=null,o=null,a=null,s=null,f=!1,l=!1,i=null,c=new Set;function v(){if(r)return;r=document.createElement("div"),r.dataset.ano="",o=r.attachShadow({mode:"open"});let h=document.createElement("style");h.textContent=Be,o.appendChild(h),a=document.createElement("canvas"),a.className="ano-canvas-overlay",o.appendChild(a),document.body.appendChild(r),m(),window.addEventListener("resize",m),window.addEventListener("scroll",$)}function m(){if(!a)return;let h=window.devicePixelRatio||1;a.width=window.innerWidth*h,a.height=window.innerHeight*h,a.style.width=window.innerWidth+"px",a.style.height=window.innerHeight+"px",s=a.getContext("2d"),s.scale(h,h),$()}function A(){f||(v(),f=!0,a.classList.add("active"),a.addEventListener("pointerdown",L),a.addEventListener("pointermove",P),a.addEventListener("pointerup",B),a.addEventListener("pointerleave",B))}function w(){f=!1,a&&(a.classList.remove("active"),a.removeEventListener("pointerdown",L),a.removeEventListener("pointermove",P),a.removeEventListener("pointerup",B),a.removeEventListener("pointerleave",B)),l&&p()}function L(h){h.button===0&&(l=!0,a.setPointerCapture(h.pointerId),i={points:[{x:h.clientX,y:h.clientY}],color:n.drawColor,width:n.drawWidth},s.beginPath(),s.strokeStyle=i.color,s.lineWidth=i.width,s.lineCap="round",s.lineJoin="round",s.moveTo(h.clientX,h.clientY))}function P(h){!l||!i||(i.points.push({x:h.clientX,y:h.clientY}),s.lineTo(h.clientX,h.clientY),s.stroke(),s.beginPath(),s.moveTo(h.clientX,h.clientY))}function B(){l&&p()}function R(h){let T=h.points,D=1/0,E=1/0,O=-1/0,M=-1/0;for(let W of T)W.x<D&&(D=W.x),W.y<E&&(E=W.y),W.x>O&&(O=W.x),W.y>M&&(M=W.y);let z=(D+O)/2,_=(E+M)/2,V=r.style.display;r.style.display="none";let F=document.elementFromPoint(z,_);if(r.style.display=V,!F||F===document.documentElement)return null;let K=F.getBoundingClientRect();return K.width<1||K.height<1?null:{selector:Z(F),rect:{x:K.x,y:K.y,width:K.width,height:K.height}}}function p(){if(l=!1,!i||i.points.length<2){i=null;return}let h=x(i),T=R(i),D;if(T){let{rect:M}=T,z=i.points.map(_=>({x:(_.x-M.x)/M.width,y:(_.y-M.y)/M.height}));D=[{...i,points:z}]}else D=[i];let E=t.add({type:"drawing",comment:"",strokes:D,context:h,anchor:T,viewport:{scrollX:window.scrollX,scrollY:window.scrollY,width:window.innerWidth,height:window.innerHeight}});c.add(E.id);let O=i?i.points:[];i=null,e.events.emit("drawing:created",E,O)}function x(h){let T=h.points,D=1/0,E=1/0,O=-1/0,M=-1/0;for(let d of T)d.x<D&&(D=d.x),d.y<E&&(E=d.y),d.x>O&&(O=d.x),d.y>M&&(M=d.y);let z={x:Math.round(D+window.scrollX),y:Math.round(E+window.scrollY),width:Math.round(O-D),height:Math.round(M-E)},_=r.style.display;r.style.display="none";let V=new Set,F=[],K=Math.min(T.length,20),W=Math.max(1,Math.floor(T.length/K));for(let d=0;d<T.length;d+=W){let N=T[d],I=document.elementFromPoint(N.x,N.y);if(!I||I===document.body||I===document.documentElement||I.dataset?.ano!==void 0)continue;let G=Z(I);if(V.has(G))continue;V.add(G);let q=b(I);F.push({selector:G,tagName:I.tagName,text:q,role:I.getAttribute("role")||void 0,ariaLabel:I.getAttribute("aria-label")||void 0})}r.style.display=_;let ee=F.map(d=>{let N=d.tagName.toLowerCase();return d.text?`${N}("${C(d.text,60)}")`:N}),u=ee.length>0?`Drawing over: ${ee.join(", ")}`:"Drawing on empty area";return{boundingBox:z,elements:F,description:u}}function b(h){let T=h.getAttribute("aria-label");if(T)return T.trim();let D=h.getAttribute("alt");if(D)return D.trim();let E="";for(let M of h.childNodes)M.nodeType===Node.TEXT_NODE&&(E+=M.textContent);return E=E.trim(),E||(h.textContent||"").trim().slice(0,120)}function C(h,T){return h.length>T?h.slice(0,T)+"...":h}function $(){if(!s)return;s.clearRect(0,0,a.width,a.height);let h=t.getByType("drawing");for(let T of h)H(T)}function H(h){if(!s||!h.strokes)return;let{anchor:T,viewport:D}=h,E=null;if(T)try{let O=document.querySelector(T.selector);O&&(E=O.getBoundingClientRect())}catch{}for(let O of h.strokes)if(!(O.points.length<2)){if(s.beginPath(),s.strokeStyle=O.color,s.lineCap="round",s.lineJoin="round",E){let M=E.width/T.rect.width,z=E.height/T.rect.height;s.lineWidth=O.width*Math.min(M,z);let _=O.points[0];s.moveTo(_.x*E.width+E.x,_.y*E.height+E.y);for(let V=1;V<O.points.length;V++){let F=O.points[V];s.lineTo(F.x*E.width+E.x,F.y*E.height+E.y)}}else{let M=D?window.scrollX-D.scrollX:0,z=D?window.scrollY-D.scrollY:0;s.lineWidth=O.width;let _=O.points[0];s.moveTo(_.x-M,_.y-z);for(let V=1;V<O.points.length;V++){let F=O.points[V];s.lineTo(F.x-M,F.y-z)}}s.stroke()}}function g(h){return c.add(h.id),$(),!0}function y(h){c.delete(h),$()}function k(){c.clear(),s&&s.clearRect(0,0,a.width,a.height)}function U(h,T){let D=t.getByType("drawing");for(let E=D.length-1;E>=0;E--){let O=D[E],M=j(O);if(!M)continue;let z=10;if(h>=M.x-z&&h<=M.x+M.width+z&&T>=M.y-z&&T<=M.y+M.height+z)return O}return null}function j(h){let{anchor:T,viewport:D,strokes:E}=h;if(!E||E.length===0)return null;let O=null;if(T)try{let F=document.querySelector(T.selector);F&&(O=F.getBoundingClientRect())}catch{}let M=1/0,z=1/0,_=-1/0,V=-1/0;for(let F of E)for(let K of F.points){let W,ee;if(O)W=K.x*O.width+O.x,ee=K.y*O.height+O.y;else{let u=D?window.scrollX-D.scrollX:0,d=D?window.scrollY-D.scrollY:0;W=K.x-u,ee=K.y-d}W<M&&(M=W),ee<z&&(z=ee),W>_&&(_=W),ee>V&&(V=ee)}return isFinite(M)?{x:M,y:z,width:_-M,height:V-z}:null}function X(){w(),k(),window.removeEventListener("resize",m),window.removeEventListener("scroll",$),r&&(r.remove(),r=null,o=null,a=null,s=null)}return{init:v,enable:A,disable:w,applyDrawing:g,removeDrawing:y,removeAll:k,redrawAll:$,hitTest:U,destroy:X}}var ce=!!navigator.mediaDevices?.getDisplayMedia&&!!window.MediaRecorder&&typeof MediaRecorder.isTypeSupported=="function"&&MediaRecorder.isTypeSupported("video/webm")&&!!window.BroadcastChannel,yt=`<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"><title>Ano Recording</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;font-size:13px;background:#1e293b;color:#f1f5f9;display:flex;align-items:center;justify-content:center;min-height:100vh;padding:12px}
.wrap{display:flex;align-items:center;gap:10px}
.dot{width:10px;height:10px;border-radius:50%;background:#ef4444;animation:p 1s ease-in-out infinite;flex-shrink:0}
@keyframes p{0%,100%{opacity:1}50%{opacity:.3}}
.timer{font-weight:600;font-variant-numeric:tabular-nums;font-size:15px;min-width:44px}
button{padding:5px 14px;border-radius:6px;border:1px solid rgba(255,255,255,.25);background:transparent;color:#fff;cursor:pointer;font-size:13px;transition:background .15s}
button:hover{background:rgba(255,255,255,.12)}
#start{background:#ef4444;border-color:#ef4444;font-weight:600;padding:8px 20px;font-size:14px}
#start:hover{background:#dc2626}
.msg{color:#94a3b8;font-size:12px;text-align:center}
</style></head><body>
<div id="app"><button id="start">Share Tab &amp; Record</button></div>
<script>
var ch=new BroadcastChannel('ano-recording');
var rec,chunks=[],startTime=0,stream,timerIv;
ch.onmessage=function(e){
if(e.data.type==='stop')doStop();
if(e.data.type==='ping'&&rec&&rec.state==='recording')ch.postMessage({type:'pong',startTime:startTime});
};
document.getElementById('start').onclick=function(){startCapture()};
function startCapture(){
navigator.mediaDevices.getDisplayMedia({video:{frameRate:30}}).then(function(s){
stream=s;
var mime='video/webm';
if(typeof MediaRecorder.isTypeSupported==='function'&&MediaRecorder.isTypeSupported('video/webm;codecs=vp9'))mime='video/webm;codecs=vp9';
rec=new MediaRecorder(stream,{mimeType:mime});
chunks=[];
rec.ondataavailable=function(e){if(e.data.size>0)chunks.push(e.data)};
rec.onstop=onStop;
rec.start(500);
startTime=Date.now();
stream.getVideoTracks()[0].onended=function(){doStop()};
document.getElementById('app').innerHTML='<div class="wrap"><span class="dot"></span><span class="timer" id="t">0:00</span><button id="stopbtn">Stop</button></div>';
document.getElementById('stopbtn').onclick=function(){doStop()};
timerIv=setInterval(function(){
var sec=Math.floor((Date.now()-startTime)/1000);
var el=document.getElementById('t');
if(el)el.textContent=Math.floor(sec/60)+':'+(sec%60).toString().padStart(2,'0');
},250);
ch.postMessage({type:'started',startTime:startTime});
}).catch(function(){
ch.postMessage({type:'cancelled'});
try{window.close()}catch(e){}
});
}
function doStop(){if(!rec||rec.state==='inactive')return;rec.stop()}
function onStop(){
clearInterval(timerIv);
if(stream)stream.getTracks().forEach(function(t){t.stop()});
var blob=new Blob(chunks,{type:'video/webm'});
var duration=Date.now()-startTime;
ch.postMessage({type:'stopped',duration:duration,blob:blob});
document.getElementById('app').innerHTML='<div class="msg">Recording saved. Closing\\u2026</div>';
setTimeout(function(){try{window.close()}catch(e){}},2000);
}
window.onbeforeunload=function(){if(rec&&rec.state==='recording')doStop()};
<\/script></body></html>`;function je(e){let t=new BroadcastChannel("ano-recording"),n=!1,r=null,o=0,a=null,s=null,f=0;t.onmessage=R=>{let{data:p}=R;p.type==="started"?(n=!0,o=p.startTime,e.events.emit("recording:started")):p.type==="stopped"?m(p):p.type==="pong"?n||(n=!0,o=p.startTime):p.type==="cancelled"&&e.events.emit("recording:cancelled")};function l(){n||v()}function i(){t.postMessage({type:"stop"})}function c(){return n}function v(){if(r=window.open("","ano-recorder","width=460,height=600,top=60,left=60"),!r){console.warn("[Ano] Popup blocked \u2014 allow popups for screen recording."),e.events.emit("recording:cancelled");return}r.document.open(),r.document.write(yt),r.document.close()}function m(R){n=!1,R.blob&&(a=R.blob,s=URL.createObjectURL(R.blob),f=R.duration||0),e.events.emit("recording:stopped",{blob:a,blobUrl:s,duration:f}),r=null}function A(){return a}function w(){return s}function L(){s&&URL.revokeObjectURL(s),a=null,s=null,f=0}function P(R){let p=e.store.get(R);p&&p.blobUrl&&URL.revokeObjectURL(p.blobUrl)}function B(){n&&i(),L();try{t.close()}catch{}let R=e.store.getByType("recording");for(let p of R)p.blobUrl&&URL.revokeObjectURL(p.blobUrl)}return setTimeout(()=>t.postMessage({type:"ping"}),100),{startRecording:l,stopRecording:i,isRecording:c,getBlob:A,getBlobUrl:w,clearBlob:L,removeRecording:P,destroy:B}}var he="ano-session",xt=/password|cc-|cvv|ssn|secret|token/i,wt=0;function kt(){return"ses_"+Date.now().toString(36)+(wt++).toString(36)+Math.random().toString(36).slice(2,6)}function Xe(e){let t=!1,n=null,r=0,o=[],a=[],s=null,f=new WeakMap,l=0,i=null,c={},v=["log","warn","error","info"];function m(u){if(!u)return"unknown";let d=u.tagName.toLowerCase();if(d==="button"||d==="input"&&u.type==="submit"){let I=u.textContent?.trim()||u.value||"";return I?`button("${te(I,40)}")`:"button"}if(d==="a"){let I=u.textContent?.trim()||"";return I?`link("${te(I,40)}")`:`link(${u.href||""})`}if(d==="input")return`input[name="${u.name||u.id||u.type}"]`;if(d==="textarea")return`textarea[name="${u.name||u.id||"textarea"}"]`;if(d==="select"){let I=u.name||u.id||"select";return`select${I!=="select"?`[name="${I}"]`:""}`}if(d==="label"){let I=u.textContent?.trim()||"";return I?`label("${te(I,40)}")`:"label"}if(d==="img")return`img(${u.alt||u.src?.split("/").pop()||""})`;let N=u.textContent?.trim();if(N&&N.length<60&&u.children.length===0)return`${d}("${te(N,40)}")`;if(u.id)return`${d}#${u.id}`;if(u.className&&typeof u.className=="string"){let I=u.className.split(/\s+/).filter(Boolean).slice(0,2).join(".");if(I)return`${d}.${I}`}return d}function A(u){if(u.type==="password")return!0;let d=u.autocomplete||"";return xt.test(d)}function w(u){if(!u)return!1;if(u.closest?.("[data-ano]"))return!0;let d=u;for(;d;){if(d.host&&d.host.dataset&&d.host.dataset.ano!==void 0)return!0;d=d.parentNode}return!1}function L(u,d,N,I,G){let q={time:Date.now()-r,action:u,target:d||null,selector:N||null,value:I??null,url:G||window.location.href};o.push(q),j(),e.events.emit("session:action",o.length)}function P(u){if(w(u.target))return;let d=u.target,N=null;try{N=Z(d)}catch{}L("click",m(d),N,null)}function B(u){if(w(u.target))return;let d=u.target,N=f.get(d);N&&clearTimeout(N);let I=setTimeout(()=>{f.delete(d);let G=A(d)?"[redacted]":d.value,q=null;try{q=Z(d)}catch{}L("type",m(d),q,G)},500);f.set(d,I)}function R(u){if(w(u.target))return;let d=u.target,N=d.tagName.toLowerCase(),I=d.type?.toLowerCase();if(N==="select"){let G=d.options?.[d.selectedIndex]?.text||d.value,q=null;try{q=Z(d)}catch{}L("select",m(d),q,G)}else if(I==="checkbox"||I==="radio"){let G=d.checked?"checked":"unchecked",q=null;try{q=Z(d)}catch{}L("check",m(d),q,G)}}function p(){i||(i=setTimeout(()=>{i=null;let u=window.scrollY;Math.abs(u-l)<100||(l=u,L("scroll",null,null,`y=${Math.round(u)}`))},300))}function x(u){if(w(u.target))return;let d=u.target,N=null;try{N=Z(d)}catch{}L("submit",m(d),N,null)}function b(u){let d=u.message||"Unknown error",N=u.filename?` at ${u.filename}:${u.lineno}:${u.colno}`:"";L("error",null,null,`${d}${N}`)}function C(u){let d=u.reason,N;if(d instanceof Error)N=`${d.name}: ${d.message}`;else try{N=JSON.stringify(d)}catch{N=String(d)}L("error","unhandledrejection",null,te(N,300))}function $(){H(),U()}function H(){s&&(clearTimeout(s),s=null)}function g(){for(let u of v)c[u]=console[u],console[u]=(...d)=>{if(c[u].apply(console,d),typeof d[0]=="string"&&d[0].startsWith("[Ano]"))return;let N=k(d);L(`console.${u}`,null,null,N)}}function y(){for(let u of v)c[u]&&(console[u]=c[u],delete c[u])}function k(u){let d=u.map(N=>{if(N===null)return"null";if(N===void 0)return"undefined";if(typeof N=="string")return N;if(typeof N=="number"||typeof N=="boolean")return String(N);if(N instanceof Error)return`${N.name}: ${N.message}`;try{let I=JSON.stringify(N);return I.length>200?I.slice(0,200)+"...":I}catch{return String(N)}});return te(d.join(" "),500)}function U(){if(t)try{sessionStorage.setItem(he,JSON.stringify({active:!0,sessionId:n,startTime:r,actions:o,pages:a}))}catch{}}function j(){s&&clearTimeout(s),s=setTimeout(U,200)}function X(){try{sessionStorage.removeItem(he)}catch{}}function h(){document.addEventListener("click",P,!0),document.addEventListener("input",B,!0),document.addEventListener("change",R,!0),document.addEventListener("scroll",p,{capture:!0,passive:!0}),document.addEventListener("submit",x,!0),window.addEventListener("beforeunload",$),window.addEventListener("error",b),window.addEventListener("unhandledrejection",C)}function T(){document.removeEventListener("click",P,!0),document.removeEventListener("input",B,!0),document.removeEventListener("change",R,!0),document.removeEventListener("scroll",p,{capture:!0}),document.removeEventListener("submit",x,!0),window.removeEventListener("beforeunload",$),window.removeEventListener("error",b),window.removeEventListener("unhandledrejection",C)}function D(){return t=!0,n=kt(),r=Date.now(),o=[],a=[window.location.href],l=window.scrollY,U(),h(),g(),n}function E(u){t=!0,n=u.sessionId,r=u.startTime,o=u.actions||[],a=u.pages||[],l=window.scrollY;let d=window.location.href;a.includes(d)||a.push(d),L("navigate",document.title,null,d,d),h(),g()}function O(){if(!t)return null;t=!1,H(),T(),y(),X(),i&&(clearTimeout(i),i=null);let u=Date.now()-r,d=M(u,o,a),N={sessionId:n,duration:u,actions:o.slice(),pages:a.slice(),description:d},I=n;return o=[],a=[],r=0,n=null,N}function M(u,d,N){let G=[`Session (${Math.round(u/1e3)}s, ${d.length} actions, ${N.length} pages):`];for(let q=0;q<d.length;q++){let J=d[q],st=(J.time/1e3).toFixed(1),Q;switch(J.action){case"click":Q=`Clicked ${J.target}`;break;case"type":Q=`Typed "${te(J.value||"",40)}" in ${J.target}`;break;case"select":Q=`Selected "${J.value}" in ${J.target}`;break;case"check":Q=`${J.value==="checked"?"Checked":"Unchecked"} ${J.target}`;break;case"scroll":Q=`Scrolled to ${J.value}`;break;case"submit":Q=`Submitted ${J.target}`;break;case"navigate":Q=`Navigated to ${J.value}`;break;case"console.log":Q=`console.log: ${te(J.value||"",80)}`;break;case"console.warn":Q=`console.warn: ${te(J.value||"",80)}`;break;case"console.error":Q=`console.error: ${te(J.value||"",80)}`;break;case"console.info":Q=`console.info: ${te(J.value||"",80)}`;break;case"error":Q=`ERROR: ${te(J.value||"",80)}`;break;default:Q=`${J.action} ${J.target||""}`}G.push(`${q+1}. [${st}s] ${Q}`)}return G.join(`
`)}function z(){return t}function _(){return n}function V(){return r}function F(){return o.length}function K(u){}function W(){t&&(t=!1,T(),y(),X(),i&&(clearTimeout(i),i=null),s&&(clearTimeout(s),s=null)),o=[],a=[],n=null}function ee(){try{let u=sessionStorage.getItem(he);if(!u)return;let d=JSON.parse(u);d&&d.active&&(E(d),e.events.emit("session:resumed",{sessionId:d.sessionId,startTime:d.startTime}))}catch{}}return setTimeout(ee,50),{start:D,stop:O,isActive:z,getSessionId:_,getStartTime:V,getActionCount:F,checkResume:ee,removeSession:K,destroy:W}}function te(e,t){return e?e.length>t?e.slice(0,t)+"...":e:""}function S(e,t={},...n){let r=document.createElement(e);for(let[o,a]of Object.entries(t))o==="className"?r.className=a:o==="style"&&typeof a=="object"?Object.assign(r.style,a):o.startsWith("on")&&typeof a=="function"?r.addEventListener(o.slice(2).toLowerCase(),a):o==="html"?r.innerHTML=a:r.setAttribute(o,a);for(let o of n)o!=null&&(typeof o=="string"?r.appendChild(document.createTextNode(o)):r.appendChild(o));return r}function oe(e){let t={highlight:'<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>',pin:'<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>',draw:'<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 19l7-7 3 3-7 7-3-3z"/><path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/><path d="M2 2l7.586 7.586"/></svg>',navigate:'<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 11l19-9-9 19-2-8-8-2z"/></svg>',close:'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>',download:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>',upload:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>',trash:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>',chevron:'<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>',record:'<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="4" fill="currentColor" stroke="none"/></svg>',stop:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="6" y="6" width="12" height="12" rx="1" fill="currentColor" stroke="none"/></svg>',session:'<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>',annotation:'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>',link:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>'},n=document.createElement("span");return n.innerHTML=t[e]||"",n.style.display="inline-flex",n.style.alignItems="center",n}var Ct=[{id:"highlight",label:"Highlight",icon:"highlight",shortcut:"Alt+H"},{id:"pin",label:"Pin",icon:"pin",shortcut:"Alt+P"},{id:"draw",label:"Draw",icon:"draw",shortcut:"Alt+D"},{id:"navigate",label:"Navigate",icon:"navigate",shortcut:"Alt+N"}];function _e(e){let t=null,n=null,r=null,o={},a=null,s=null,f=null,l=null;function i(){t=document.createElement("div"),t.dataset.ano="",n=t.attachShadow({mode:"open"});let R=document.createElement("style");R.textContent=Oe,n.appendChild(R),ne(t,e.config.theme),r=S("div",{className:"ano-toolbar"}),n.appendChild(r),document.body.appendChild(t),c()}function c(){L(),o={},r.innerHTML="";let R=S("button",{className:"ano-start-session",onClick:()=>e.events.emit("session:start")},oe("session"),S("span",{className:"ano-btn-label"},"Start Session"));if(r.appendChild(R),ce){let p=S("label",{className:"ano-video-toggle"});l=document.createElement("input"),l.type="checkbox",l.checked=e.config.videoRecording,p.appendChild(l),p.appendChild(oe("record")),p.appendChild(document.createTextNode("Video")),r.appendChild(p)}}function v(R){L(),o={},r.innerHTML="";for(let C of Ct){let $=S("button",{className:"ano-toolbar-btn",title:C.label,onClick:()=>e.setMode(C.id)},oe(C.icon),S("span",{className:"tooltip"},`${C.label} (${C.shortcut})`));o[C.id]=$,r.appendChild($)}r.appendChild(S("div",{className:"ano-toolbar-divider"}));let p=S("div",{className:"ano-session-status"});p.appendChild(S("span",{className:"ano-session-dot"})),a=S("span",{className:"ano-session-timer"},"0:00"),p.appendChild(a),s=S("span",{className:"ano-session-count"},"(0)"),p.appendChild(s);let x=S("button",{className:"ano-end-session",onClick:()=>e.events.emit("session:end")},oe("stop"),S("span",{className:"ano-btn-label"},"End"));p.appendChild(x),r.appendChild(p);let b=()=>{if(!a)return;let C=Date.now()-R,$=Math.floor(C/1e3),H=Math.floor($/60),g=$%60;a.textContent=`${H}:${g.toString().padStart(2,"0")}`};b(),f=setInterval(b,250)}function m(R){s&&(s.textContent=`(${R})`)}function A(){return l?l.checked:!1}function w(R){for(let[p,x]of Object.entries(o))x.classList.toggle("active",p===R)}function L(){f&&(clearInterval(f),f=null),a=null,s=null}function P(R){t&&ne(t,R)}function B(){L(),t&&(t.remove(),t=null,n=null,r=null,o={},l=null)}return{render:i,renderIdle:c,renderActive:v,setActive:w,updateCount:m,getVideoToggleState:A,updateTheme:P,destroy:B}}function Fe(e){let{store:t}=e,n=null,r=null,o=null,a=null;function s(){if(n)return;n=document.createElement("div"),n.dataset.ano="",r=n.attachShadow({mode:"open"});let w=document.createElement("style");w.textContent=De,r.appendChild(w),ne(n,e.config.theme),document.body.appendChild(n)}function f(w,L){s(),i(),o=w;let P=t.get(w);if(!P)return;let B=S("div",{className:"ano-popover"}),R=S("div",{className:"ano-popover-body"}),p=S("textarea",{placeholder:"Add a comment..."});p.value=P.comment||"",R.appendChild(p),B.appendChild(R);let x=S("div",{className:"ano-popover-actions"}),b=S("button",{className:"ano-popover-btn delete",onClick:()=>{e.events.emit("annotation:delete",w),i()}},"Delete"),C=S("button",{className:"ano-popover-btn",onClick:()=>i()},"Cancel"),$=S("button",{className:"ano-popover-btn save",onClick:()=>{t.update(w,{comment:p.value}),i()}},"Save");x.appendChild(b),x.appendChild(C),x.appendChild($),B.appendChild(x);let H=S("div",{className:"ano-popover-arrow"});B.appendChild(H),r.appendChild(B),requestAnimationFrame(()=>{l(B,H,L),p.focus();function g(y){n&&!n.shadowRoot.contains(y.target)&&!n.contains(y.target)&&(t.update(w,{comment:p.value}),i())}document.addEventListener("click",g,!0),a=()=>{document.removeEventListener("click",g,!0)}}),p.addEventListener("keydown",g=>{g.key==="Enter"&&(g.metaKey||g.ctrlKey)&&(t.update(w,{comment:p.value}),i()),g.key==="Escape"&&(t.update(w,{comment:p.value}),i()),g.stopPropagation()})}function l(w,L,P){let B=w.getBoundingClientRect(),R=window.innerWidth,p=window.innerHeight,x,b,C="top";x=P.bottom+8,x+B.height>p&&(x=P.top-B.height-8,C="bottom"),b=P.left+P.width/2-B.width/2,b=Math.max(8,Math.min(b,R-B.width-8)),w.style.top=`${x}px`,w.style.left=`${b}px`,L.className=`ano-popover-arrow ${C}`;let $=P.left+P.width/2-b-6;L.style.left=`${Math.max(12,Math.min($,B.width-24))}px`}function i(){if(a&&(a(),a=null),!r)return;let w=r.querySelector(".ano-popover");w&&w.remove(),o=null}function c(){return o!==null}function v(){return o}function m(w){n&&ne(n,w)}function A(){i(),n&&(n.remove(),n=null,r=null)}return{init:s,show:f,hide:i,isOpen:c,getCurrentId:v,updateTheme:m,destroy:A}}function Ye(e){let t=null,n=null;function r(m){i(),t=document.createElement("div"),t.dataset.ano="",n=t.attachShadow({mode:"open"});let A=document.createElement("style");A.textContent=ze,n.appendChild(A),ne(t,e.config.theme);let w=S("div",{className:"ano-end-overlay"});w.addEventListener("click",U=>{U.target===w&&l()});let L=S("div",{className:"ano-end-dialog"}),P=S("button",{className:"ano-end-close",onClick:()=>l()});P.appendChild(oe("close")),L.appendChild(S("div",{className:"ano-end-header"},S("h2",{},"Report Ready"),P));let B=S("div",{className:"ano-end-summary"});if(B.appendChild(o(f(m.duration),"Duration")),B.appendChild(o(String(m.actionCount),"Actions")),B.appendChild(o(String(m.pageCount),"Pages")),B.appendChild(o(String(m.annotationCount),"Annotations")),m.hasRecording){let U=S("div",{className:"ano-end-badge"});U.appendChild(oe("record")),U.appendChild(document.createTextNode("Video recorded")),B.appendChild(U)}if(L.appendChild(B),m.annotations&&m.annotations.length>0){let U=S("div",{className:"ano-end-annotations"});U.appendChild(S("h3",{},"Annotations"));let j=S("div",{className:"ano-end-ann-list"}),X=0;for(let h of m.annotations){if(h.type==="session"||h.type==="recording")continue;let T=S("div",{className:"ano-end-ann-card"});h.type==="highlight"?(T.appendChild(a("highlight","Highlight")),h.quote&&T.appendChild(S("div",{className:"ano-end-ann-text"},`"${s(h.quote,120)}"`))):h.type==="pin"?(X++,T.appendChild(a("pin",`Pin #${X}`)),h.target?.description&&T.appendChild(S("div",{className:"ano-end-ann-text"},h.target.description))):h.type==="drawing"&&T.appendChild(a("drawing","Drawing")),h.comment&&T.appendChild(S("div",{className:"ano-end-ann-comment"},h.comment)),j.appendChild(T)}U.appendChild(j),L.appendChild(U)}let R=S("div",{className:"ano-end-actions"}),p=S("button",{onClick:()=>l()},"Dismiss"),x=S("button",{onClick:()=>{x.textContent="Uploading\u2026",x.disabled=!0,e.events.emit("share")}},"Get Link"),b=S("div",{className:"ano-end-link-result"});b.style.display="none";let C=S("input",{readOnly:!0,className:"ano-end-link-input"}),$=S("button",{className:"ano-end-link-copy",onClick:()=>{navigator.clipboard.writeText(C.value).then(()=>{$.textContent="Copied!",setTimeout(()=>{$.textContent="Copy"},2e3)})}},"Copy");b.appendChild(C),b.appendChild($);let H=e.events.on("share:complete",U=>{x.style.display="none",C.value=U,b.style.display=""}),g=e.events.on("share:error",()=>{x.textContent="Failed \u2014 retry",x.disabled=!1}),y=i;i=function(){H(),g(),y()};let k=S("button",{className:"primary",onClick:()=>{e.events.emit("export:json"),l()}},"Export JSON");if(R.appendChild(p),R.appendChild(x),m.hasRecording){let U=S("button",{onClick:()=>{e.events.emit("export:video"),l()}},"Export Video");R.appendChild(U)}R.appendChild(k),L.appendChild(R),L.appendChild(b),w.appendChild(L),n.appendChild(w),document.body.appendChild(t)}function o(m,A){return S("div",{className:"ano-end-stat"},S("div",{className:"ano-end-stat-value"},m),S("div",{className:"ano-end-stat-label"},A))}function a(m,A){let w=S("div",{className:`ano-end-ann-type ${m}`});return w.appendChild(S("span",{className:"dot"})),w.appendChild(document.createTextNode(A)),w}function s(m,A){return!m||m.length<=A?m||"":m.slice(0,A)+"\u2026"}function f(m){let A=Math.floor((m||0)/1e3),w=Math.floor(A/60),L=A%60;return`${w}:${L.toString().padStart(2,"0")}`}function l(){i(),e.events.emit("session:dismissed")}function i(){t&&(t.remove(),t=null,n=null)}function c(){return t!==null}function v(){i()}return{show:r,hide:i,dismiss:l,isOpen:c,destroy:v}}function We(e){let t=!1,n={"alt+h":()=>{e.sessionState==="active"&&e.setMode("highlight")},"alt+p":()=>{e.sessionState==="active"&&e.setMode("pin")},"alt+d":()=>{e.sessionState==="active"&&e.setMode("draw")},"alt+n":()=>{e.sessionState==="active"&&e.setMode("navigate")},"alt+s":()=>{e.sessionState==="idle"?e.events.emit("session:start"):e.sessionState==="active"&&e.events.emit("session:end")},"alt+e":()=>e.events.emit("export"),escape:()=>{e.popover.isOpen()?e.popover.hide():e.sessionState==="active"?e.events.emit("session:end"):e.endDialog&&e.endDialog.isOpen()&&e.endDialog.dismiss()}};function r(i){let c=i.target.tagName;if(c==="INPUT"||c==="TEXTAREA"||c==="SELECT"){if(i.key==="Escape"&&(i.target.closest?.("[data-ano]")||a(i.target))){n.escape();return}return}let v=o(i);n[v]&&(i.preventDefault(),i.stopPropagation(),n[v]())}function o(i){let c=[];return i.altKey&&c.push("alt"),i.ctrlKey&&c.push("ctrl"),i.metaKey&&c.push("meta"),i.shiftKey&&c.push("shift"),c.push(i.key.toLowerCase()),c.join("+")}function a(i){let c=i;for(;c;){if(c.host&&c.host.dataset&&c.host.dataset.ano!==void 0)return!0;c=c.parentNode}return!1}function s(){t||(t=!0,document.addEventListener("keydown",r,!0))}function f(){t=!1,document.removeEventListener("keydown",r,!0)}function l(){f()}return{enable:s,disable:f,destroy:l}}function me(e,t=[]){let n=ie(e,t),r=JSON.stringify(n,null,2),o=new Blob([r],{type:"application/json"}),a=URL.createObjectURL(o),s=document.createElement("a");s.href=a,s.download=`annotations-${Ke()}.json`,s.style.display="none",document.body.appendChild(s),s.click(),setTimeout(()=>{URL.revokeObjectURL(a),s.remove()},100);let f=e.getByType("recording");for(let i of f)i.blob&&pe(i.blob,`recording-${i.id}.webm`);let l=e.getByType("session");for(let i of l)i.blob&&pe(i.blob,`session-${i.sessionId||i.id}.webm`);return n}function Ve(e,t=[]){let n=ie(e,t),r=JSON.stringify(n,null,2),o=new Blob([r],{type:"application/json"}),a=URL.createObjectURL(o),s=document.createElement("a");return s.href=a,s.download=`annotations-${Ke()}.json`,s.style.display="none",document.body.appendChild(s),s.click(),setTimeout(()=>{URL.revokeObjectURL(a),s.remove()},100),n}function qe(e){let t=e.getByType("recording");for(let r of t)r.blob&&pe(r.blob,`recording-${r.id}.webm`);let n=e.getByType("session");for(let r of n)r.blob&&pe(r.blob,`session-${r.sessionId||r.id}.webm`)}function pe(e,t){let n=URL.createObjectURL(e),r=document.createElement("a");r.href=n,r.download=t,r.style.display="none",document.body.appendChild(r),r.click(),setTimeout(()=>{URL.revokeObjectURL(n),r.remove()},100)}function ie(e,t=[]){let n=e.getAll().map(s=>{let f=Je(s);return f.pageUrl=f.pageUrl||window.location.href,f.pageTitle=f.pageTitle||document.title,f}),r=t.map(s=>{let f=Je(s);return f.pageUrl=f.pageUrl||s.pageUrl||"unknown",f.pageTitle=f.pageTitle||s.pageTitle||"",f}),o=new Set(n.map(s=>s.id)),a=[...n];for(let s of r)o.has(s.id)||(o.add(s.id),a.push(s));return a.sort((s,f)=>s.createdAt-f.createdAt),{version:"1.0",exportedAt:new Date().toISOString(),pageUrl:window.location.href,pageTitle:document.title,environment:St(),annotations:a,summary:Tt(a)}}function St(){let e=navigator,t=screen,n=e.connection||e.mozConnection||e.webkitConnection,r={userAgent:e.userAgent,platform:e.platform,language:e.language,languages:e.languages?[...e.languages]:[e.language],timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,timezoneOffset:new Date().getTimezoneOffset(),screen:{width:t.width,height:t.height,devicePixelRatio:window.devicePixelRatio,colorDepth:t.colorDepth,orientation:t.orientation?.type||null},viewport:{width:window.innerWidth,height:window.innerHeight},deviceMemory:e.deviceMemory||null,hardwareConcurrency:e.hardwareConcurrency||null,touchSupport:e.maxTouchPoints>0,cookiesEnabled:e.cookieEnabled,doNotTrack:e.doNotTrack||null};return n&&(r.connection={effectiveType:n.effectiveType||null,downlink:n.downlink||null,rtt:n.rtt||null,saveData:n.saveData||!1}),r}function Je(e){let t={};return t.id=e.id,t.type=e.type,t.comment=e.comment||"",t.createdAt=e.createdAt,e.type==="highlight"?(t.text=e.text,t.context=e.context||null,t._anchoring={selectors:e.selectors},e.color&&(t.color=e.color)):e.type==="pin"?(t.index=e.index,t.context=e.context||null,t._anchoring={targetSelector:e.targetSelector,targetMeta:e.targetMeta}):e.type==="drawing"?(t.context=e.context||null,t._anchoring={strokes:e.strokes,viewport:e.viewport}):e.type==="recording"?(t.duration=e.duration,t.region=e.region,t.context=e.context||null,t._anchoring={viewport:e.viewport,file:`recording-${e.id}.webm`}):e.type==="session"&&(t.duration=e.duration,t.pages=e.pages,t.context=e.context||null,t.sessionId=e.sessionId||null,t.annotationIds=e.annotationIds||[],t.hasRecording=e.hasRecording||!1,t._anchoring={actions:e.actions},e.blob&&(t._anchoring.file=`session-${e.sessionId||e.id}.webm`)),e.pageUrl&&(t.pageUrl=e.pageUrl),e.pageTitle&&(t.pageTitle=e.pageTitle),e._orphaned&&(t.orphaned=!0),t}function Tt(e){let t=new Map;for(let r of e){let o=r.pageUrl||"unknown";t.has(o)||t.set(o,[]),t.get(o).push(r)}let n=[];for(let[r,o]of t){t.size>1&&n.push(`
--- ${r} ---`);for(let a of o){let s=a.comment?` \u2014 "${a.comment}"`:"";if(a.type==="highlight"){let f=a.context?.element?` in <${a.context.element.tagName?.toLowerCase()||"element"}>`:"",l=a.context?.pagePath?` (${a.context.pagePath.join(" > ")})`:"";n.push(`[Highlight] "${Et(a.text,80)}"${f}${l}${s}`)}else if(a.type==="pin"){let f=a.context?.description||`element #${a.index}`;n.push(`[Pin #${a.index}] ${f}${s}`)}else if(a.type==="drawing"){let f=a.context?.description||"freehand drawing";n.push(`[Drawing] ${f}${s}`)}else if(a.type==="recording"){let f=Math.round((a.duration||0)/1e3),l=a.context?.description||"screen recording";n.push(`[Recording ${f}s] ${l}${s}`)}else if(a.type==="session"){let f=Math.round((a.duration||0)/1e3),l=a.context?.description||"session recording";n.push(`[Session ${f}s] ${l}${s}`)}}}return n.join(`
`).trim()}function Et(e,t){return e?e.length>t?e.slice(0,t)+"...":e:""}function Ke(){let e=new Date;return`${e.getFullYear()}-${de(e.getMonth()+1)}-${de(e.getDate())}_${de(e.getHours())}${de(e.getMinutes())}`}function de(e){return e.toString().padStart(2,"0")}function be(e){return new Promise(t=>{let n=document.createElement("input");n.type="file",n.accept=".json",n.style.display="none",document.body.appendChild(n),n.addEventListener("change",async()=>{let r=n.files[0];if(!r){n.remove(),t({success:!1,error:"No file selected"});return}try{let o=await r.text(),a=JSON.parse(o),s=se(e,a);t(s)}catch(o){t({success:!1,error:o.message})}finally{n.remove()}}),n.click()})}function se(e,t){if(!t||!t.annotations||!Array.isArray(t.annotations))return{success:!1,error:"Invalid annotation data"};let{store:n,highlightManager:r,pinManager:o,drawingManager:a}=e,s={imported:0,orphaned:0,orphans:[]};for(let f of t.annotations){let l={...f};l._anchoring&&(Object.assign(l,l._anchoring),delete l._anchoring);let i=n.add(l),c=!1;i.type==="highlight"?c=r.applyHighlight(i):i.type==="pin"?c=o.applyPin(i):i.type==="drawing"?c=a.applyDrawing(i):(i.type==="recording"||i.type==="session")&&(c=!0),c?s.imported++:(s.orphaned++,s.orphans.push(i.id),n.update(i.id,{_orphaned:!0}))}return{success:!0,...s}}var Ge="https://share.mk/files/";async function Qe(e,t){let n=await fetch(Ge,{method:"POST",headers:{"Tus-Resumable":"1.0.0","Upload-Length":String(e.byteLength),"Upload-Metadata":t.map(([s,f])=>`${s} ${btoa(f)}`).join(",")}});if(!n.ok)throw new Error(`Upload failed: ${n.status}`);let r=n.headers.get("Location");if(!r)throw new Error("No Location header in response");let o=r.startsWith("http")?r:new URL(r,Ge).href,a=await fetch(o,{method:"PATCH",headers:{"Tus-Resumable":"1.0.0","Upload-Offset":"0","Content-Type":"application/offset+octet-stream"},body:e});if(!a.ok)throw new Error(`Patch failed: ${a.status}`);return o}async function Ze(e,t,n){try{n.emit("share:uploading");let r=ie(e,t),o=[];for(let i of e.getAll())if((i.type==="recording"||i.type==="session")&&i.blob){let c=i.type==="recording"?`recording-${i.id}.webm`:`session-${i.sessionId||i.id}.webm`;o.push({id:i.id,type:i.type,sessionId:i.sessionId,blob:i.blob,filename:c})}let a=new Map;for(let i of o){let c=new Uint8Array(await i.blob.arrayBuffer()),v=await Qe(c,[["filename",i.filename],["content-type","video/webm"],["expires-in","7d"]]);a.set(i.filename,v)}if(a.size>0)for(let i of r.annotations)i._anchoring?.file&&a.has(i._anchoring.file)&&(i._anchoring.file=a.get(i._anchoring.file));let s=JSON.stringify(r,null,2),f=new TextEncoder().encode(s),l=await Qe(f,[["filename","annotations.json"],["content-type","application/json"],["expires-in","7d"]]);try{await navigator.clipboard.writeText(l)}catch{}return n.emit("share:complete",l),l}catch(r){return n.emit("share:error",r),null}}var et="ano:",re=null;function tt(e={}){if(re)return console.warn("[Ano] Already initialized. Call Ano.destroy() first."),re.api;let t=ve(e),n=we(),r=le(),o={config:t,store:n,events:r,mode:"navigate",sessionState:"idle",currentSessionId:null,toolbar:null,popover:null,endDialog:null,highlightManager:null,pinManager:null,drawingManager:null,recordingManager:null,sessionManager:null,shortcutManager:null,setMode:null};o.highlightManager=Ae(o),o.pinManager=Le(o),o.drawingManager=He(o),ce&&(o.recordingManager=je(o)),o.sessionManager=Xe(o),o.toolbar=_e(o),o.popover=Fe(o),o.endDialog=Ye(o),o.shortcutManager=We(o),o.setMode=c=>{o.sessionState!=="active"&&c!=="navigate"||(it(o,o.mode),o.mode=c,Mt(o,c),o.toolbar.setActive(c))},Lt(o),Pe(),o.drawingManager.init(),o.toolbar.render(),o.popover.init(),t.shortcuts&&o.shortcutManager.enable(),At(o);let a=null,s=n.on("change",()=>{a&&clearTimeout(a),a=setTimeout(()=>at(n),500)});n.on("add",c=>{o.sessionState==="active"&&o.currentSessionId&&c.type!=="session"&&!c.sessionId&&n.update(c.id,{sessionId:o.currentSessionId})});let f=()=>o.pinManager.repositionAll();window.addEventListener("scroll",f,{passive:!0}),window.addEventListener("resize",f,{passive:!0});let l=new MutationObserver(c=>{for(let v of c)for(let m of v.removedNodes)if(m.classList?.contains("ano-highlight")&&m.dataset?.anoId){let A=m.dataset.anoId;n.get(A)&&n.update(A,{_orphaned:!0})}});l.observe(document.body,{childList:!0,subtree:!0});let i={getAll:()=>n.getAll(),toJSON:()=>ie(n,ae()),export:()=>me(n,ae()),importFile:()=>be(o),import:c=>se(o,c),setMode:c=>o.setMode(c),share:()=>r.emit("share"),clear:()=>ot(),destroy:()=>rt(),startSession:()=>r.emit("session:start"),endSession:()=>r.emit("session:end")};return re={ctx:o,api:i,repositionHandler:f,observer:l,unsubPersist:s,persistTimer:a},i}function nt(){rt()}function ot(){if(!re)return;let{ctx:e}=re,{store:t,highlightManager:n,pinManager:r,drawingManager:o,sessionManager:a}=e;for(let s of t.getAll())s.type==="highlight"?n.removeHighlight(s.id):s.type==="pin"?r.removePin(s.id):s.type==="drawing"?o.removeDrawing(s.id):s.type==="session"?a.removeSession(s.id):s.type==="recording"&&e.recordingManager&&e.recordingManager.removeRecording(s.id);t.clear(),o.redrawAll(),Rt()}function rt(){if(!re)return;let{ctx:e,repositionHandler:t,observer:n,unsubPersist:r,persistTimer:o}=re;r&&r(),o&&clearTimeout(o),n.disconnect(),window.removeEventListener("scroll",t),window.removeEventListener("resize",t),e.shortcutManager.destroy(),e.popover.destroy(),e.endDialog.destroy(),e.toolbar.destroy(),e.highlightManager.destroy(),e.pinManager.destroy(),e.drawingManager.destroy(),e.recordingManager&&e.recordingManager.destroy(),e.sessionManager.destroy(),e._cleanupHighlightClick&&e._cleanupHighlightClick(),at(e.store),e.store.clear(),e.store.destroy(),e.events.clear(),Ue(),re=null}function Mt(e,t){switch(t){case"highlight":e.highlightManager.enable();break;case"pin":e.pinManager.enable();break;case"draw":e.drawingManager.enable();break;case"navigate":break}}function it(e,t){switch(t){case"highlight":e.highlightManager.disable();break;case"pin":e.pinManager.disable();break;case"draw":e.drawingManager.disable();break}}function Nt(e,t=5e3){return new Promise(n=>{let r=Date.now(),o=()=>{let a=e.getBlob();if(a){n(a);return}if(Date.now()-r>=t){n(null);return}setTimeout(o,100)};o()})}function ue(){return et+location.pathname}function at(e){try{let t=e.getAll().map($t);localStorage.setItem(ue(),JSON.stringify(t))}catch{}}function $t(e){let t={...e};return delete t.blob,delete t.blobUrl,delete t._marks,t.pageUrl||(t.pageUrl=window.location.href),t.pageTitle||(t.pageTitle=document.title),t}function ae(){let e=ue(),t=[];try{for(let n=0;n<localStorage.length;n++){let r=localStorage.key(n);if(!r.startsWith(et)||r===e)continue;let o=localStorage.getItem(r);if(!o)continue;let a=JSON.parse(o);Array.isArray(a)&&t.push(...a)}}catch{}return t}function At(e){try{let r=localStorage.getItem(ue());if(r){let o=JSON.parse(r);Array.isArray(o)&&o.length>0&&se(e,{annotations:o})}}catch{}let n=ae().filter(r=>r.type==="session"||r.type==="recording");if(n.length>0){let r=new Set(e.store.getAll().map(a=>a.id)),o=n.filter(a=>!r.has(a.id));o.length>0&&se(e,{annotations:o})}}function Rt(){try{localStorage.removeItem(ue())}catch{}}function Lt(e){let{store:t,events:n,popover:r,highlightManager:o,pinManager:a,drawingManager:s}=e;n.on("session:start",()=>{if(e.sessionState!=="idle")return;let l=e.sessionManager.start();e.sessionState="active",e.currentSessionId=l,e.toolbar.getVideoToggleState()&&e.recordingManager&&e.recordingManager.startRecording(),e.toolbar.renderActive(e.sessionManager.getStartTime()),e.setMode("navigate")}),n.on("session:end",async()=>{if(e.sessionState!=="active")return;let l=e.recordingManager?.isRecording(),i=e.sessionManager.stop();if(!i)return;l&&e.recordingManager.stopRecording(),it(e,e.mode),e.mode="navigate",e.sessionState="ending",e.toolbar.renderIdle();let c=null,v=null;l&&(c=await Nt(e.recordingManager),c&&(v=e.recordingManager.getBlobUrl()));let A=t.getAll().filter(P=>P.sessionId===i.sessionId&&P.type!=="session"),w=A.map(P=>P.id),L={type:"session",sessionId:i.sessionId,comment:"",duration:i.duration,actions:i.actions,pages:i.pages,context:{description:i.description},annotationIds:w,hasRecording:!!c};c&&(L.blob=c,L.blobUrl=v),t.add(L),e.endDialog.show({duration:i.duration,actionCount:i.actions.length,pageCount:i.pages.length,annotationCount:w.length,hasRecording:!!c,annotations:A})}),n.on("session:dismissed",()=>{e.sessionState="idle",e.currentSessionId=null,e.recordingManager&&e.recordingManager.clearBlob(),ot()}),n.on("session:action",l=>{e.toolbar.updateCount(l)}),n.on("session:resumed",l=>{e.sessionState="active",e.currentSessionId=l.sessionId,e.toolbar.renderActive(l.startTime)}),n.on("recording:stopped",l=>{if(e.sessionState==="ending"||e.sessionState==="idle"){let i=t.getByType("session");for(let c=i.length-1;c>=0;c--){let v=i[c];if(!v.blob&&v.hasRecording===!1&&l.blob){t.update(v.id,{blob:l.blob,blobUrl:l.blobUrl,hasRecording:!0});break}}}}),n.on("session:maxDuration",()=>{n.emit("session:end")}),n.on("highlight:created",l=>{let i=o.getMarksForAnnotation(l.id);if(i.length>0){let c=i[0].getBoundingClientRect();r.show(l.id,c)}}),n.on("pin:created",l=>{e.setMode("navigate");let i=document.querySelector(`[data-ano-id="${l.id}"]`);if(i){let c=i.getBoundingClientRect();r.show(l.id,c)}}),n.on("drawing:created",(l,i)=>{if(e.setMode("navigate"),i&&i.length>0){let c=i[i.length-1],v={x:c.x,y:c.y,top:c.y,left:c.x,bottom:c.y+1,right:c.x+1,width:1,height:1};r.show(l.id,v)}}),n.on("pin:click",l=>{let i=document.querySelector(`[data-ano-id="${l.id}"]`);if(i){let c=i.getBoundingClientRect();r.show(l.id,c)}}),n.on("annotation:focus",l=>{if(l.type==="highlight"){let i=o.getMarksForAnnotation(l.id);if(i.length>0){i[0].scrollIntoView({behavior:"smooth",block:"center"});let c=i[0].getBoundingClientRect();setTimeout(()=>r.show(l.id,c),300)}}else l.type==="pin"&&(a.scrollToPin(l.id),setTimeout(()=>{let i=document.querySelector(`[data-ano-id="${l.id}"]`);if(i){let c=i.getBoundingClientRect();r.show(l.id,c)}},300))}),n.on("annotation:delete",l=>{let i=t.get(l);i&&(i.type==="highlight"?o.removeHighlight(l):i.type==="pin"?a.removePin(l):i.type==="drawing"?s.removeDrawing(l):i.type==="recording"&&e.recordingManager?e.recordingManager.removeRecording(l):i.type==="session"&&e.sessionManager.removeSession(l),t.remove(l))}),n.on("export",()=>{me(t,ae())}),n.on("export:json",()=>{Ve(t,ae())}),n.on("export:video",()=>{qe(t)}),n.on("import",()=>{be(e)}),n.on("share",()=>{Ze(t,ae(),n)});function f(l){let i=l.target.closest?.(".ano-highlight");if(i&&i.dataset.anoId){l.stopPropagation();let c=i.getBoundingClientRect();r.show(i.dataset.anoId,c);return}if(e.mode==="navigate"){let c=s.hitTest(l.clientX,l.clientY);if(c){l.stopPropagation();let v={x:l.clientX,y:l.clientY,top:l.clientY,left:l.clientX,bottom:l.clientY+1,right:l.clientX+1,width:1,height:1};r.show(c.id,v)}}}document.addEventListener("click",f,!0),e._cleanupHighlightClick=()=>{document.removeEventListener("click",f,!0)}}var Y=null;function Ot(e={}){return Y=tt(e),Y}function Dt(){Y&&Y.clear()}function Bt(){nt(),Y=null}function zt(){return Y?Y.getAll():[]}function Pt(){return Y?Y.toJSON():null}function Ut(){if(Y)return Y.export()}function Ht(){if(Y)return Y.importFile()}function jt(e){if(Y)return Y.import(e)}function Xt(e){Y&&Y.setMode(e)}function _t(){Y&&Y.startSession()}function Ft(){Y&&Y.endSession()}return ft(Yt);})();
