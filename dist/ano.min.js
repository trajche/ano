var Ano=(()=>{var he=Object.defineProperty;var ct=Object.getOwnPropertyDescriptor;var dt=Object.getOwnPropertyNames;var pt=Object.prototype.hasOwnProperty;var ut=(e,t)=>{for(var o in t)he(e,o,{get:t[o],enumerable:!0})},ft=(e,t,o,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of dt(t))!pt.call(e,a)&&a!==o&&he(e,a,{get:()=>t[a],enumerable:!(r=ct(t,a))||r.enumerable});return e};var gt=e=>ft(he({},"__esModule",{value:!0}),e);var Wt={};ut(Wt,{clear:()=>Bt,destroy:()=>Pt,endSession:()=>Yt,export:()=>Ht,getAll:()=>Ut,import:()=>_t,importFile:()=>jt,init:()=>Dt,setMode:()=>Ft,startSession:()=>Xt,toJSON:()=>zt});var ht={theme:"light",mode:"navigate",highlightColor:"#fde047",pinColor:"#3b82f6",drawColor:"#ef4444",drawWidth:3,shortcuts:!0,recordMaxDuration:3e4,recordFrameRate:30,sessionMaxDuration:3e5,videoRecording:!1};function Se(e={}){return{...ht,...e}}function ce(){let e=new Map;return{on(t,o){return e.has(t)||e.set(t,new Set),e.get(t).add(o),()=>e.get(t)?.delete(o)},off(t,o){e.get(t)?.delete(o)},emit(t,...o){e.get(t)?.forEach(r=>r(...o))},clear(){e.clear()}}}var Te="abcdefghijklmnopqrstuvwxyz0123456789";function Me(){let e="",t=crypto.getRandomValues(new Uint8Array(8));for(let o=0;o<8;o++)e+=Te[t[o]%Te.length];return e}function Ee(){let e=new Map,t=ce(),o=0,r=new Set(["highlight","pin","drawing"]);function a(x){let w=x.id||Me(),u={...x,id:w,createdAt:x.createdAt||Date.now()};return r.has(u.type)&&(u.index==null?(o++,u.index=o):u.index>o&&(o=u.index)),e.set(w,u),t.emit("add",u),t.emit("change",{type:"add",annotation:u}),u}function n(x,w){let u=e.get(x);if(!u)return null;let C={...u,...w,id:x};return e.set(x,C),t.emit("update",C),t.emit("change",{type:"update",annotation:C}),C}function s(x){let w=e.get(x);return w?(e.delete(x),t.emit("remove",w),t.emit("change",{type:"remove",annotation:w}),!0):!1}function p(x){return e.get(x)||null}function l(){return Array.from(e.values())}function i(x){return l().filter(w=>w.type===x)}function c(){let x=l();e.clear(),o=0,t.emit("clear",x),t.emit("change",{type:"clear",annotations:x})}function A(){let x=l().filter(w=>r.has(w.type)&&w.index!=null);o=x.length>0?Math.max(...x.map(w=>w.index)):0}return{add:a,update:n,remove:s,get:p,getAll:l,getByType:i,clear:c,resetCounter:A,on:t.on,off:t.off,emit:t.emit,destroy:t.clear}}function Ne(e){let t=e.toString();if(!t)return null;let o=document.body,r=o.textContent||"",a=document.createRange();a.setStart(o,0),a.setEnd(e.startContainer,e.startOffset);let n=a.toString(),s=Math.max(0,n.length-32),p=n.slice(s),l=document.createRange();l.setStart(e.endContainer,e.endOffset),l.setEnd(o,o.childNodes.length);let c=l.toString().slice(0,32);return{type:"TextQuoteSelector",exact:t,prefix:p,suffix:c}}function Ae(e){if(!e||!e.exact)return null;let o=document.body.textContent||"",{exact:r,prefix:a,suffix:n}=e,s=[],p=0;for(;;){let c=o.indexOf(r,p);if(c===-1)break;s.push(c),p=c+1}if(s.length===0)return null;let l=s[0],i=-1;for(let c of s){let A=0;if(a){let x=o.slice(Math.max(0,c-a.length),c);x===a?A+=2:x.endsWith(a.slice(-8))&&(A+=1)}if(n){let x=o.slice(c+r.length,c+r.length+n.length);x===n?A+=2:x.startsWith(n.slice(0,8))&&(A+=1)}A>i&&(i=A,l=c)}return mt(l,l+r.length)}function mt(e,t){let o=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT),r=0,a=null,n=0,s=null,p=0;for(;o.nextNode();){let l=o.currentNode,i=l.textContent.length;if(!a&&r+i>e&&(a=l,n=e-r),r+i>=t){s=l,p=t-r;break}r+=i}if(!a||!s)return null;try{let l=document.createRange();return l.setStart(a,n),l.setEnd(s,p),l}catch{return null}}function $e(e){let t=document.body,o=document.createRange();o.setStart(t,0),o.setEnd(e.startContainer,e.startOffset);let r=o.toString().length,a=r+e.toString().length;return{type:"TextPositionSelector",start:r,end:a}}function Re(e){if(!e||e.start==null||e.end==null)return null;let{start:t,end:o}=e,r=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT),a=0,n=null,s=0,p=null,l=0;for(;r.nextNode();){let i=r.currentNode,c=i.textContent.length;if(!n&&a+c>t&&(n=i,s=t-a),a+c>=o){p=i,l=o-a;break}a+=c}if(!n||!p)return null;try{let i=document.createRange();return i.setStart(n,s),i.setEnd(p,l),i}catch{return null}}function ee(e){if(e.id){let a=`#${CSS.escape(e.id)}`;if(Le(a))return a}let t=[],o=e;for(;o&&o!==document.body&&o!==document.documentElement;){let a=o.tagName.toLowerCase();if(o.id){a=`#${CSS.escape(o.id)}`,t.unshift(a);break}let n=o.parentElement;if(n){let s=Array.from(n.children).filter(p=>p.tagName===o.tagName);if(s.length>1){let p=s.indexOf(o)+1;a+=`:nth-of-type(${p})`}}t.unshift(a),o=n}t[0]&&!t[0].startsWith("#")&&t.unshift("body");let r=t.join(" > ");return Le(r),r}function me(e){return{tagName:e.tagName,textContent:(e.textContent||"").trim().slice(0,100),className:e.className||""}}function ve(e,t){try{let o=document.querySelector(e);if(o)return o}catch{}if(t){let o=document.querySelectorAll(t.tagName?.toLowerCase()||"*");for(let r of o)if((r.textContent||"").trim().slice(0,100)===t.textContent)return r}return null}function Le(e){try{return document.querySelectorAll(e).length===1}catch{return!1}}function Ie(e){if(!e)return null;if(e.textPosition){let t=Re(e.textPosition);if(t&&vt(t,e.textQuote?.exact))return t}if(e.textQuote){let t=Ae(e.textQuote);if(t)return t}return null}function vt(e,t){return t?e.toString()===t:!0}function De(e){let{store:t,config:o}=e,r=!1,a=new Map,n=new Map;function s(){r||(r=!0,document.addEventListener("mouseup",l,!0))}function p(){r=!1,document.removeEventListener("mouseup",l,!0)}function l(v){if(Oe(v.target))return;let S=window.getSelection();if(!S||S.isCollapsed||!S.rangeCount)return;let m=S.getRangeAt(0),I=m.toString().trim();if(!I)return;let U={textQuote:Ne(m),textPosition:$e(m)},H=L(m,I),b=i(m);if(b.length===0)return;let y=t.add({type:"highlight",text:I,comment:"",selectors:U,context:H,color:o.highlightColor});a.set(y.id,b),b.forEach(h=>{h.dataset.anoId=y.id}),y.index!=null&&x(y,b[0]),S.removeAllRanges(),e.events.emit("highlight:created",y)}function i(v){let S=[],m=c(v);if(m.length===0)return S;for(let I=0;I<m.length;I++){let U=m[I],H=0,b=U.textContent.length;if(I===0&&(H=U===v.startContainer?v.startOffset:0),I===m.length-1&&(b=U===v.endContainer?v.endOffset:U.textContent.length),H===b)continue;let y=U;H>0&&(y=U.splitText(H),b-=H),b<y.textContent.length&&y.splitText(b);let h=document.createElement("mark");h.className="ano-highlight",y.parentNode.insertBefore(h,y),h.appendChild(y),S.push(h)}return S}function c(v){let S=[],m=document.createTreeWalker(v.commonAncestorContainer.nodeType===Node.TEXT_NODE?v.commonAncestorContainer.parentNode:v.commonAncestorContainer,NodeFilter.SHOW_TEXT),I=!1;for(;m.nextNode();){let U=m.currentNode;if((U===v.startContainer||v.startContainer.nodeType!==Node.TEXT_NODE&&v.startContainer.contains(U))&&(I=!0),I&&!Oe(U.parentNode)&&S.push(U),U===v.endContainer||v.endContainer.nodeType!==Node.TEXT_NODE&&v.endContainer.contains(U))break}return S}function A(v){if(a.has(v.id))return!0;let S=Ie(v.selectors);if(!S)return!1;let m=i(S);return m.length===0?!1:(a.set(v.id,m),m.forEach(I=>{I.dataset.anoId=v.id,v.color&&I.style.setProperty("--ano-hl-color",v.color)}),v.index!=null&&x(v,m[0]),!0)}function x(v,S){let m=document.createElement("div");m.className="ano-highlight-marker",m.dataset.ano="",m.dataset.anoId=v.id,m.textContent=v.index,m.style.setProperty("--ano-pin-color",o.pinColor),document.body.appendChild(m),w(m,S),n.set(v.id,m),m.addEventListener("click",I=>{I.stopPropagation();let U=m.getBoundingClientRect();e.popover.show(v.id,U)})}function w(v,S){let m=S.getBoundingClientRect();v.style.left=`${m.left+window.scrollX-20}px`,v.style.top=`${m.top+window.scrollY-20}px`}function u(){for(let[v,S]of n){let m=a.get(v);m&&m.length>0&&document.body.contains(m[0])&&w(S,m[0])}}function C(v){let S=a.get(v);if(!S)return;for(let I of S){let U=I.parentNode;if(U){for(;I.firstChild;)U.insertBefore(I.firstChild,I);U.removeChild(I),U.normalize()}}a.delete(v);let m=n.get(v);m&&(m.remove(),n.delete(v))}function O(){for(let v of[...a.keys()])C(v)}function P(v){return a.get(v)||[]}function L(v,S){let m=v.commonAncestorContainer;m.nodeType===Node.TEXT_NODE&&(m=m.parentElement);let I=$(m),U={selector:ee(I),tagName:I.tagName,text:X(_(I),200)},H=[],b=I;for(;b&&b!==document.body;){let J=b.tagName.toLowerCase(),K=b.id?`#${b.id}`:"",g=b.getAttribute("role")||"",M=J+K;g&&(M+=`[role=${g}]`),H.unshift(M),b=b.parentElement}let y=I.textContent||"",h=y.indexOf(S),F="";if(h!==-1){let J=y.slice(Math.max(0,h-80),h).trim(),K=y.slice(h+S.length,h+S.length+80).trim();F=(J?"..."+J+" ":"")+"["+X(S,100)+"]"+(K?" "+K+"...":"")}return{element:U,pagePath:H,surroundingText:F}}function $(v){let S=new Set(["P","H1","H2","H3","H4","H5","H6","LI","TD","TH","BLOCKQUOTE","FIGCAPTION","CAPTION","LABEL","A","BUTTON","ARTICLE","SECTION","NAV","HEADER","FOOTER","MAIN","ASIDE","DETAILS","SUMMARY"]),m=v;for(;m&&m!==document.body;){if(S.has(m.tagName)||m.id||m.getAttribute("role"))return m;m=m.parentElement}return v}function _(v){if(v.children.length===0)return(v.textContent||"").trim();let S="";for(let m of v.childNodes)if(m.nodeType===Node.TEXT_NODE)S+=m.textContent;else if(m.nodeType===Node.ELEMENT_NODE){let I=getComputedStyle(m).display;(I==="inline"||I==="inline-block")&&(S+=m.textContent)}return S.trim()||(v.textContent||"").trim().slice(0,200)}function X(v,S){return v.length>S?v.slice(0,S)+"...":v}function Y(){p(),O()}return{enable:s,disable:p,applyHighlight:A,removeHighlight:C,removeAll:O,repositionAll:u,getMarksForAnnotation:P,destroy:Y}}function Oe(e){if(!e)return!1;if(e.closest&&e.closest("[data-ano]"))return!0;let t=e;for(;t;){if(t.host&&t.host.dataset&&t.host.dataset.ano!==void 0||t.dataset&&t.dataset.ano!==void 0)return!0;t=t.parentNode}return!1}function Be(e){let{store:t,config:o}=e,r=!1,a=new Map,n=null,s=null,p=null;function l(){r||(r=!0,c(),document.addEventListener("mousemove",w,!0))}function i(){r=!1,A(),document.removeEventListener("mousemove",w,!0)}function c(){s=document.createElement("div"),s.className="ano-pin-overlay active",s.dataset.ano="",s.addEventListener("click",u,!0),s.addEventListener("mousemove",x),document.body.appendChild(s),n=document.createElement("div"),n.className="ano-pin-hover-outline",n.dataset.ano="",document.body.appendChild(n)}function A(){s&&(s.removeEventListener("click",u,!0),s.removeEventListener("mousemove",x),s.remove(),s=null),n&&(n.remove(),n=null)}function x(b){s.style.pointerEvents="none";let y=document.elementFromPoint(b.clientX,b.clientY);if(s.style.pointerEvents="auto",y&&y.tagName==="IFRAME"){let h=y.getBoundingClientRect();try{y.contentWindow?.postMessage({source:"ano-parent",type:"pin:hover",x:b.clientX-h.left,y:b.clientY-h.top},"*")}catch{}n.style.display="none",p=y;return}if(p){try{p.contentWindow?.postMessage({source:"ano-parent",type:"pin:hover:clear"},"*")}catch{}p=null}if(y&&y!==document.body&&y!==document.documentElement&&!de(y)){let h=y.getBoundingClientRect();n.style.display="block",n.style.left=`${h.left+window.scrollX}px`,n.style.top=`${h.top+window.scrollY}px`,n.style.width=`${h.width}px`,n.style.height=`${h.height}px`}else n.style.display="none"}function w(){}function u(b){b.preventDefault(),b.stopPropagation(),s.style.pointerEvents="none";let y=document.elementFromPoint(b.clientX,b.clientY);if(s.style.pointerEvents="auto",y&&y.tagName==="IFRAME"){let g=y.getBoundingClientRect();try{y.contentWindow?.postMessage({source:"ano-parent",type:"pin:click",x:b.clientX-g.left,y:b.clientY-g.top},"*")}catch{}e.setMode("navigate");return}if(!y||y===document.body||y===document.documentElement||de(y))return;let h=ee(y),F=me(y),J=m(y),K=t.add({type:"pin",comment:"",targetSelector:h,targetMeta:F,context:J});C(K,y),e.events.emit("pin:created",K)}function C(b,y){let h=document.createElement("div");h.className="ano-pin-marker",h.dataset.ano="",h.dataset.anoId=b.id,h.textContent=b.index,h.style.setProperty("--ano-pin-color",o.pinColor),document.body.appendChild(h),O(h,y),a.set(b.id,{marker:h,target:y}),h.addEventListener("click",F=>{F.stopPropagation(),e.events.emit("pin:click",b)})}function O(b,y){let h=y.getBoundingClientRect();b.style.left=`${h.left+window.scrollX-20}px`,b.style.top=`${h.top+window.scrollY-20}px`}function P(){for(let[b,{marker:y,target:h}]of a)document.body.contains(h)&&O(y,h)}function L(b){if(a.has(b.id))return!0;let y=ve(b.targetSelector,b.targetMeta);return y?(C(b,y),!0):!1}function $(b){let y=a.get(b);y&&(y.marker.remove(),a.delete(b))}function _(){for(let[b]of[...a])$(b)}function X(b,y){if(!r||!n)return;s&&(s.style.pointerEvents="none");let h=document.elementFromPoint(b,y);if(s&&(s.style.pointerEvents="auto"),h&&h!==document.body&&h!==document.documentElement&&!de(h)){let F=h.getBoundingClientRect();n.style.display="block",n.style.left=`${F.left+window.scrollX}px`,n.style.top=`${F.top+window.scrollY}px`,n.style.width=`${F.width}px`,n.style.height=`${F.height}px`}else n.style.display="none"}function Y(b,y){if(!r)return;s&&(s.style.pointerEvents="none");let h=document.elementFromPoint(b,y);if(s&&(s.style.pointerEvents="auto"),!h||h===document.body||h===document.documentElement||de(h))return;let F=ee(h),J=me(h),K=m(h),g=t.add({type:"pin",comment:"",targetSelector:F,targetMeta:J,context:K});C(g,h),e.events.emit("pin:created",g)}function v(){n&&(n.style.display="none")}function S(b){let y=a.get(b);y&&y.target.scrollIntoView({behavior:"smooth",block:"center"})}function m(b){let y=b.tagName.toLowerCase(),h={},F=["href","src","action","type","name","placeholder","value","alt","title","role","aria-label","aria-describedby","data-testid","for","method"];for(let R of F){let j=b.getAttribute(R);j&&(h[R]=j.length>120?j.slice(0,120)+"...":j)}let J=I(b),K=[],g=b;for(;g&&g!==document.body;){let R=g.tagName.toLowerCase();if(g.id)R+=`#${g.id}`;else if(g.className&&typeof g.className=="string"){let j=g.className.trim().split(/\s+/).slice(0,2).join(".");j&&(R+=`.${j}`)}g.getAttribute("role")&&(R+=`[role=${g.getAttribute("role")}]`),K.unshift(R),g=g.parentElement}let M=[],E=b.parentElement;if(E)for(let R of E.children){if(R===b)continue;let j=R.tagName.toLowerCase(),V=U((R.textContent||"").trim(),60);if(V&&M.push(`${j}("${V}")`),M.length>=4)break}let T=`${y}`;J&&(T+=`("${U(J,80)}")`),h.type&&(T+=`[type=${h.type}]`),h.href&&(T+=`[href=${U(h.href,60)}]`),h.role&&(T+=`[role=${h.role}]`);let D=E?E.tagName.toLowerCase():"";return D&&(T+=` inside ${D}`),E?.id&&(T+=`#${E.id}`),{description:T,attributes:Object.keys(h).length>0?h:void 0,visibleText:J||void 0,pagePath:K,siblings:M.length>0?M:void 0}}function I(b){let y=b.getAttribute("aria-label");if(y)return y.trim();let h=b.getAttribute("alt");if(h)return h.trim();let F=b.getAttribute("title");if(F)return F.trim();let J="";for(let K of b.childNodes)K.nodeType===Node.TEXT_NODE&&(J+=K.textContent);return J=J.trim(),J||(b.textContent||"").trim().slice(0,150)}function U(b,y){return b.length>y?b.slice(0,y)+"...":b}function H(){i(),_()}return{enable:l,disable:i,applyPin:L,removePin:$,removeAll:_,repositionAll:P,scrollToPin:S,hoverAt:X,clickAt:Y,clearHover:v,destroy:H}}function de(e){if(!e)return!1;let t=e;for(;t;){if(t.dataset&&t.dataset.ano!==void 0||t.host&&t.host.dataset&&t.host.dataset.ano!==void 0)return!0;t=t.parentNode}return!1}var Pe={light:{"--ano-bg":"#ffffff","--ano-bg-secondary":"#f8fafc","--ano-bg-hover":"#f1f5f9","--ano-border":"#e2e8f0","--ano-text":"#1e293b","--ano-text-secondary":"#64748b","--ano-accent":"#3b82f6","--ano-accent-hover":"#2563eb","--ano-highlight":"#fde047","--ano-pin":"#3b82f6","--ano-draw":"#ef4444","--ano-danger":"#ef4444","--ano-danger-hover":"#dc2626","--ano-shadow":"0 4px 24px rgba(0,0,0,0.12)","--ano-shadow-sm":"0 2px 8px rgba(0,0,0,0.08)"},dark:{"--ano-bg":"#1e293b","--ano-bg-secondary":"#0f172a","--ano-bg-hover":"#334155","--ano-border":"#475569","--ano-text":"#f1f5f9","--ano-text-secondary":"#94a3b8","--ano-accent":"#60a5fa","--ano-accent-hover":"#3b82f6","--ano-highlight":"#fbbf24","--ano-pin":"#60a5fa","--ano-draw":"#f87171","--ano-danger":"#f87171","--ano-danger-hover":"#ef4444","--ano-shadow":"0 4px 24px rgba(0,0,0,0.4)","--ano-shadow-sm":"0 2px 8px rgba(0,0,0,0.3)"}};var Ue=`
  :host {
    all: initial;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  .ano-toolbar {
    position: fixed;
    top: 12px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 2px;
    padding: 4px;
    background: var(--ano-bg);
    border: 1px solid var(--ano-border);
    border-radius: 10px;
    box-shadow: var(--ano-shadow);
    z-index: 2147483646;
    user-select: none;
  }
  .ano-toolbar-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    border-radius: 8px;
    border: none;
    background: transparent;
    color: var(--ano-text-secondary);
    cursor: pointer;
    transition: all 0.15s;
    font-size: 18px;
    position: relative;
  }
  .ano-toolbar-btn:hover {
    background: var(--ano-bg-hover);
    color: var(--ano-text);
  }
  .ano-toolbar-btn.active {
    background: var(--ano-accent);
    color: #fff;
  }
  .ano-toolbar-btn .tooltip {
    position: absolute;
    bottom: -30px;
    left: 50%;
    transform: translateX(-50%);
    padding: 3px 8px;
    background: var(--ano-text);
    color: var(--ano-bg);
    font-size: 11px;
    border-radius: 4px;
    white-space: nowrap;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.15s;
  }
  .ano-toolbar-btn:hover .tooltip {
    opacity: 1;
  }
  .ano-toolbar-divider {
    width: 1px;
    margin: 6px 3px;
    background: var(--ano-border);
    flex-shrink: 0;
  }
  .ano-start-session {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 6px 14px;
    border-radius: 8px;
    border: none;
    background: var(--ano-accent);
    color: #fff;
    cursor: pointer;
    transition: all 0.15s;
    font-size: 13px;
    font-weight: 600;
    font-family: inherit;
    white-space: nowrap;
  }
  .ano-start-session:hover {
    background: var(--ano-accent-hover);
  }
  .ano-video-toggle {
    display: flex;
    align-items: center;
    gap: 5px;
    padding: 0 8px;
    font-size: 12px;
    color: var(--ano-text-secondary);
    cursor: pointer;
    user-select: none;
    white-space: nowrap;
  }
  .ano-video-toggle input {
    margin: 0;
    cursor: pointer;
  }
  .ano-session-status {
    display: flex;
    align-items: center;
    gap: 8px;
  }
  @keyframes ano-pulse-dot { 0%,100%{opacity:1} 50%{opacity:.3} }
  .ano-session-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: #22c55e;
    animation: ano-pulse-dot 1s ease-in-out infinite;
    flex-shrink: 0;
  }
  .ano-session-timer {
    font-size: 13px;
    font-weight: 600;
    font-variant-numeric: tabular-nums;
    color: var(--ano-text);
    min-width: 36px;
  }
  .ano-session-count {
    font-size: 12px;
    color: var(--ano-text-secondary);
    white-space: nowrap;
  }
  .ano-end-session {
    display: flex;
    align-items: center;
    gap: 5px;
    padding: 5px 12px;
    border-radius: 8px;
    border: none;
    background: var(--ano-danger);
    color: #fff;
    cursor: pointer;
    transition: all 0.15s;
    font-size: 12px;
    font-weight: 600;
    font-family: inherit;
    white-space: nowrap;
  }
  .ano-end-session:hover {
    background: var(--ano-danger-hover);
  }
  .ano-btn-label {
    font-family: inherit;
  }
`,ze=`
  :host {
    all: initial;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    font-size: 14px;
    color: var(--ano-text);
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  .ano-popover {
    position: fixed;
    width: 280px;
    background: var(--ano-bg);
    border: 1px solid var(--ano-border);
    border-radius: 10px;
    box-shadow: var(--ano-shadow);
    z-index: 2147483647;
    overflow: hidden;
  }
  .ano-popover-body {
    padding: 12px;
  }
  .ano-popover textarea {
    width: 100%;
    min-height: 60px;
    padding: 8px;
    border: 1px solid var(--ano-border);
    border-radius: 6px;
    background: var(--ano-bg-secondary);
    color: var(--ano-text);
    font-family: inherit;
    font-size: 13px;
    resize: vertical;
    outline: none;
    transition: border-color 0.15s;
  }
  .ano-popover textarea:focus {
    border-color: var(--ano-accent);
  }
  .ano-popover-actions {
    display: flex;
    justify-content: flex-end;
    gap: 6px;
    padding: 8px 12px;
    border-top: 1px solid var(--ano-border);
    background: var(--ano-bg-secondary);
  }
  .ano-popover-btn {
    padding: 5px 12px;
    border-radius: 6px;
    border: 1px solid var(--ano-border);
    background: var(--ano-bg);
    color: var(--ano-text);
    font-size: 12px;
    cursor: pointer;
    transition: all 0.15s;
  }
  .ano-popover-btn:hover {
    background: var(--ano-bg-hover);
  }
  .ano-popover-btn.save {
    background: var(--ano-accent);
    color: #fff;
    border-color: var(--ano-accent);
  }
  .ano-popover-btn.save:hover {
    background: var(--ano-accent-hover);
  }
  .ano-popover-btn.delete {
    color: var(--ano-danger);
    border-color: var(--ano-danger);
  }
  .ano-popover-btn.delete:hover {
    background: var(--ano-danger);
    color: #fff;
  }
  .ano-popover-arrow {
    position: absolute;
    width: 12px;
    height: 12px;
    background: var(--ano-bg);
    border: 1px solid var(--ano-border);
    transform: rotate(45deg);
  }
  .ano-popover-arrow.top {
    bottom: -7px;
    border-top: none;
    border-left: none;
  }
  .ano-popover-arrow.bottom {
    top: -7px;
    border-bottom: none;
    border-right: none;
  }
`,He=`
  :host {
    all: initial;
  }
  .ano-canvas-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    z-index: 2147483645;
    pointer-events: none;
  }
  .ano-canvas-overlay.active {
    pointer-events: auto;
    cursor: crosshair;
  }
`,bt=`
  .ano-highlight {
    background-color: var(--ano-hl-color, #fde047);
    cursor: pointer;
    border-radius: 2px;
    transition: background-color 0.15s;
  }
  .ano-highlight:hover {
    filter: brightness(0.9);
  }
`,yt=`
  .ano-pin-marker {
    position: absolute;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: var(--ano-pin-color, #3b82f6);
    color: #fff;
    font-size: 12px;
    font-weight: 700;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 2147483644;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    transition: transform 0.15s;
    pointer-events: auto;
    user-select: none;
  }
  .ano-pin-marker:hover {
    transform: scale(1.2);
  }
  .ano-highlight-marker, .ano-drawing-marker {
    position: absolute;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: var(--ano-pin-color, #3b82f6);
    color: #fff;
    font-size: 12px;
    font-weight: 700;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 2147483644;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    transition: transform 0.15s;
    pointer-events: auto;
    user-select: none;
  }
  .ano-highlight-marker:hover, .ano-drawing-marker:hover {
    transform: scale(1.2);
  }
  .ano-pin-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    z-index: 2147483643;
    pointer-events: none;
  }
  .ano-pin-overlay.active {
    pointer-events: auto;
    cursor: crosshair;
  }
  .ano-pin-hover-outline {
    position: absolute;
    border: 2px dashed #3b82f6;
    background: rgba(59, 130, 246, 0.08);
    border-radius: 3px;
    pointer-events: none;
    z-index: 2147483643;
    transition: all 0.1s;
  }
`,je=`
  :host {
    all: initial;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    font-size: 14px;
    color: var(--ano-text);
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  .ano-end-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0,0,0,0.4);
    z-index: 2147483647;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .ano-end-dialog {
    background: var(--ano-bg);
    border: 1px solid var(--ano-border);
    border-radius: 14px;
    box-shadow: var(--ano-shadow);
    width: 400px;
    max-width: 90vw;
    overflow: hidden;
  }
  .ano-end-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px 20px;
    border-bottom: 1px solid var(--ano-border);
  }
  .ano-end-header h2 {
    font-size: 16px;
    font-weight: 700;
    color: var(--ano-text);
  }
  .ano-end-close {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 28px;
    height: 28px;
    border-radius: 6px;
    border: none;
    background: transparent;
    color: var(--ano-text-secondary);
    cursor: pointer;
    transition: all 0.15s;
    font-size: 18px;
  }
  .ano-end-close:hover {
    background: var(--ano-bg-hover);
    color: var(--ano-text);
  }
  .ano-end-summary {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    padding: 20px;
  }
  .ano-end-stat {
    padding: 12px;
    border-radius: 10px;
    background: var(--ano-bg-secondary);
    border: 1px solid var(--ano-border);
    text-align: center;
  }
  .ano-end-stat-value {
    font-size: 22px;
    font-weight: 700;
    color: var(--ano-text);
    font-variant-numeric: tabular-nums;
  }
  .ano-end-stat-label {
    font-size: 11px;
    color: var(--ano-text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-top: 2px;
  }
  .ano-end-badge {
    grid-column: 1 / -1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    padding: 8px;
    border-radius: 8px;
    background: var(--ano-bg-secondary);
    border: 1px solid var(--ano-border);
    font-size: 12px;
    color: var(--ano-text-secondary);
  }
  .ano-end-actions {
    display: flex;
    gap: 8px;
    padding: 16px 20px;
    border-top: 1px solid var(--ano-border);
    justify-content: flex-end;
  }
  .ano-end-actions button {
    padding: 7px 16px;
    border-radius: 8px;
    border: 1px solid var(--ano-border);
    background: var(--ano-bg);
    color: var(--ano-text);
    font-size: 13px;
    font-family: inherit;
    cursor: pointer;
    transition: all 0.15s;
  }
  .ano-end-actions button:hover {
    background: var(--ano-bg-hover);
  }
  .ano-end-actions button.primary {
    background: var(--ano-accent);
    color: #fff;
    border-color: var(--ano-accent);
  }
  .ano-end-actions button.primary:hover {
    background: var(--ano-accent-hover);
  }
  .ano-end-actions button:disabled {
    opacity: 0.5;
    cursor: default;
  }
  .ano-end-link-result {
    display: flex;
    gap: 6px;
    padding: 0 20px 16px;
  }
  .ano-end-link-input {
    flex: 1;
    padding: 7px 10px;
    border-radius: 8px;
    border: 1px solid var(--ano-border);
    background: var(--ano-bg-secondary);
    color: var(--ano-text);
    font-size: 12px;
    font-family: monospace;
    outline: none;
  }
  .ano-end-link-copy {
    padding: 7px 14px;
    border-radius: 8px;
    border: 1px solid var(--ano-accent);
    background: var(--ano-accent);
    color: #fff;
    font-size: 13px;
    font-family: inherit;
    cursor: pointer;
    transition: all 0.15s;
    white-space: nowrap;
  }
  .ano-end-link-copy:hover {
    background: var(--ano-accent-hover);
  }
  .ano-end-annotations {
    padding: 0 20px 16px;
  }
  .ano-end-annotations h3 {
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--ano-text-secondary);
    margin-bottom: 8px;
  }
  .ano-end-ann-list {
    max-height: 280px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 6px;
  }
  .ano-end-ann-card {
    padding: 8px 10px;
    border: 1px solid var(--ano-border);
    border-radius: 8px;
    background: var(--ano-bg-secondary);
  }
  .ano-end-ann-type {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 3px;
  }
  .ano-end-ann-type .dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    flex-shrink: 0;
  }
  .ano-end-ann-type.highlight { color: #ca8a04; }
  .ano-end-ann-type.highlight .dot { background: var(--ano-highlight); }
  .ano-end-ann-type.pin { color: var(--ano-pin); }
  .ano-end-ann-type.pin .dot { background: var(--ano-pin); }
  .ano-end-ann-type.drawing { color: var(--ano-draw); }
  .ano-end-ann-type.drawing .dot { background: var(--ano-draw); }
  .ano-end-ann-text {
    font-size: 13px;
    color: var(--ano-text);
    line-height: 1.4;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
  }
  .ano-end-ann-comment {
    font-size: 12px;
    color: var(--ano-text-secondary);
    font-style: italic;
    line-height: 1.4;
    margin-top: 2px;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
  }
`;function _e(){let e="ano-host-styles";if(document.getElementById(e))return;let t=document.createElement("style");t.id=e,t.textContent=bt+yt,document.head.appendChild(t)}function Fe(){document.getElementById("ano-host-styles")?.remove()}function oe(e,t){let o=Pe[t]||Pe.light;for(let[r,a]of Object.entries(o))e.style.setProperty(r,a)}function Xe(e){let{store:t,config:o}=e,r=null,a=null,n=null,s=null,p=!1,l=!1,i=null,c=new Set,A=new Map;function x(){if(r)return;r=document.createElement("div"),r.dataset.ano="",a=r.attachShadow({mode:"open"});let g=document.createElement("style");g.textContent=He,a.appendChild(g),n=document.createElement("canvas"),n.className="ano-canvas-overlay",a.appendChild(n),document.body.appendChild(r),w(),window.addEventListener("resize",w),window.addEventListener("scroll",S)}function w(){if(!n)return;let g=window.devicePixelRatio||1;n.width=window.innerWidth*g,n.height=window.innerHeight*g,n.style.width=window.innerWidth+"px",n.style.height=window.innerHeight+"px",s=n.getContext("2d"),s.scale(g,g),S()}function u(){p||(x(),p=!0,n.classList.add("active"),n.addEventListener("pointerdown",O),n.addEventListener("pointermove",P),n.addEventListener("pointerup",L),n.addEventListener("pointerleave",L))}function C(){p=!1,n&&(n.classList.remove("active"),n.removeEventListener("pointerdown",O),n.removeEventListener("pointermove",P),n.removeEventListener("pointerup",L),n.removeEventListener("pointerleave",L)),l&&_()}function O(g){g.button===0&&(l=!0,n.setPointerCapture(g.pointerId),i={points:[{x:g.clientX,y:g.clientY}],color:o.drawColor,width:o.drawWidth},s.beginPath(),s.strokeStyle=i.color,s.lineWidth=i.width,s.lineCap="round",s.lineJoin="round",s.moveTo(g.clientX,g.clientY))}function P(g){!l||!i||(i.points.push({x:g.clientX,y:g.clientY}),s.lineTo(g.clientX,g.clientY),s.stroke(),s.beginPath(),s.moveTo(g.clientX,g.clientY))}function L(){l&&_()}function $(g){let M=g.points,E=1/0,T=1/0,D=-1/0,R=-1/0;for(let k of M)k.x<E&&(E=k.x),k.y<T&&(T=k.y),k.x>D&&(D=k.x),k.y>R&&(R=k.y);let j=(E+D)/2,V=(T+R)/2,G=r.style.display;r.style.display="none";let d=document.elementFromPoint(j,V);if(r.style.display=G,!d||d===document.documentElement)return null;let f=d.getBoundingClientRect();return f.width<1||f.height<1?null:{selector:ee(d),rect:{x:f.x,y:f.y,width:f.width,height:f.height}}}function _(){if(l=!1,!i||i.points.length<2){i=null;return}let g=X(i),M=$(i),E;if(M){let{rect:R}=M,j=i.points.map(V=>({x:(V.x-R.x)/R.width,y:(V.y-R.y)/R.height}));E=[{...i,points:j}]}else E=[i];let T=t.add({type:"drawing",comment:"",strokes:E,context:g,anchor:M,viewport:{scrollX:window.scrollX,scrollY:window.scrollY,width:window.innerWidth,height:window.innerHeight}});c.add(T.id),I(T);let D=i?i.points:[];i=null,e.events.emit("drawing:created",T,D)}function X(g){let M=g.points,E=1/0,T=1/0,D=-1/0,R=-1/0;for(let z of M)z.x<E&&(E=z.x),z.y<T&&(T=z.y),z.x>D&&(D=z.x),z.y>R&&(R=z.y);let j={x:Math.round(E+window.scrollX),y:Math.round(T+window.scrollY),width:Math.round(D-E),height:Math.round(R-T)},V=r.style.display;r.style.display="none";let G=new Set,d=[],f=Math.min(M.length,20),k=Math.max(1,Math.floor(M.length/f));for(let z=0;z<M.length;z+=k){let W=M[z],te=document.elementFromPoint(W.x,W.y);if(!te||te===document.body||te===document.documentElement||te.dataset?.ano!==void 0)continue;let Q=ee(te);if(G.has(Q))continue;G.add(Q);let lt=Y(te);d.push({selector:Q,tagName:te.tagName,text:lt,role:te.getAttribute("role")||void 0,ariaLabel:te.getAttribute("aria-label")||void 0})}r.style.display=V;let B=d.map(z=>{let W=z.tagName.toLowerCase();return z.text?`${W}("${v(z.text,60)}")`:W}),Z=B.length>0?`Drawing over: ${B.join(", ")}`:"Drawing on empty area";return{boundingBox:j,elements:d,description:Z}}function Y(g){let M=g.getAttribute("aria-label");if(M)return M.trim();let E=g.getAttribute("alt");if(E)return E.trim();let T="";for(let R of g.childNodes)R.nodeType===Node.TEXT_NODE&&(T+=R.textContent);return T=T.trim(),T||(g.textContent||"").trim().slice(0,120)}function v(g,M){return g.length>M?g.slice(0,M)+"...":g}function S(){if(!s)return;s.clearRect(0,0,n.width,n.height);let g=t.getByType("drawing");for(let M of g)m(M)}function m(g){if(!s||!g.strokes)return;let{anchor:M,viewport:E}=g,T=null;if(M)try{let D=document.querySelector(M.selector);D&&(T=D.getBoundingClientRect())}catch{}for(let D of g.strokes)if(!(D.points.length<2)){if(s.beginPath(),s.strokeStyle=D.color,s.lineCap="round",s.lineJoin="round",T){let R=T.width/M.rect.width,j=T.height/M.rect.height;s.lineWidth=D.width*Math.min(R,j);let V=D.points[0];s.moveTo(V.x*T.width+T.x,V.y*T.height+T.y);for(let G=1;G<D.points.length;G++){let d=D.points[G];s.lineTo(d.x*T.width+T.x,d.y*T.height+T.y)}}else{let R=E?window.scrollX-E.scrollX:0,j=E?window.scrollY-E.scrollY:0;s.lineWidth=D.width;let V=D.points[0];s.moveTo(V.x-R,V.y-j);for(let G=1;G<D.points.length;G++){let d=D.points[G];s.lineTo(d.x-R,d.y-j)}}s.stroke()}}function I(g){if(g.index==null||A.has(g.id))return;let M=J(g);if(!M)return;let E=document.createElement("div");E.className="ano-drawing-marker",E.dataset.ano="",E.dataset.anoId=g.id,E.textContent=g.index,E.style.setProperty("--ano-pin-color",o.pinColor),document.body.appendChild(E),U(E,M),A.set(g.id,E),E.addEventListener("click",T=>{T.stopPropagation();let D=E.getBoundingClientRect();e.popover.show(g.id,D)})}function U(g,M){g.style.left=`${M.x+window.scrollX-20}px`,g.style.top=`${M.y+window.scrollY-20}px`}function H(){for(let[g,M]of A){let E=t.get(g);if(!E)continue;let T=J(E);T&&U(M,T)}}function b(g){return c.add(g.id),S(),I(g),!0}function y(g){c.delete(g);let M=A.get(g);M&&(M.remove(),A.delete(g)),S()}function h(){c.clear();for(let[,g]of A)g.remove();A.clear(),s&&s.clearRect(0,0,n.width,n.height)}function F(g,M){let E=t.getByType("drawing");for(let T=E.length-1;T>=0;T--){let D=E[T],R=J(D);if(!R)continue;let j=10;if(g>=R.x-j&&g<=R.x+R.width+j&&M>=R.y-j&&M<=R.y+R.height+j)return D}return null}function J(g){let{anchor:M,viewport:E,strokes:T}=g;if(!T||T.length===0)return null;let D=null;if(M)try{let d=document.querySelector(M.selector);d&&(D=d.getBoundingClientRect())}catch{}let R=1/0,j=1/0,V=-1/0,G=-1/0;for(let d of T)for(let f of d.points){let k,B;if(D)k=f.x*D.width+D.x,B=f.y*D.height+D.y;else{let Z=E?window.scrollX-E.scrollX:0,z=E?window.scrollY-E.scrollY:0;k=f.x-Z,B=f.y-z}k<R&&(R=k),B<j&&(j=B),k>V&&(V=k),B>G&&(G=B)}return isFinite(R)?{x:R,y:j,width:V-R,height:G-j}:null}function K(){C(),h(),window.removeEventListener("resize",w),window.removeEventListener("scroll",S),r&&(r.remove(),r=null,a=null,n=null,s=null)}return{init:x,enable:u,disable:C,applyDrawing:b,removeDrawing:y,removeAll:h,repositionAll:H,redrawAll:S,hitTest:F,destroy:K}}var pe=!!navigator.mediaDevices?.getDisplayMedia&&!!window.MediaRecorder&&typeof MediaRecorder.isTypeSupported=="function"&&MediaRecorder.isTypeSupported("video/webm")&&!!window.BroadcastChannel,xt=`<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"><title>Ano Recording</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;font-size:13px;background:#1e293b;color:#f1f5f9;display:flex;align-items:center;justify-content:center;min-height:100vh;padding:12px}
.wrap{display:flex;align-items:center;gap:10px}
.dot{width:10px;height:10px;border-radius:50%;background:#ef4444;animation:p 1s ease-in-out infinite;flex-shrink:0}
@keyframes p{0%,100%{opacity:1}50%{opacity:.3}}
.timer{font-weight:600;font-variant-numeric:tabular-nums;font-size:15px;min-width:44px}
button{padding:5px 14px;border-radius:6px;border:1px solid rgba(255,255,255,.25);background:transparent;color:#fff;cursor:pointer;font-size:13px;transition:background .15s}
button:hover{background:rgba(255,255,255,.12)}
#start{background:#ef4444;border-color:#ef4444;font-weight:600;padding:8px 20px;font-size:14px}
#start:hover{background:#dc2626}
.msg{color:#94a3b8;font-size:12px;text-align:center}
</style></head><body>
<div id="app"><button id="start">Share Tab &amp; Record</button></div>
<script>
var ch=new BroadcastChannel('ano-recording');
var rec,chunks=[],startTime=0,stream,timerIv;
ch.onmessage=function(e){
if(e.data.type==='stop')doStop();
if(e.data.type==='ping'&&rec&&rec.state==='recording')ch.postMessage({type:'pong',startTime:startTime});
};
document.getElementById('start').onclick=function(){startCapture()};
function startCapture(){
navigator.mediaDevices.getDisplayMedia({video:{frameRate:30}}).then(function(s){
stream=s;
var mime='video/webm';
if(typeof MediaRecorder.isTypeSupported==='function'&&MediaRecorder.isTypeSupported('video/webm;codecs=vp9'))mime='video/webm;codecs=vp9';
rec=new MediaRecorder(stream,{mimeType:mime});
chunks=[];
rec.ondataavailable=function(e){if(e.data.size>0)chunks.push(e.data)};
rec.onstop=onStop;
rec.start(500);
startTime=Date.now();
stream.getVideoTracks()[0].onended=function(){doStop()};
document.getElementById('app').innerHTML='<div class="wrap"><span class="dot"></span><span class="timer" id="t">0:00</span><button id="stopbtn">Stop</button></div>';
document.getElementById('stopbtn').onclick=function(){doStop()};
timerIv=setInterval(function(){
var sec=Math.floor((Date.now()-startTime)/1000);
var el=document.getElementById('t');
if(el)el.textContent=Math.floor(sec/60)+':'+(sec%60).toString().padStart(2,'0');
},250);
ch.postMessage({type:'started',startTime:startTime});
}).catch(function(){
ch.postMessage({type:'cancelled'});
try{window.close()}catch(e){}
});
}
function doStop(){if(!rec||rec.state==='inactive')return;rec.stop()}
function onStop(){
clearInterval(timerIv);
if(stream)stream.getTracks().forEach(function(t){t.stop()});
var blob=new Blob(chunks,{type:'video/webm'});
var duration=Date.now()-startTime;
ch.postMessage({type:'stopped',duration:duration,blob:blob});
document.getElementById('app').innerHTML='<div class="msg">Recording saved. Closing\\u2026</div>';
setTimeout(function(){try{window.close()}catch(e){}},2000);
}
window.onbeforeunload=function(){if(rec&&rec.state==='recording')doStop()};
<\/script></body></html>`;function Ye(e){let t=new BroadcastChannel("ano-recording"),o=!1,r=null,a=0,n=null,s=null,p=0;t.onmessage=L=>{let{data:$}=L;$.type==="started"?(o=!0,a=$.startTime,e.events.emit("recording:started")):$.type==="stopped"?x($):$.type==="pong"?o||(o=!0,a=$.startTime):$.type==="cancelled"&&e.events.emit("recording:cancelled")};function l(){o||A()}function i(){t.postMessage({type:"stop"})}function c(){return o}function A(){if(r=window.open("","ano-recorder","width=460,height=600,top=60,left=60"),!r){console.warn("[Ano] Popup blocked \u2014 allow popups for screen recording."),e.events.emit("recording:cancelled");return}r.document.open(),r.document.write(xt),r.document.close()}function x(L){o=!1,L.blob&&(n=L.blob,s=URL.createObjectURL(L.blob),p=L.duration||0),e.events.emit("recording:stopped",{blob:n,blobUrl:s,duration:p}),r=null}function w(){return n}function u(){return s}function C(){s&&URL.revokeObjectURL(s),n=null,s=null,p=0}function O(L){let $=e.store.get(L);$&&$.blobUrl&&URL.revokeObjectURL($.blobUrl)}function P(){o&&i(),C();try{t.close()}catch{}let L=e.store.getByType("recording");for(let $ of L)$.blobUrl&&URL.revokeObjectURL($.blobUrl)}return setTimeout(()=>t.postMessage({type:"ping"}),100),{startRecording:l,stopRecording:i,isRecording:c,getBlob:w,getBlobUrl:u,clearBlob:C,removeRecording:O,destroy:P}}var be="ano-session",wt=/password|cc-|cvv|ssn|secret|token/i,kt=0;function Ct(){return"ses_"+Date.now().toString(36)+(kt++).toString(36)+Math.random().toString(36).slice(2,6)}function We(e){let t=!1,o=null,r=0,a=[],n=[],s=null,p=new WeakMap,l=0,i=null,c={},A=["log","warn","error","info"];function x(d){if(!d)return"unknown";let f=d.tagName.toLowerCase();if(f==="button"||f==="input"&&d.type==="submit"){let B=d.textContent?.trim()||d.value||"";return B?`button("${ne(B,40)}")`:"button"}if(f==="a"){let B=d.textContent?.trim()||"";return B?`link("${ne(B,40)}")`:`link(${d.href||""})`}if(f==="input")return`input[name="${d.name||d.id||d.type}"]`;if(f==="textarea")return`textarea[name="${d.name||d.id||"textarea"}"]`;if(f==="select"){let B=d.name||d.id||"select";return`select${B!=="select"?`[name="${B}"]`:""}`}if(f==="label"){let B=d.textContent?.trim()||"";return B?`label("${ne(B,40)}")`:"label"}if(f==="img")return`img(${d.alt||d.src?.split("/").pop()||""})`;let k=d.textContent?.trim();if(k&&k.length<60&&d.children.length===0)return`${f}("${ne(k,40)}")`;if(d.id)return`${f}#${d.id}`;if(d.className&&typeof d.className=="string"){let B=d.className.split(/\s+/).filter(Boolean).slice(0,2).join(".");if(B)return`${f}.${B}`}return f}function w(d){if(d.type==="password")return!0;let f=d.autocomplete||"";return wt.test(f)}function u(d){if(!d)return!1;if(d.closest?.("[data-ano]"))return!0;let f=d;for(;f;){if(f.host&&f.host.dataset&&f.host.dataset.ano!==void 0)return!0;f=f.parentNode}return!1}function C(d,f,k,B,Z){let z={time:Date.now()-r,action:d,target:f||null,selector:k||null,value:B??null,url:Z||window.location.href};a.push(z),b(),e.events.emit("session:action",a.length)}function O(d){if(u(d.target))return;let f=d.target,k=null;try{k=ee(f)}catch{}C("click",x(f),k,null)}function P(d){if(u(d.target))return;let f=d.target,k=p.get(f);k&&clearTimeout(k);let B=setTimeout(()=>{p.delete(f);let Z=w(f)?"[redacted]":f.value,z=null;try{z=ee(f)}catch{}C("type",x(f),z,Z)},500);p.set(f,B)}function L(d){if(u(d.target))return;let f=d.target,k=f.tagName.toLowerCase(),B=f.type?.toLowerCase();if(k==="select"){let Z=f.options?.[f.selectedIndex]?.text||f.value,z=null;try{z=ee(f)}catch{}C("select",x(f),z,Z)}else if(B==="checkbox"||B==="radio"){let Z=f.checked?"checked":"unchecked",z=null;try{z=ee(f)}catch{}C("check",x(f),z,Z)}}function $(){i||(i=setTimeout(()=>{i=null;let d=window.scrollY;Math.abs(d-l)<100||(l=d,C("scroll",null,null,`y=${Math.round(d)}`))},300))}function _(d){if(u(d.target))return;let f=d.target,k=null;try{k=ee(f)}catch{}C("submit",x(f),k,null)}function X(d){let f=d.message||"Unknown error",k=d.filename?` at ${d.filename}:${d.lineno}:${d.colno}`:"";C("error",null,null,`${f}${k}`)}function Y(d){let f=d.reason,k;if(f instanceof Error)k=`${f.name}: ${f.message}`;else try{k=JSON.stringify(f)}catch{k=String(f)}C("error","unhandledrejection",null,ne(k,300))}function v(){S(),H()}function S(){s&&(clearTimeout(s),s=null)}function m(){for(let d of A)c[d]=console[d],console[d]=(...f)=>{if(c[d].apply(console,f),typeof f[0]=="string"&&f[0].startsWith("[Ano]"))return;let k=U(f);C(`console.${d}`,null,null,k)}}function I(){for(let d of A)c[d]&&(console[d]=c[d],delete c[d])}function U(d){let f=d.map(k=>{if(k===null)return"null";if(k===void 0)return"undefined";if(typeof k=="string")return k;if(typeof k=="number"||typeof k=="boolean")return String(k);if(k instanceof Error)return`${k.name}: ${k.message}`;try{let B=JSON.stringify(k);return B.length>200?B.slice(0,200)+"...":B}catch{return String(k)}});return ne(f.join(" "),500)}function H(){if(t)try{sessionStorage.setItem(be,JSON.stringify({active:!0,sessionId:o,startTime:r,actions:a,pages:n}))}catch{}}function b(){s&&clearTimeout(s),s=setTimeout(H,200)}function y(){try{sessionStorage.removeItem(be)}catch{}}function h(){document.addEventListener("click",O,!0),document.addEventListener("input",P,!0),document.addEventListener("change",L,!0),document.addEventListener("scroll",$,{capture:!0,passive:!0}),document.addEventListener("submit",_,!0),window.addEventListener("beforeunload",v),window.addEventListener("error",X),window.addEventListener("unhandledrejection",Y)}function F(){document.removeEventListener("click",O,!0),document.removeEventListener("input",P,!0),document.removeEventListener("change",L,!0),document.removeEventListener("scroll",$,{capture:!0}),document.removeEventListener("submit",_,!0),window.removeEventListener("beforeunload",v),window.removeEventListener("error",X),window.removeEventListener("unhandledrejection",Y)}function J(){return t=!0,o=Ct(),r=Date.now(),a=[],n=[window.location.href],l=window.scrollY,H(),h(),m(),o}function K(d){t=!0,o=d.sessionId,r=d.startTime,a=d.actions||[],n=d.pages||[],l=window.scrollY;let f=window.location.href;n.includes(f)||n.push(f),C("navigate",document.title,null,f,f),h(),m()}function g(){if(!t)return null;t=!1,S(),F(),I(),y(),i&&(clearTimeout(i),i=null);let d=Date.now()-r,f=M(d,a,n),k={sessionId:o,duration:d,actions:a.slice(),pages:n.slice(),description:f},B=o;return a=[],n=[],r=0,o=null,k}function M(d,f,k){let Z=[`Session (${Math.round(d/1e3)}s, ${f.length} actions, ${k.length} pages):`];for(let z=0;z<f.length;z++){let W=f[z],te=(W.time/1e3).toFixed(1),Q;switch(W.action){case"click":Q=`Clicked ${W.target}`;break;case"type":Q=`Typed "${ne(W.value||"",40)}" in ${W.target}`;break;case"select":Q=`Selected "${W.value}" in ${W.target}`;break;case"check":Q=`${W.value==="checked"?"Checked":"Unchecked"} ${W.target}`;break;case"scroll":Q=`Scrolled to ${W.value}`;break;case"submit":Q=`Submitted ${W.target}`;break;case"navigate":Q=`Navigated to ${W.value}`;break;case"console.log":Q=`console.log: ${ne(W.value||"",80)}`;break;case"console.warn":Q=`console.warn: ${ne(W.value||"",80)}`;break;case"console.error":Q=`console.error: ${ne(W.value||"",80)}`;break;case"console.info":Q=`console.info: ${ne(W.value||"",80)}`;break;case"error":Q=`ERROR: ${ne(W.value||"",80)}`;break;default:Q=`${W.action} ${W.target||""}`}Z.push(`${z+1}. [${te}s] ${Q}`)}return Z.join(`
`)}function E(){return t}function T(){return o}function D(){return r}function R(){return a.length}function j(d){}function V(){t&&(t=!1,F(),I(),y(),i&&(clearTimeout(i),i=null),s&&(clearTimeout(s),s=null)),a=[],n=[],o=null}function G(){try{let d=sessionStorage.getItem(be);if(!d)return;let f=JSON.parse(d);f&&f.active&&(K(f),e.events.emit("session:resumed",{sessionId:f.sessionId,startTime:f.startTime}))}catch{}}return setTimeout(G,50),{start:J,stop:g,isActive:E,getSessionId:T,getStartTime:D,getActionCount:R,checkResume:G,removeSession:j,destroy:V}}function ne(e,t){return e?e.length>t?e.slice(0,t)+"...":e:""}function N(e,t={},...o){let r=document.createElement(e);for(let[a,n]of Object.entries(t))a==="className"?r.className=n:a==="style"&&typeof n=="object"?Object.assign(r.style,n):a.startsWith("on")&&typeof n=="function"?r.addEventListener(a.slice(2).toLowerCase(),n):a==="html"?r.innerHTML=n:r.setAttribute(a,n);for(let a of o)a!=null&&(typeof a=="string"?r.appendChild(document.createTextNode(a)):r.appendChild(a));return r}function re(e){let t={highlight:'<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>',pin:'<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>',draw:'<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 19l7-7 3 3-7 7-3-3z"/><path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/><path d="M2 2l7.586 7.586"/></svg>',navigate:'<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 11l19-9-9 19-2-8-8-2z"/></svg>',close:'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>',download:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>',upload:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>',trash:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>',chevron:'<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>',record:'<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="4" fill="currentColor" stroke="none"/></svg>',stop:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="6" y="6" width="12" height="12" rx="1" fill="currentColor" stroke="none"/></svg>',session:'<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>',annotation:'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>',link:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>'},o=document.createElement("span");return o.innerHTML=t[e]||"",o.style.display="inline-flex",o.style.alignItems="center",o}var St=[{id:"highlight",label:"Highlight",icon:"highlight",shortcut:"Alt+H"},{id:"pin",label:"Pin",icon:"pin",shortcut:"Alt+P"},{id:"draw",label:"Draw",icon:"draw",shortcut:"Alt+D"},{id:"navigate",label:"Navigate",icon:"navigate",shortcut:"Alt+N"}];function Je(e){let t=null,o=null,r=null,a={},n=null,s=null,p=null,l=null;function i(){t=document.createElement("div"),t.dataset.ano="",o=t.attachShadow({mode:"open"});let L=document.createElement("style");L.textContent=Ue,o.appendChild(L),oe(t,e.config.theme),r=N("div",{className:"ano-toolbar"}),o.appendChild(r),document.body.appendChild(t),c()}function c(){C(),a={},r.innerHTML="";let L=N("button",{className:"ano-start-session",onClick:()=>e.events.emit("session:start")},re("session"),N("span",{className:"ano-btn-label"},"Start Session"));if(r.appendChild(L),pe){let $=N("label",{className:"ano-video-toggle"});l=document.createElement("input"),l.type="checkbox",l.checked=e.config.videoRecording,$.appendChild(l),$.appendChild(re("record")),$.appendChild(document.createTextNode("Video")),r.appendChild($)}}function A(L){C(),a={},r.innerHTML="";for(let Y of St){let v=N("button",{className:"ano-toolbar-btn",title:Y.label,onClick:()=>e.setMode(Y.id)},re(Y.icon),N("span",{className:"tooltip"},`${Y.label} (${Y.shortcut})`));a[Y.id]=v,r.appendChild(v)}r.appendChild(N("div",{className:"ano-toolbar-divider"}));let $=N("div",{className:"ano-session-status"});$.appendChild(N("span",{className:"ano-session-dot"})),n=N("span",{className:"ano-session-timer"},"0:00"),$.appendChild(n),s=N("span",{className:"ano-session-count"},"(0)"),$.appendChild(s);let _=N("button",{className:"ano-end-session",onClick:()=>e.events.emit("session:end")},re("stop"),N("span",{className:"ano-btn-label"},"End"));$.appendChild(_),r.appendChild($);let X=()=>{if(!n)return;let Y=Date.now()-L,v=Math.floor(Y/1e3),S=Math.floor(v/60),m=v%60;n.textContent=`${S}:${m.toString().padStart(2,"0")}`};X(),p=setInterval(X,250)}function x(L){s&&(s.textContent=`(${L})`)}function w(){return l?l.checked:!1}function u(L){for(let[$,_]of Object.entries(a))_.classList.toggle("active",$===L)}function C(){p&&(clearInterval(p),p=null),n=null,s=null}function O(L){t&&oe(t,L)}function P(){C(),t&&(t.remove(),t=null,o=null,r=null,a={},l=null)}return{render:i,renderIdle:c,renderActive:A,setActive:u,updateCount:x,getVideoToggleState:w,updateTheme:O,destroy:P}}function Ve(e){let{store:t}=e,o=null,r=null,a=null,n=null;function s(){if(o)return;o=document.createElement("div"),o.dataset.ano="",r=o.attachShadow({mode:"open"});let u=document.createElement("style");u.textContent=ze,r.appendChild(u),oe(o,e.config.theme),document.body.appendChild(o)}function p(u,C){if(s(),a===u)return;i(),a=u;let O=t.get(u);if(!O)return;let P=N("div",{className:"ano-popover"}),L=N("div",{className:"ano-popover-body"}),$=N("textarea",{placeholder:"Add a comment..."});$.value=O.comment||"",L.appendChild($),P.appendChild(L);let _=N("div",{className:"ano-popover-actions"}),X=N("button",{className:"ano-popover-btn delete",onClick:()=>{e.events.emit("annotation:delete",u),i()}},"Delete"),Y=N("button",{className:"ano-popover-btn",onClick:()=>i()},"Cancel"),v=N("button",{className:"ano-popover-btn save",onClick:()=>{t.update(u,{comment:$.value}),i()}},"Save");_.appendChild(X),_.appendChild(Y),_.appendChild(v),P.appendChild(_);let S=N("div",{className:"ano-popover-arrow"});P.appendChild(S),r.appendChild(P),requestAnimationFrame(()=>{l(P,S,C),$.focus();function m(I){o&&!o.shadowRoot.contains(I.target)&&!o.contains(I.target)&&(t.update(u,{comment:$.value}),i())}document.addEventListener("click",m,!0),n=()=>{document.removeEventListener("click",m,!0)}}),$.addEventListener("keydown",m=>{m.key==="Enter"&&(m.metaKey||m.ctrlKey)&&(t.update(u,{comment:$.value}),i()),m.key==="Escape"&&(t.update(u,{comment:$.value}),i()),m.stopPropagation()})}function l(u,C,O){let P=u.getBoundingClientRect(),L=window.innerWidth,$=window.innerHeight,_,X,Y="top";_=O.bottom+8,_+P.height>$&&(_=O.top-P.height-8,Y="bottom"),X=O.left+O.width/2-P.width/2,X=Math.max(8,Math.min(X,L-P.width-8)),u.style.top=`${_}px`,u.style.left=`${X}px`,C.className=`ano-popover-arrow ${Y}`;let v=O.left+O.width/2-X-6;C.style.left=`${Math.max(12,Math.min(v,P.width-24))}px`}function i(){if(n&&(n(),n=null),!r)return;let u=r.querySelector(".ano-popover");u&&u.remove(),a=null}function c(){return a!==null}function A(){return a}function x(u){o&&oe(o,u)}function w(){i(),o&&(o.remove(),o=null,r=null)}return{init:s,show:p,hide:i,isOpen:c,getCurrentId:A,updateTheme:x,destroy:w}}function qe(e){let t=null,o=null;function r(x){i(),t=document.createElement("div"),t.dataset.ano="",o=t.attachShadow({mode:"open"});let w=document.createElement("style");w.textContent=je,o.appendChild(w),oe(t,e.config.theme);let u=N("div",{className:"ano-end-overlay"});u.addEventListener("click",H=>{H.target===u&&l()});let C=N("div",{className:"ano-end-dialog"}),O=N("button",{className:"ano-end-close",onClick:()=>l()});O.appendChild(re("close")),C.appendChild(N("div",{className:"ano-end-header"},N("h2",{},"Report Ready"),O));let P=N("div",{className:"ano-end-summary"});if(P.appendChild(a(p(x.duration),"Duration")),P.appendChild(a(String(x.actionCount),"Actions")),P.appendChild(a(String(x.pageCount),"Pages")),P.appendChild(a(String(x.annotationCount),"Annotations")),x.hasRecording){let H=N("div",{className:"ano-end-badge"});H.appendChild(re("record")),H.appendChild(document.createTextNode("Video recorded")),P.appendChild(H)}if(C.appendChild(P),x.annotations&&x.annotations.length>0){let H=N("div",{className:"ano-end-annotations"});H.appendChild(N("h3",{},"Annotations"));let b=N("div",{className:"ano-end-ann-list"}),y=0;for(let h of x.annotations){if(h.type==="session"||h.type==="recording")continue;let F=N("div",{className:"ano-end-ann-card"});h.type==="highlight"?(F.appendChild(n("highlight","Highlight")),h.quote&&F.appendChild(N("div",{className:"ano-end-ann-text"},`"${s(h.quote,120)}"`))):h.type==="pin"?(y++,F.appendChild(n("pin",`Pin #${y}`)),h.target?.description&&F.appendChild(N("div",{className:"ano-end-ann-text"},h.target.description))):h.type==="drawing"&&F.appendChild(n("drawing","Drawing")),h.comment&&F.appendChild(N("div",{className:"ano-end-ann-comment"},h.comment)),b.appendChild(F)}H.appendChild(b),C.appendChild(H)}let L=N("div",{className:"ano-end-actions"}),$=N("button",{onClick:()=>l()},"Dismiss"),_=N("button",{onClick:()=>{_.textContent="Uploading\u2026",_.disabled=!0,e.events.emit("share")}},"Get Link"),X=N("div",{className:"ano-end-link-result"});X.style.display="none";let Y=N("input",{readOnly:!0,className:"ano-end-link-input"}),v=N("button",{className:"ano-end-link-copy",onClick:()=>{navigator.clipboard.writeText(Y.value).then(()=>{v.textContent="Copied!",setTimeout(()=>{v.textContent="Copy"},2e3)})}},"Copy");X.appendChild(Y),X.appendChild(v);let S=e.events.on("share:complete",H=>{_.style.display="none",Y.value=H,X.style.display=""}),m=e.events.on("share:error",()=>{_.textContent="Failed \u2014 retry",_.disabled=!1}),I=i;i=function(){S(),m(),I()};let U=N("button",{className:"primary",onClick:()=>{e.events.emit("export:json"),l()}},"Export JSON");if(L.appendChild($),L.appendChild(_),x.hasRecording){let H=N("button",{onClick:()=>{e.events.emit("export:video"),l()}},"Export Video");L.appendChild(H)}L.appendChild(U),C.appendChild(L),C.appendChild(X),u.appendChild(C),o.appendChild(u),document.body.appendChild(t)}function a(x,w){return N("div",{className:"ano-end-stat"},N("div",{className:"ano-end-stat-value"},x),N("div",{className:"ano-end-stat-label"},w))}function n(x,w){let u=N("div",{className:`ano-end-ann-type ${x}`});return u.appendChild(N("span",{className:"dot"})),u.appendChild(document.createTextNode(w)),u}function s(x,w){return!x||x.length<=w?x||"":x.slice(0,w)+"\u2026"}function p(x){let w=Math.floor((x||0)/1e3),u=Math.floor(w/60),C=w%60;return`${u}:${C.toString().padStart(2,"0")}`}function l(){i(),e.events.emit("session:dismissed")}function i(){t&&(t.remove(),t=null,o=null)}function c(){return t!==null}function A(){i()}return{show:r,hide:i,dismiss:l,isOpen:c,destroy:A}}function Ke(e){let t=!1,o={"alt+h":()=>{e.sessionState==="active"&&e.setMode("highlight")},"alt+p":()=>{e.sessionState==="active"&&e.setMode("pin")},"alt+d":()=>{e.sessionState==="active"&&e.setMode("draw")},"alt+n":()=>{e.sessionState==="active"&&e.setMode("navigate")},"alt+s":()=>{e.sessionState==="idle"?e.events.emit("session:start"):e.sessionState==="active"&&e.events.emit("session:end")},"alt+e":()=>e.events.emit("export"),escape:()=>{e.popover.isOpen()?e.popover.hide():e.sessionState==="active"?e.events.emit("session:end"):e.endDialog&&e.endDialog.isOpen()&&e.endDialog.dismiss()}};function r(i){let c=i.target.tagName;if(c==="INPUT"||c==="TEXTAREA"||c==="SELECT"){if(i.key==="Escape"&&(i.target.closest?.("[data-ano]")||n(i.target))){o.escape();return}return}let A=a(i);o[A]&&(i.preventDefault(),i.stopPropagation(),o[A]())}function a(i){let c=[];return i.altKey&&c.push("alt"),i.ctrlKey&&c.push("ctrl"),i.metaKey&&c.push("meta"),i.shiftKey&&c.push("shift"),c.push(i.key.toLowerCase()),c.join("+")}function n(i){let c=i;for(;c;){if(c.host&&c.host.dataset&&c.host.dataset.ano!==void 0)return!0;c=c.parentNode}return!1}function s(){t||(t=!0,document.addEventListener("keydown",r,!0))}function p(){t=!1,document.removeEventListener("keydown",r,!0)}function l(){p()}return{enable:s,disable:p,destroy:l}}function ye(e,t=[]){let o=ae(e,t),r=JSON.stringify(o,null,2),a=new Blob([r],{type:"application/json"}),n=URL.createObjectURL(a),s=document.createElement("a");s.href=n,s.download=`annotations-${et()}.json`,s.style.display="none",document.body.appendChild(s),s.click(),setTimeout(()=>{URL.revokeObjectURL(n),s.remove()},100);let p=e.getByType("recording");for(let i of p)i.blob&&fe(i.blob,`recording-${i.id}.webm`);let l=e.getByType("session");for(let i of l)i.blob&&fe(i.blob,`session-${i.sessionId||i.id}.webm`);return o}function Qe(e,t=[]){let o=ae(e,t),r=JSON.stringify(o,null,2),a=new Blob([r],{type:"application/json"}),n=URL.createObjectURL(a),s=document.createElement("a");return s.href=n,s.download=`annotations-${et()}.json`,s.style.display="none",document.body.appendChild(s),s.click(),setTimeout(()=>{URL.revokeObjectURL(n),s.remove()},100),o}function Ze(e){let t=e.getByType("recording");for(let r of t)r.blob&&fe(r.blob,`recording-${r.id}.webm`);let o=e.getByType("session");for(let r of o)r.blob&&fe(r.blob,`session-${r.sessionId||r.id}.webm`)}function fe(e,t){let o=URL.createObjectURL(e),r=document.createElement("a");r.href=o,r.download=t,r.style.display="none",document.body.appendChild(r),r.click(),setTimeout(()=>{URL.revokeObjectURL(o),r.remove()},100)}function ae(e,t=[]){let o=e.getAll().map(s=>{let p=Ge(s);return p.pageUrl=p.pageUrl||window.location.href,p.pageTitle=p.pageTitle||document.title,p}),r=t.map(s=>{let p=Ge(s);return p.pageUrl=p.pageUrl||s.pageUrl||"unknown",p.pageTitle=p.pageTitle||s.pageTitle||"",p}),a=new Set(o.map(s=>s.id)),n=[...o];for(let s of r)a.has(s.id)||(a.add(s.id),n.push(s));return n.sort((s,p)=>s.createdAt-p.createdAt),{version:"1.0",exportedAt:new Date().toISOString(),pageUrl:window.location.href,pageTitle:document.title,environment:Tt(),annotations:n,summary:Mt(n)}}function Tt(){let e=navigator,t=screen,o=e.connection||e.mozConnection||e.webkitConnection,r={userAgent:e.userAgent,platform:e.platform,language:e.language,languages:e.languages?[...e.languages]:[e.language],timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,timezoneOffset:new Date().getTimezoneOffset(),screen:{width:t.width,height:t.height,devicePixelRatio:window.devicePixelRatio,colorDepth:t.colorDepth,orientation:t.orientation?.type||null},viewport:{width:window.innerWidth,height:window.innerHeight},deviceMemory:e.deviceMemory||null,hardwareConcurrency:e.hardwareConcurrency||null,touchSupport:e.maxTouchPoints>0,cookiesEnabled:e.cookieEnabled,doNotTrack:e.doNotTrack||null};return o&&(r.connection={effectiveType:o.effectiveType||null,downlink:o.downlink||null,rtt:o.rtt||null,saveData:o.saveData||!1}),r}function Ge(e){let t={};return t.id=e.id,t.type=e.type,t.comment=e.comment||"",t.createdAt=e.createdAt,e.type==="highlight"?(t.text=e.text,t.context=e.context||null,t._anchoring={selectors:e.selectors},e.color&&(t.color=e.color)):e.type==="pin"?(t.index=e.index,t.context=e.context||null,t._anchoring={targetSelector:e.targetSelector,targetMeta:e.targetMeta}):e.type==="drawing"?(t.context=e.context||null,t._anchoring={strokes:e.strokes,viewport:e.viewport}):e.type==="recording"?(t.duration=e.duration,t.region=e.region,t.context=e.context||null,t._anchoring={viewport:e.viewport,file:`recording-${e.id}.webm`}):e.type==="session"&&(t.duration=e.duration,t.pages=e.pages,t.context=e.context||null,t.sessionId=e.sessionId||null,t.annotationIds=e.annotationIds||[],t.hasRecording=e.hasRecording||!1,t._anchoring={actions:e.actions},e.blob&&(t._anchoring.file=`session-${e.sessionId||e.id}.webm`)),e.pageUrl&&(t.pageUrl=e.pageUrl),e.pageTitle&&(t.pageTitle=e.pageTitle),e._orphaned&&(t.orphaned=!0),t}function Mt(e){let t=new Map;for(let r of e){let a=r.pageUrl||"unknown";t.has(a)||t.set(a,[]),t.get(a).push(r)}let o=[];for(let[r,a]of t){t.size>1&&o.push(`
--- ${r} ---`);for(let n of a){let s=n.comment?` \u2014 "${n.comment}"`:"";if(n.type==="highlight"){let p=n.context?.element?` in <${n.context.element.tagName?.toLowerCase()||"element"}>`:"",l=n.context?.pagePath?` (${n.context.pagePath.join(" > ")})`:"";o.push(`[Highlight] "${Et(n.text,80)}"${p}${l}${s}`)}else if(n.type==="pin"){let p=n.context?.description||`element #${n.index}`;o.push(`[Pin #${n.index}] ${p}${s}`)}else if(n.type==="drawing"){let p=n.context?.description||"freehand drawing";o.push(`[Drawing] ${p}${s}`)}else if(n.type==="recording"){let p=Math.round((n.duration||0)/1e3),l=n.context?.description||"screen recording";o.push(`[Recording ${p}s] ${l}${s}`)}else if(n.type==="session"){let p=Math.round((n.duration||0)/1e3),l=n.context?.description||"session recording";o.push(`[Session ${p}s] ${l}${s}`)}}}return o.join(`
`).trim()}function Et(e,t){return e?e.length>t?e.slice(0,t)+"...":e:""}function et(){let e=new Date;return`${e.getFullYear()}-${ue(e.getMonth()+1)}-${ue(e.getDate())}_${ue(e.getHours())}${ue(e.getMinutes())}`}function ue(e){return e.toString().padStart(2,"0")}function xe(e){return new Promise(t=>{let o=document.createElement("input");o.type="file",o.accept=".json",o.style.display="none",document.body.appendChild(o),o.addEventListener("change",async()=>{let r=o.files[0];if(!r){o.remove(),t({success:!1,error:"No file selected"});return}try{let a=await r.text(),n=JSON.parse(a),s=le(e,n);t(s)}catch(a){t({success:!1,error:a.message})}finally{o.remove()}}),o.click()})}function le(e,t){if(!t||!t.annotations||!Array.isArray(t.annotations))return{success:!1,error:"Invalid annotation data"};let{store:o,highlightManager:r,pinManager:a,drawingManager:n}=e,s={imported:0,orphaned:0,orphans:[]};for(let p of t.annotations){let l={...p};l._anchoring&&(Object.assign(l,l._anchoring),delete l._anchoring);let i=o.add(l),c=!1;i.type==="highlight"?c=r.applyHighlight(i):i.type==="pin"?c=a.applyPin(i):i.type==="drawing"?c=n.applyDrawing(i):(i.type==="recording"||i.type==="session")&&(c=!0),c?s.imported++:(s.orphaned++,s.orphans.push(i.id),o.update(i.id,{_orphaned:!0}))}return{success:!0,...s}}var tt="https://share.mk/files/";async function nt(e,t){let o=await fetch(tt,{method:"POST",headers:{"Tus-Resumable":"1.0.0","Upload-Length":String(e.byteLength),"Upload-Metadata":t.map(([s,p])=>`${s} ${btoa(p)}`).join(",")}});if(!o.ok)throw new Error(`Upload failed: ${o.status}`);let r=o.headers.get("Location");if(!r)throw new Error("No Location header in response");let a=r.startsWith("http")?r:new URL(r,tt).href,n=await fetch(a,{method:"PATCH",headers:{"Tus-Resumable":"1.0.0","Upload-Offset":"0","Content-Type":"application/offset+octet-stream"},body:e});if(!n.ok)throw new Error(`Patch failed: ${n.status}`);return a}async function ot(e,t,o){try{o.emit("share:uploading");let r=ae(e,t),a=[];for(let i of e.getAll())if((i.type==="recording"||i.type==="session")&&i.blob){let c=i.type==="recording"?`recording-${i.id}.webm`:`session-${i.sessionId||i.id}.webm`;a.push({id:i.id,type:i.type,sessionId:i.sessionId,blob:i.blob,filename:c})}let n=new Map;for(let i of a){let c=new Uint8Array(await i.blob.arrayBuffer()),A=await nt(c,[["filename",i.filename],["content-type","video/webm"],["expires-in","7d"]]);n.set(i.filename,A)}if(n.size>0)for(let i of r.annotations)i._anchoring?.file&&n.has(i._anchoring.file)&&(i._anchoring.file=n.get(i._anchoring.file));let s=JSON.stringify(r,null,2),p=new TextEncoder().encode(s),l=await nt(p,[["filename","annotations.json"],["content-type","application/json"],["expires-in","7d"]]);try{await navigator.clipboard.writeText(l)}catch{}return o.emit("share:complete",l),l}catch(r){return o.emit("share:error",r),null}}var rt="ano:",ie=null;function it(e={}){if(ie)return console.warn("[Ano] Already initialized. Call Ano.destroy() first."),ie.api;let t=window!==window.top,o=Se(e),r=Ee(),a=ce(),n={config:o,store:r,events:a,mode:"navigate",sessionState:"idle",currentSessionId:null,toolbar:null,popover:null,endDialog:null,highlightManager:null,pinManager:null,drawingManager:null,recordingManager:null,sessionManager:null,shortcutManager:null,setMode:null};n.highlightManager=De(n),n.pinManager=Be(n),n.drawingManager=Xe(n),pe&&(n.recordingManager=Ye(n)),n.sessionManager=We(n);let s={render:()=>{},renderIdle:()=>{},renderActive:()=>{},setActive:()=>{},updateCount:()=>{},getVideoToggleState:()=>!1,destroy:()=>{}},p={show:()=>{},destroy:()=>{}};n.toolbar=t?s:Je(n),n.popover=Ve(n),n.endDialog=t?p:qe(n),n.shortcutManager=Ke(n),n.setMode=w=>{if(!(!t&&n.sessionState!=="active"&&w!=="navigate")&&(At(n,n.mode),n.mode=w,Nt(n,w),!t)){n.toolbar.setActive(w);for(let u of document.querySelectorAll("iframe"))try{u.contentWindow?.postMessage({source:"ano-parent",type:"mode:set",payload:w},"*")}catch{}}},It(n),_e(),n.drawingManager.init(),n.toolbar.render(),n.popover.init(),o.shortcuts&&!t&&n.shortcutManager.enable();let l=null,i=null;t||(Rt(n),i=r.on("change",()=>{l&&clearTimeout(l),l=setTimeout(()=>st(r),500)})),r.on("add",w=>{n.sessionState==="active"&&n.currentSessionId&&w.type!=="session"&&!w.sessionId&&r.update(w.id,{sessionId:n.currentSessionId})});let c=()=>{n.pinManager.repositionAll(),n.highlightManager.repositionAll(),n.drawingManager.repositionAll()};window.addEventListener("scroll",c,{passive:!0}),window.addEventListener("resize",c,{passive:!0});let A=new MutationObserver(w=>{for(let u of w)for(let C of u.removedNodes)if(C.classList?.contains("ano-highlight")&&C.dataset?.anoId){let O=C.dataset.anoId;r.get(O)&&r.update(O,{_orphaned:!0})}});if(A.observe(document.body,{childList:!0,subtree:!0}),t){let w=function(u){!u.data||u.data.source!=="ano-parent"||(u.data.type==="mode:set"?n.setMode(u.data.payload):u.data.type==="pin:hover"?n.pinManager.hoverAt(u.data.x,u.data.y):u.data.type==="pin:hover:clear"?n.pinManager.clearHover():u.data.type==="pin:click"?n.pinManager.clickAt(u.data.x,u.data.y):u.data.type==="session:start"?(n.sessionState="active",n.currentSessionId=u.data.sessionId):u.data.type==="session:end"?n.sessionState="ending":u.data.type==="session:clear"?(we(),n.sessionState="idle",n.currentSessionId=null):u.data.type==="destroy"&&ke())};r.on("add",u=>window.parent.postMessage({source:"ano-frame",type:"annotation:add",payload:Ce(u),frameUrl:location.href},"*")),r.on("update",u=>window.parent.postMessage({source:"ano-frame",type:"annotation:update",payload:Ce(u),frameUrl:location.href},"*")),r.on("remove",u=>window.parent.postMessage({source:"ano-frame",type:"annotation:remove",payload:u.id,frameUrl:location.href},"*")),window.addEventListener("message",w),n._cleanupChildMessage=()=>window.removeEventListener("message",w)}if(!t){let w=function(u){if(!u.data||u.data.source!=="ano-frame")return;let{type:C,payload:O,frameUrl:P}=u.data;C==="annotation:add"?r.add({...O,frameUrl:P}):C==="annotation:update"?r.update(O.id,{...O,frameUrl:P}):C==="annotation:remove"&&r.remove(O)};window.addEventListener("message",w),n._cleanupFrameMessage=()=>window.removeEventListener("message",w)}let x={getAll:()=>r.getAll(),toJSON:()=>ae(r,se()),export:()=>ye(r,se()),importFile:()=>xe(n),import:w=>le(n,w),setMode:w=>n.setMode(w),share:()=>a.emit("share"),clear:()=>we(),destroy:()=>ke(),startSession:()=>a.emit("session:start"),endSession:()=>a.emit("session:end")};return ie={ctx:n,api:x,repositionHandler:c,observer:A,unsubPersist:i,persistTimer:l,isChildFrame:t},x}function at(){ke()}function we(){if(!ie)return;let{ctx:e,isChildFrame:t}=ie;if(!t)for(let p of document.querySelectorAll("iframe"))try{p.contentWindow?.postMessage({source:"ano-parent",type:"session:clear"},"*")}catch{}let{store:o,highlightManager:r,pinManager:a,drawingManager:n,sessionManager:s}=e;for(let p of o.getAll())p.type==="highlight"?r.removeHighlight(p.id):p.type==="pin"?a.removePin(p.id):p.type==="drawing"?n.removeDrawing(p.id):p.type==="session"?s.removeSession(p.id):p.type==="recording"&&e.recordingManager&&e.recordingManager.removeRecording(p.id);o.clear(),n.redrawAll(),Lt()}function ke(){if(!ie)return;let{ctx:e,repositionHandler:t,observer:o,unsubPersist:r,persistTimer:a,isChildFrame:n}=ie;if(!n)for(let s of document.querySelectorAll("iframe"))try{s.contentWindow?.postMessage({source:"ano-parent",type:"destroy"},"*")}catch{}r&&r(),a&&clearTimeout(a),o.disconnect(),window.removeEventListener("scroll",t),window.removeEventListener("resize",t),e.shortcutManager.destroy(),e.popover.destroy(),e.endDialog.destroy(),e.toolbar.destroy(),e.highlightManager.destroy(),e.pinManager.destroy(),e.drawingManager.destroy(),e.recordingManager&&e.recordingManager.destroy(),e.sessionManager.destroy(),e._cleanupHighlightClick&&e._cleanupHighlightClick(),e._cleanupFrameMessage&&e._cleanupFrameMessage(),e._cleanupChildMessage&&e._cleanupChildMessage(),n||st(e.store),e.store.clear(),e.store.destroy(),e.events.clear(),Fe(),ie=null}function Nt(e,t){switch(t){case"highlight":e.highlightManager.enable();break;case"pin":e.pinManager.enable();break;case"draw":e.drawingManager.enable();break;case"navigate":break}}function At(e,t){switch(t){case"highlight":e.highlightManager.disable();break;case"pin":e.pinManager.disable();break;case"draw":e.drawingManager.disable();break}}function $t(e,t=5e3){return new Promise(o=>{let r=Date.now(),a=()=>{let n=e.getBlob();if(n){o(n);return}if(Date.now()-r>=t){o(null);return}setTimeout(a,100)};a()})}function ge(){return rt+location.pathname}function st(e){try{let t=e.getAll().map(Ce);localStorage.setItem(ge(),JSON.stringify(t))}catch{}}function Ce(e){let t={...e};return delete t.blob,delete t.blobUrl,delete t._marks,t.pageUrl||(t.pageUrl=window.location.href),t.pageTitle||(t.pageTitle=document.title),t}function se(){let e=ge(),t=[];try{for(let o=0;o<localStorage.length;o++){let r=localStorage.key(o);if(!r.startsWith(rt)||r===e)continue;let a=localStorage.getItem(r);if(!a)continue;let n=JSON.parse(a);Array.isArray(n)&&t.push(...n)}}catch{}return t}function Rt(e){try{let r=localStorage.getItem(ge());if(r){let a=JSON.parse(r);Array.isArray(a)&&a.length>0&&le(e,{annotations:a})}}catch{}let o=se().filter(r=>r.type==="session"||r.type==="recording");if(o.length>0){let r=new Set(e.store.getAll().map(n=>n.id)),a=o.filter(n=>!r.has(n.id));a.length>0&&le(e,{annotations:a})}}function Lt(){try{localStorage.removeItem(ge())}catch{}}function It(e){let{store:t,events:o,popover:r,highlightManager:a,pinManager:n,drawingManager:s}=e;o.on("session:start",()=>{if(e.sessionState!=="idle")return;let l=e.sessionManager.start();e.sessionState="active",e.currentSessionId=l,e.toolbar.getVideoToggleState()&&e.recordingManager&&e.recordingManager.startRecording(),e.toolbar.renderActive(e.sessionManager.getStartTime()),e.setMode("navigate");for(let i of document.querySelectorAll("iframe"))try{i.contentWindow?.postMessage({source:"ano-parent",type:"session:start",sessionId:l},"*")}catch{}}),o.on("session:end",async()=>{if(e.sessionState!=="active")return;let l=e.recordingManager?.isRecording(),i=e.sessionManager.stop();if(!i)return;l&&e.recordingManager.stopRecording(),e.setMode("navigate"),e.sessionState="ending",e.toolbar.renderIdle();for(let O of document.querySelectorAll("iframe"))try{O.contentWindow?.postMessage({source:"ano-parent",type:"session:end"},"*")}catch{}let c=null,A=null;l&&(c=await $t(e.recordingManager),c&&(A=e.recordingManager.getBlobUrl()));let w=t.getAll().filter(O=>O.sessionId===i.sessionId&&O.type!=="session"),u=w.map(O=>O.id),C={type:"session",sessionId:i.sessionId,comment:"",duration:i.duration,actions:i.actions,pages:i.pages,context:{description:i.description},annotationIds:u,hasRecording:!!c};c&&(C.blob=c,C.blobUrl=A),t.add(C),e.endDialog.show({duration:i.duration,actionCount:i.actions.length,pageCount:i.pages.length,annotationCount:u.length,hasRecording:!!c,annotations:w})}),o.on("session:dismissed",()=>{e.sessionState="idle",e.currentSessionId=null,e.recordingManager&&e.recordingManager.clearBlob(),we()}),o.on("session:action",l=>{e.toolbar.updateCount(l)}),o.on("session:resumed",l=>{e.sessionState="active",e.currentSessionId=l.sessionId,e.toolbar.renderActive(l.startTime)}),o.on("recording:stopped",l=>{if(e.sessionState==="ending"||e.sessionState==="idle"){let i=t.getByType("session");for(let c=i.length-1;c>=0;c--){let A=i[c];if(!A.blob&&A.hasRecording===!1&&l.blob){t.update(A.id,{blob:l.blob,blobUrl:l.blobUrl,hasRecording:!0});break}}}}),o.on("session:maxDuration",()=>{o.emit("session:end")}),o.on("highlight:created",l=>{let i=a.getMarksForAnnotation(l.id);if(i.length>0){let c=i[0].getBoundingClientRect();r.show(l.id,c)}}),o.on("pin:created",l=>{e.setMode("navigate");let i=document.querySelector(`[data-ano-id="${l.id}"]`);if(i){let c=i.getBoundingClientRect();r.show(l.id,c)}}),o.on("drawing:created",(l,i)=>{if(e.setMode("navigate"),i&&i.length>0){let c=i[i.length-1],A={x:c.x,y:c.y,top:c.y,left:c.x,bottom:c.y+1,right:c.x+1,width:1,height:1};r.show(l.id,A)}}),o.on("pin:click",l=>{let i=document.querySelector(`[data-ano-id="${l.id}"]`);if(i){let c=i.getBoundingClientRect();r.show(l.id,c)}}),o.on("annotation:focus",l=>{if(!l.frameUrl)if(l.type==="highlight"){let i=a.getMarksForAnnotation(l.id);if(i.length>0){i[0].scrollIntoView({behavior:"smooth",block:"center"});let c=i[0].getBoundingClientRect();setTimeout(()=>r.show(l.id,c),300)}}else l.type==="pin"&&(n.scrollToPin(l.id),setTimeout(()=>{let i=document.querySelector(`[data-ano-id="${l.id}"]`);if(i){let c=i.getBoundingClientRect();r.show(l.id,c)}},300))}),o.on("annotation:delete",l=>{let i=t.get(l);i&&(i.type==="highlight"?a.removeHighlight(l):i.type==="pin"?n.removePin(l):i.type==="drawing"?s.removeDrawing(l):i.type==="recording"&&e.recordingManager?e.recordingManager.removeRecording(l):i.type==="session"&&e.sessionManager.removeSession(l),t.remove(l))}),o.on("export",()=>{ye(t,se())}),o.on("export:json",()=>{Qe(t,se())}),o.on("export:video",()=>{Ze(t)}),o.on("import",()=>{xe(e)}),o.on("share",()=>{ot(t,se(),o)});function p(l){let i=l.target.closest?.(".ano-highlight");if(i&&i.dataset.anoId){l.stopPropagation();let c=i.getBoundingClientRect();r.show(i.dataset.anoId,c);return}if(e.mode==="navigate"){let c=s.hitTest(l.clientX,l.clientY);if(c){l.stopPropagation();let A={x:l.clientX,y:l.clientY,top:l.clientY,left:l.clientX,bottom:l.clientY+1,right:l.clientX+1,width:1,height:1};r.show(c.id,A)}}}document.addEventListener("click",p,!0),e._cleanupHighlightClick=()=>{document.removeEventListener("click",p,!0)}}var q=null;function Dt(e={}){return q=it(e),q}function Bt(){q&&q.clear()}function Pt(){at(),q=null}function Ut(){return q?q.getAll():[]}function zt(){return q?q.toJSON():null}function Ht(){if(q)return q.export()}function jt(){if(q)return q.importFile()}function _t(e){if(q)return q.import(e)}function Ft(e){q&&q.setMode(e)}function Xt(){q&&q.startSession()}function Yt(){q&&q.endSession()}return gt(Wt);})();
