var Ano=(()=>{var ge=Object.defineProperty;var lt=Object.getOwnPropertyDescriptor;var ct=Object.getOwnPropertyNames;var dt=Object.prototype.hasOwnProperty;var pt=(e,t)=>{for(var o in t)ge(e,o,{get:t[o],enumerable:!0})},ut=(e,t,o,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of ct(t))!dt.call(e,s)&&s!==o&&ge(e,s,{get:()=>t[s],enumerable:!(r=lt(t,s))||r.enumerable});return e};var ft=e=>ut(ge({},"__esModule",{value:!0}),e);var Yt={};pt(Yt,{clear:()=>Dt,destroy:()=>Bt,endSession:()=>Xt,export:()=>zt,getAll:()=>Ut,import:()=>jt,importFile:()=>Ht,init:()=>Ot,setMode:()=>Ft,startSession:()=>_t,toJSON:()=>Pt});var gt={theme:"light",mode:"navigate",highlightColor:"#fde047",pinColor:"#3b82f6",drawColor:"#ef4444",drawWidth:3,shortcuts:!0,recordMaxDuration:3e4,recordFrameRate:30,sessionMaxDuration:3e5,videoRecording:!1};function Ce(e={}){return{...gt,...e}}function le(){let e=new Map;return{on(t,o){return e.has(t)||e.set(t,new Set),e.get(t).add(o),()=>e.get(t)?.delete(o)},off(t,o){e.get(t)?.delete(o)},emit(t,...o){e.get(t)?.forEach(r=>r(...o))},clear(){e.clear()}}}var Se="abcdefghijklmnopqrstuvwxyz0123456789";function Te(){let e="",t=crypto.getRandomValues(new Uint8Array(8));for(let o=0;o<8;o++)e+=Se[t[o]%Se.length];return e}function Me(){let e=new Map,t=le(),o=0,r=new Set(["highlight","pin","drawing"]);function s(m){let v=m.id||Te(),g={...m,id:v,createdAt:m.createdAt||Date.now()};return r.has(g.type)&&(g.index==null?(o++,g.index=o):g.index>o&&(o=g.index)),e.set(v,g),t.emit("add",g),t.emit("change",{type:"add",annotation:g}),g}function n(m,v){let g=e.get(m);if(!g)return null;let C={...g,...v,id:m};return e.set(m,C),t.emit("update",C),t.emit("change",{type:"update",annotation:C}),C}function a(m){let v=e.get(m);return v?(e.delete(m),t.emit("remove",v),t.emit("change",{type:"remove",annotation:v}),!0):!1}function p(m){return e.get(m)||null}function l(){return Array.from(e.values())}function i(m){return l().filter(v=>v.type===m)}function d(){let m=l();e.clear(),o=0,t.emit("clear",m),t.emit("change",{type:"clear",annotations:m})}function A(){let m=l().filter(v=>r.has(v.type)&&v.index!=null);o=m.length>0?Math.max(...m.map(v=>v.index)):0}return{add:s,update:n,remove:a,get:p,getAll:l,getByType:i,clear:d,resetCounter:A,on:t.on,off:t.off,emit:t.emit,destroy:t.clear}}function Ee(e){let t=e.toString();if(!t)return null;let o=document.body,r=o.textContent||"",s=document.createRange();s.setStart(o,0),s.setEnd(e.startContainer,e.startOffset);let n=s.toString(),a=Math.max(0,n.length-32),p=n.slice(a),l=document.createRange();l.setStart(e.endContainer,e.endOffset),l.setEnd(o,o.childNodes.length);let d=l.toString().slice(0,32);return{type:"TextQuoteSelector",exact:t,prefix:p,suffix:d}}function Ne(e){if(!e||!e.exact)return null;let o=document.body.textContent||"",{exact:r,prefix:s,suffix:n}=e,a=[],p=0;for(;;){let d=o.indexOf(r,p);if(d===-1)break;a.push(d),p=d+1}if(a.length===0)return null;let l=a[0],i=-1;for(let d of a){let A=0;if(s){let m=o.slice(Math.max(0,d-s.length),d);m===s?A+=2:m.endsWith(s.slice(-8))&&(A+=1)}if(n){let m=o.slice(d+r.length,d+r.length+n.length);m===n?A+=2:m.startsWith(n.slice(0,8))&&(A+=1)}A>i&&(i=A,l=d)}return ht(l,l+r.length)}function ht(e,t){let o=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT),r=0,s=null,n=0,a=null,p=0;for(;o.nextNode();){let l=o.currentNode,i=l.textContent.length;if(!s&&r+i>e&&(s=l,n=e-r),r+i>=t){a=l,p=t-r;break}r+=i}if(!s||!a)return null;try{let l=document.createRange();return l.setStart(s,n),l.setEnd(a,p),l}catch{return null}}function Ae(e){let t=document.body,o=document.createRange();o.setStart(t,0),o.setEnd(e.startContainer,e.startOffset);let r=o.toString().length,s=r+e.toString().length;return{type:"TextPositionSelector",start:r,end:s}}function $e(e){if(!e||e.start==null||e.end==null)return null;let{start:t,end:o}=e,r=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT),s=0,n=null,a=0,p=null,l=0;for(;r.nextNode();){let i=r.currentNode,d=i.textContent.length;if(!n&&s+d>t&&(n=i,a=t-s),s+d>=o){p=i,l=o-s;break}s+=d}if(!n||!p)return null;try{let i=document.createRange();return i.setStart(n,a),i.setEnd(p,l),i}catch{return null}}function ee(e){if(e.id){let s=`#${CSS.escape(e.id)}`;if(Re(s))return s}let t=[],o=e;for(;o&&o!==document.body&&o!==document.documentElement;){let s=o.tagName.toLowerCase();if(o.id){s=`#${CSS.escape(o.id)}`,t.unshift(s);break}let n=o.parentElement;if(n){let a=Array.from(n.children).filter(p=>p.tagName===o.tagName);if(a.length>1){let p=a.indexOf(o)+1;s+=`:nth-of-type(${p})`}}t.unshift(s),o=n}t[0]&&!t[0].startsWith("#")&&t.unshift("body");let r=t.join(" > ");return Re(r),r}function he(e){return{tagName:e.tagName,textContent:(e.textContent||"").trim().slice(0,100),className:e.className||""}}function me(e,t){try{let o=document.querySelector(e);if(o)return o}catch{}if(t){let o=document.querySelectorAll(t.tagName?.toLowerCase()||"*");for(let r of o)if((r.textContent||"").trim().slice(0,100)===t.textContent)return r}return null}function Re(e){try{return document.querySelectorAll(e).length===1}catch{return!1}}function Le(e){if(!e)return null;if(e.textPosition){let t=$e(e.textPosition);if(t&&mt(t,e.textQuote?.exact))return t}if(e.textQuote){let t=Ne(e.textQuote);if(t)return t}return null}function mt(e,t){return t?e.toString()===t:!0}function Oe(e){let{store:t,config:o}=e,r=!1,s=new Map;function n(){r||(r=!0,document.addEventListener("mouseup",p,!0))}function a(){r=!1,document.removeEventListener("mouseup",p,!0)}function p(f){if(Ie(f.target))return;let w=window.getSelection();if(!w||w.isCollapsed||!w.rangeCount)return;let b=w.getRangeAt(0),S=b.toString().trim();if(!S)return;let $={textQuote:Ee(b),textPosition:Ae(b)},Y=g(b,S),U=l(b);if(U.length===0)return;let _=t.add({type:"highlight",text:S,comment:"",selectors:$,context:Y,color:o.highlightColor});s.set(_.id,U),U.forEach((W,X)=>{W.dataset.anoId=_.id,X===0&&_.index!=null&&(W.dataset.anoIndex=_.index)}),w.removeAllRanges(),e.events.emit("highlight:created",_)}function l(f){let w=[],b=i(f);if(b.length===0)return w;for(let S=0;S<b.length;S++){let $=b[S],Y=0,U=$.textContent.length;if(S===0&&(Y=$===f.startContainer?f.startOffset:0),S===b.length-1&&(U=$===f.endContainer?f.endOffset:$.textContent.length),Y===U)continue;let _=$;Y>0&&(_=$.splitText(Y),U-=Y),U<_.textContent.length&&_.splitText(U);let W=document.createElement("mark");W.className="ano-highlight",_.parentNode.insertBefore(W,_),W.appendChild(_),w.push(W)}return w}function i(f){let w=[],b=document.createTreeWalker(f.commonAncestorContainer.nodeType===Node.TEXT_NODE?f.commonAncestorContainer.parentNode:f.commonAncestorContainer,NodeFilter.SHOW_TEXT),S=!1;for(;b.nextNode();){let $=b.currentNode;if(($===f.startContainer||f.startContainer.nodeType!==Node.TEXT_NODE&&f.startContainer.contains($))&&(S=!0),S&&!Ie($.parentNode)&&w.push($),$===f.endContainer||f.endContainer.nodeType!==Node.TEXT_NODE&&f.endContainer.contains($))break}return w}function d(f){if(s.has(f.id))return!0;let w=Le(f.selectors);if(!w)return!1;let b=l(w);return b.length===0?!1:(s.set(f.id,b),b.forEach((S,$)=>{S.dataset.anoId=f.id,$===0&&f.index!=null&&(S.dataset.anoIndex=f.index),f.color&&S.style.setProperty("--ano-hl-color",f.color)}),!0)}function A(f){let w=s.get(f);if(w){for(let b of w){let S=b.parentNode;if(S){for(;b.firstChild;)S.insertBefore(b.firstChild,b);S.removeChild(b),S.normalize()}}s.delete(f)}}function m(){for(let f of[...s.keys()])A(f)}function v(f){return s.get(f)||[]}function g(f,w){let b=f.commonAncestorContainer;b.nodeType===Node.TEXT_NODE&&(b=b.parentElement);let S=C(b),$={selector:ee(S),tagName:S.tagName,text:z(I(S),200)},Y=[],U=S;for(;U&&U!==document.body;){let y=U.tagName.toLowerCase(),x=U.id?`#${U.id}`:"",c=U.getAttribute("role")||"",k=y+x;c&&(k+=`[role=${c}]`),Y.unshift(k),U=U.parentElement}let _=S.textContent||"",W=_.indexOf(w),X="";if(W!==-1){let y=_.slice(Math.max(0,W-80),W).trim(),x=_.slice(W+w.length,W+w.length+80).trim();X=(y?"..."+y+" ":"")+"["+z(w,100)+"]"+(x?" "+x+"...":"")}return{element:$,pagePath:Y,surroundingText:X}}function C(f){let w=new Set(["P","H1","H2","H3","H4","H5","H6","LI","TD","TH","BLOCKQUOTE","FIGCAPTION","CAPTION","LABEL","A","BUTTON","ARTICLE","SECTION","NAV","HEADER","FOOTER","MAIN","ASIDE","DETAILS","SUMMARY"]),b=f;for(;b&&b!==document.body;){if(w.has(b.tagName)||b.id||b.getAttribute("role"))return b;b=b.parentElement}return f}function I(f){if(f.children.length===0)return(f.textContent||"").trim();let w="";for(let b of f.childNodes)if(b.nodeType===Node.TEXT_NODE)w+=b.textContent;else if(b.nodeType===Node.ELEMENT_NODE){let S=getComputedStyle(b).display;(S==="inline"||S==="inline-block")&&(w+=b.textContent)}return w.trim()||(f.textContent||"").trim().slice(0,200)}function z(f,w){return f.length>w?f.slice(0,w)+"...":f}function L(){a(),m()}return{enable:n,disable:a,applyHighlight:d,removeHighlight:A,removeAll:m,getMarksForAnnotation:v,destroy:L}}function Ie(e){if(!e)return!1;if(e.closest&&e.closest("[data-ano]"))return!0;let t=e;for(;t;){if(t.host&&t.host.dataset&&t.host.dataset.ano!==void 0||t.dataset&&t.dataset.ano!==void 0)return!0;t=t.parentNode}return!1}function De(e){let{store:t,config:o}=e,r=!1,s=new Map,n=null,a=null,p=null;function l(){r||(r=!0,d(),document.addEventListener("mousemove",v,!0))}function i(){r=!1,A(),document.removeEventListener("mousemove",v,!0)}function d(){a=document.createElement("div"),a.className="ano-pin-overlay active",a.dataset.ano="",a.addEventListener("click",g,!0),a.addEventListener("mousemove",m),document.body.appendChild(a),n=document.createElement("div"),n.className="ano-pin-hover-outline",n.dataset.ano="",document.body.appendChild(n)}function A(){a&&(a.removeEventListener("click",g,!0),a.removeEventListener("mousemove",m),a.remove(),a=null),n&&(n.remove(),n=null)}function m(y){a.style.pointerEvents="none";let x=document.elementFromPoint(y.clientX,y.clientY);if(a.style.pointerEvents="auto",x&&x.tagName==="IFRAME"){let c=x.getBoundingClientRect();try{x.contentWindow?.postMessage({source:"ano-parent",type:"pin:hover",x:y.clientX-c.left,y:y.clientY-c.top},"*")}catch{}n.style.display="none",p=x;return}if(p){try{p.contentWindow?.postMessage({source:"ano-parent",type:"pin:hover:clear"},"*")}catch{}p=null}if(x&&x!==document.body&&x!==document.documentElement&&!ce(x)){let c=x.getBoundingClientRect();n.style.display="block",n.style.left=`${c.left+window.scrollX}px`,n.style.top=`${c.top+window.scrollY}px`,n.style.width=`${c.width}px`,n.style.height=`${c.height}px`}else n.style.display="none"}function v(){}function g(y){y.preventDefault(),y.stopPropagation(),a.style.pointerEvents="none";let x=document.elementFromPoint(y.clientX,y.clientY);if(a.style.pointerEvents="auto",x&&x.tagName==="IFRAME"){let E=x.getBoundingClientRect();try{x.contentWindow?.postMessage({source:"ano-parent",type:"pin:click",x:y.clientX-E.left,y:y.clientY-E.top},"*")}catch{}e.setMode("navigate");return}if(!x||x===document.body||x===document.documentElement||ce(x))return;let c=ee(x),k=he(x),R=U(x),T=t.add({type:"pin",comment:"",targetSelector:c,targetMeta:k,context:R});C(T,x),e.events.emit("pin:created",T)}function C(y,x){let c=document.createElement("div");c.className="ano-pin-marker",c.dataset.ano="",c.dataset.anoId=y.id,c.textContent=y.index,c.style.setProperty("--ano-pin-color",o.pinColor),document.body.appendChild(c),I(c,x),s.set(y.id,{marker:c,target:x}),c.addEventListener("click",k=>{k.stopPropagation(),e.events.emit("pin:click",y)})}function I(y,x){let c=x.getBoundingClientRect();y.style.left=`${c.left+window.scrollX-12}px`,y.style.top=`${c.top+window.scrollY-12}px`}function z(){for(let[y,{marker:x,target:c}]of s)document.body.contains(c)&&I(x,c)}function L(y){if(s.has(y.id))return!0;let x=me(y.targetSelector,y.targetMeta);return x?(C(y,x),!0):!1}function f(y){let x=s.get(y);x&&(x.marker.remove(),s.delete(y))}function w(){for(let[y]of[...s])f(y)}function b(y,x){if(!r||!n)return;a&&(a.style.pointerEvents="none");let c=document.elementFromPoint(y,x);if(a&&(a.style.pointerEvents="auto"),c&&c!==document.body&&c!==document.documentElement&&!ce(c)){let k=c.getBoundingClientRect();n.style.display="block",n.style.left=`${k.left+window.scrollX}px`,n.style.top=`${k.top+window.scrollY}px`,n.style.width=`${k.width}px`,n.style.height=`${k.height}px`}else n.style.display="none"}function S(y,x){if(!r)return;a&&(a.style.pointerEvents="none");let c=document.elementFromPoint(y,x);if(a&&(a.style.pointerEvents="auto"),!c||c===document.body||c===document.documentElement||ce(c))return;let k=ee(c),R=he(c),T=U(c),E=t.add({type:"pin",comment:"",targetSelector:k,targetMeta:R,context:T});C(E,c),e.events.emit("pin:created",E)}function $(){n&&(n.style.display="none")}function Y(y){let x=s.get(y);x&&x.target.scrollIntoView({behavior:"smooth",block:"center"})}function U(y){let x=y.tagName.toLowerCase(),c={},k=["href","src","action","type","name","placeholder","value","alt","title","role","aria-label","aria-describedby","data-testid","for","method"];for(let j of k){let P=y.getAttribute(j);P&&(c[j]=P.length>120?P.slice(0,120)+"...":P)}let R=_(y),T=[],E=y;for(;E&&E!==document.body;){let j=E.tagName.toLowerCase();if(E.id)j+=`#${E.id}`;else if(E.className&&typeof E.className=="string"){let P=E.className.trim().split(/\s+/).slice(0,2).join(".");P&&(j+=`.${P}`)}E.getAttribute("role")&&(j+=`[role=${E.getAttribute("role")}]`),T.unshift(j),E=E.parentElement}let O=[],D=y.parentElement;if(D)for(let j of D.children){if(j===y)continue;let P=j.tagName.toLowerCase(),H=W((j.textContent||"").trim(),60);if(H&&O.push(`${P}("${H}")`),O.length>=4)break}let F=`${x}`;R&&(F+=`("${W(R,80)}")`),c.type&&(F+=`[type=${c.type}]`),c.href&&(F+=`[href=${W(c.href,60)}]`),c.role&&(F+=`[role=${c.role}]`);let J=D?D.tagName.toLowerCase():"";return J&&(F+=` inside ${J}`),D?.id&&(F+=`#${D.id}`),{description:F,attributes:Object.keys(c).length>0?c:void 0,visibleText:R||void 0,pagePath:T,siblings:O.length>0?O:void 0}}function _(y){let x=y.getAttribute("aria-label");if(x)return x.trim();let c=y.getAttribute("alt");if(c)return c.trim();let k=y.getAttribute("title");if(k)return k.trim();let R="";for(let T of y.childNodes)T.nodeType===Node.TEXT_NODE&&(R+=T.textContent);return R=R.trim(),R||(y.textContent||"").trim().slice(0,150)}function W(y,x){return y.length>x?y.slice(0,x)+"...":y}function X(){i(),w()}return{enable:l,disable:i,applyPin:L,removePin:f,removeAll:w,repositionAll:z,scrollToPin:Y,hoverAt:b,clickAt:S,clearHover:$,destroy:X}}function ce(e){if(!e)return!1;let t=e;for(;t;){if(t.dataset&&t.dataset.ano!==void 0||t.host&&t.host.dataset&&t.host.dataset.ano!==void 0)return!0;t=t.parentNode}return!1}var Be={light:{"--ano-bg":"#ffffff","--ano-bg-secondary":"#f8fafc","--ano-bg-hover":"#f1f5f9","--ano-border":"#e2e8f0","--ano-text":"#1e293b","--ano-text-secondary":"#64748b","--ano-accent":"#3b82f6","--ano-accent-hover":"#2563eb","--ano-highlight":"#fde047","--ano-pin":"#3b82f6","--ano-draw":"#ef4444","--ano-danger":"#ef4444","--ano-danger-hover":"#dc2626","--ano-shadow":"0 4px 24px rgba(0,0,0,0.12)","--ano-shadow-sm":"0 2px 8px rgba(0,0,0,0.08)"},dark:{"--ano-bg":"#1e293b","--ano-bg-secondary":"#0f172a","--ano-bg-hover":"#334155","--ano-border":"#475569","--ano-text":"#f1f5f9","--ano-text-secondary":"#94a3b8","--ano-accent":"#60a5fa","--ano-accent-hover":"#3b82f6","--ano-highlight":"#fbbf24","--ano-pin":"#60a5fa","--ano-draw":"#f87171","--ano-danger":"#f87171","--ano-danger-hover":"#ef4444","--ano-shadow":"0 4px 24px rgba(0,0,0,0.4)","--ano-shadow-sm":"0 2px 8px rgba(0,0,0,0.3)"}};var Ue=`
  :host {
    all: initial;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  .ano-toolbar {
    position: fixed;
    top: 12px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 2px;
    padding: 4px;
    background: var(--ano-bg);
    border: 1px solid var(--ano-border);
    border-radius: 10px;
    box-shadow: var(--ano-shadow);
    z-index: 2147483646;
    user-select: none;
  }
  .ano-toolbar-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    border-radius: 8px;
    border: none;
    background: transparent;
    color: var(--ano-text-secondary);
    cursor: pointer;
    transition: all 0.15s;
    font-size: 18px;
    position: relative;
  }
  .ano-toolbar-btn:hover {
    background: var(--ano-bg-hover);
    color: var(--ano-text);
  }
  .ano-toolbar-btn.active {
    background: var(--ano-accent);
    color: #fff;
  }
  .ano-toolbar-btn .tooltip {
    position: absolute;
    bottom: -30px;
    left: 50%;
    transform: translateX(-50%);
    padding: 3px 8px;
    background: var(--ano-text);
    color: var(--ano-bg);
    font-size: 11px;
    border-radius: 4px;
    white-space: nowrap;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.15s;
  }
  .ano-toolbar-btn:hover .tooltip {
    opacity: 1;
  }
  .ano-toolbar-divider {
    width: 1px;
    margin: 6px 3px;
    background: var(--ano-border);
    flex-shrink: 0;
  }
  .ano-start-session {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 6px 14px;
    border-radius: 8px;
    border: none;
    background: var(--ano-accent);
    color: #fff;
    cursor: pointer;
    transition: all 0.15s;
    font-size: 13px;
    font-weight: 600;
    font-family: inherit;
    white-space: nowrap;
  }
  .ano-start-session:hover {
    background: var(--ano-accent-hover);
  }
  .ano-video-toggle {
    display: flex;
    align-items: center;
    gap: 5px;
    padding: 0 8px;
    font-size: 12px;
    color: var(--ano-text-secondary);
    cursor: pointer;
    user-select: none;
    white-space: nowrap;
  }
  .ano-video-toggle input {
    margin: 0;
    cursor: pointer;
  }
  .ano-session-status {
    display: flex;
    align-items: center;
    gap: 8px;
  }
  @keyframes ano-pulse-dot { 0%,100%{opacity:1} 50%{opacity:.3} }
  .ano-session-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: #22c55e;
    animation: ano-pulse-dot 1s ease-in-out infinite;
    flex-shrink: 0;
  }
  .ano-session-timer {
    font-size: 13px;
    font-weight: 600;
    font-variant-numeric: tabular-nums;
    color: var(--ano-text);
    min-width: 36px;
  }
  .ano-session-count {
    font-size: 12px;
    color: var(--ano-text-secondary);
    white-space: nowrap;
  }
  .ano-end-session {
    display: flex;
    align-items: center;
    gap: 5px;
    padding: 5px 12px;
    border-radius: 8px;
    border: none;
    background: var(--ano-danger);
    color: #fff;
    cursor: pointer;
    transition: all 0.15s;
    font-size: 12px;
    font-weight: 600;
    font-family: inherit;
    white-space: nowrap;
  }
  .ano-end-session:hover {
    background: var(--ano-danger-hover);
  }
  .ano-btn-label {
    font-family: inherit;
  }
`,Pe=`
  :host {
    all: initial;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    font-size: 14px;
    color: var(--ano-text);
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  .ano-popover {
    position: fixed;
    width: 280px;
    background: var(--ano-bg);
    border: 1px solid var(--ano-border);
    border-radius: 10px;
    box-shadow: var(--ano-shadow);
    z-index: 2147483647;
    overflow: hidden;
  }
  .ano-popover-body {
    padding: 12px;
  }
  .ano-popover textarea {
    width: 100%;
    min-height: 60px;
    padding: 8px;
    border: 1px solid var(--ano-border);
    border-radius: 6px;
    background: var(--ano-bg-secondary);
    color: var(--ano-text);
    font-family: inherit;
    font-size: 13px;
    resize: vertical;
    outline: none;
    transition: border-color 0.15s;
  }
  .ano-popover textarea:focus {
    border-color: var(--ano-accent);
  }
  .ano-popover-actions {
    display: flex;
    justify-content: flex-end;
    gap: 6px;
    padding: 8px 12px;
    border-top: 1px solid var(--ano-border);
    background: var(--ano-bg-secondary);
  }
  .ano-popover-btn {
    padding: 5px 12px;
    border-radius: 6px;
    border: 1px solid var(--ano-border);
    background: var(--ano-bg);
    color: var(--ano-text);
    font-size: 12px;
    cursor: pointer;
    transition: all 0.15s;
  }
  .ano-popover-btn:hover {
    background: var(--ano-bg-hover);
  }
  .ano-popover-btn.save {
    background: var(--ano-accent);
    color: #fff;
    border-color: var(--ano-accent);
  }
  .ano-popover-btn.save:hover {
    background: var(--ano-accent-hover);
  }
  .ano-popover-btn.delete {
    color: var(--ano-danger);
    border-color: var(--ano-danger);
  }
  .ano-popover-btn.delete:hover {
    background: var(--ano-danger);
    color: #fff;
  }
  .ano-popover-arrow {
    position: absolute;
    width: 12px;
    height: 12px;
    background: var(--ano-bg);
    border: 1px solid var(--ano-border);
    transform: rotate(45deg);
  }
  .ano-popover-arrow.top {
    bottom: -7px;
    border-top: none;
    border-left: none;
  }
  .ano-popover-arrow.bottom {
    top: -7px;
    border-bottom: none;
    border-right: none;
  }
`,ze=`
  :host {
    all: initial;
  }
  .ano-canvas-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    z-index: 2147483645;
    pointer-events: none;
  }
  .ano-canvas-overlay.active {
    pointer-events: auto;
    cursor: crosshair;
  }
`,vt=`
  .ano-highlight {
    background-color: var(--ano-hl-color, #fde047);
    cursor: pointer;
    border-radius: 2px;
    transition: background-color 0.15s;
  }
  .ano-highlight:hover {
    filter: brightness(0.9);
  }
  .ano-highlight[data-ano-index]::before {
    content: attr(data-ano-index);
    display: inline-block;
    min-width: 14px;
    height: 14px;
    border-radius: 7px;
    background: rgba(0,0,0,0.6);
    color: #fff;
    font-size: 9px;
    font-weight: 700;
    padding: 0 3px;
    margin-right: 2px;
    text-align: center;
    line-height: 14px;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    font-style: normal;
    box-sizing: border-box;
    vertical-align: middle;
  }
`,bt=`
  .ano-pin-marker {
    position: absolute;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: var(--ano-pin-color, #3b82f6);
    color: #fff;
    font-size: 12px;
    font-weight: 700;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 2147483644;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    transition: transform 0.15s;
    pointer-events: auto;
    user-select: none;
  }
  .ano-pin-marker:hover {
    transform: scale(1.2);
  }
  .ano-pin-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    z-index: 2147483643;
    pointer-events: none;
  }
  .ano-pin-overlay.active {
    pointer-events: auto;
    cursor: crosshair;
  }
  .ano-pin-hover-outline {
    position: absolute;
    border: 2px dashed #3b82f6;
    background: rgba(59, 130, 246, 0.08);
    border-radius: 3px;
    pointer-events: none;
    z-index: 2147483643;
    transition: all 0.1s;
  }
`,He=`
  :host {
    all: initial;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    font-size: 14px;
    color: var(--ano-text);
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  .ano-end-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0,0,0,0.4);
    z-index: 2147483647;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .ano-end-dialog {
    background: var(--ano-bg);
    border: 1px solid var(--ano-border);
    border-radius: 14px;
    box-shadow: var(--ano-shadow);
    width: 400px;
    max-width: 90vw;
    overflow: hidden;
  }
  .ano-end-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px 20px;
    border-bottom: 1px solid var(--ano-border);
  }
  .ano-end-header h2 {
    font-size: 16px;
    font-weight: 700;
    color: var(--ano-text);
  }
  .ano-end-close {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 28px;
    height: 28px;
    border-radius: 6px;
    border: none;
    background: transparent;
    color: var(--ano-text-secondary);
    cursor: pointer;
    transition: all 0.15s;
    font-size: 18px;
  }
  .ano-end-close:hover {
    background: var(--ano-bg-hover);
    color: var(--ano-text);
  }
  .ano-end-summary {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    padding: 20px;
  }
  .ano-end-stat {
    padding: 12px;
    border-radius: 10px;
    background: var(--ano-bg-secondary);
    border: 1px solid var(--ano-border);
    text-align: center;
  }
  .ano-end-stat-value {
    font-size: 22px;
    font-weight: 700;
    color: var(--ano-text);
    font-variant-numeric: tabular-nums;
  }
  .ano-end-stat-label {
    font-size: 11px;
    color: var(--ano-text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-top: 2px;
  }
  .ano-end-badge {
    grid-column: 1 / -1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    padding: 8px;
    border-radius: 8px;
    background: var(--ano-bg-secondary);
    border: 1px solid var(--ano-border);
    font-size: 12px;
    color: var(--ano-text-secondary);
  }
  .ano-end-actions {
    display: flex;
    gap: 8px;
    padding: 16px 20px;
    border-top: 1px solid var(--ano-border);
    justify-content: flex-end;
  }
  .ano-end-actions button {
    padding: 7px 16px;
    border-radius: 8px;
    border: 1px solid var(--ano-border);
    background: var(--ano-bg);
    color: var(--ano-text);
    font-size: 13px;
    font-family: inherit;
    cursor: pointer;
    transition: all 0.15s;
  }
  .ano-end-actions button:hover {
    background: var(--ano-bg-hover);
  }
  .ano-end-actions button.primary {
    background: var(--ano-accent);
    color: #fff;
    border-color: var(--ano-accent);
  }
  .ano-end-actions button.primary:hover {
    background: var(--ano-accent-hover);
  }
  .ano-end-actions button:disabled {
    opacity: 0.5;
    cursor: default;
  }
  .ano-end-link-result {
    display: flex;
    gap: 6px;
    padding: 0 20px 16px;
  }
  .ano-end-link-input {
    flex: 1;
    padding: 7px 10px;
    border-radius: 8px;
    border: 1px solid var(--ano-border);
    background: var(--ano-bg-secondary);
    color: var(--ano-text);
    font-size: 12px;
    font-family: monospace;
    outline: none;
  }
  .ano-end-link-copy {
    padding: 7px 14px;
    border-radius: 8px;
    border: 1px solid var(--ano-accent);
    background: var(--ano-accent);
    color: #fff;
    font-size: 13px;
    font-family: inherit;
    cursor: pointer;
    transition: all 0.15s;
    white-space: nowrap;
  }
  .ano-end-link-copy:hover {
    background: var(--ano-accent-hover);
  }
  .ano-end-annotations {
    padding: 0 20px 16px;
  }
  .ano-end-annotations h3 {
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--ano-text-secondary);
    margin-bottom: 8px;
  }
  .ano-end-ann-list {
    max-height: 280px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 6px;
  }
  .ano-end-ann-card {
    padding: 8px 10px;
    border: 1px solid var(--ano-border);
    border-radius: 8px;
    background: var(--ano-bg-secondary);
  }
  .ano-end-ann-type {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 3px;
  }
  .ano-end-ann-type .dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    flex-shrink: 0;
  }
  .ano-end-ann-type.highlight { color: #ca8a04; }
  .ano-end-ann-type.highlight .dot { background: var(--ano-highlight); }
  .ano-end-ann-type.pin { color: var(--ano-pin); }
  .ano-end-ann-type.pin .dot { background: var(--ano-pin); }
  .ano-end-ann-type.drawing { color: var(--ano-draw); }
  .ano-end-ann-type.drawing .dot { background: var(--ano-draw); }
  .ano-end-ann-text {
    font-size: 13px;
    color: var(--ano-text);
    line-height: 1.4;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
  }
  .ano-end-ann-comment {
    font-size: 12px;
    color: var(--ano-text-secondary);
    font-style: italic;
    line-height: 1.4;
    margin-top: 2px;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
  }
`;function je(){let e="ano-host-styles";if(document.getElementById(e))return;let t=document.createElement("style");t.id=e,t.textContent=vt+bt,document.head.appendChild(t)}function Fe(){document.getElementById("ano-host-styles")?.remove()}function ne(e,t){let o=Be[t]||Be.light;for(let[r,s]of Object.entries(o))e.style.setProperty(r,s)}function _e(e){let{store:t,config:o}=e,r=null,s=null,n=null,a=null,p=!1,l=!1,i=null,d=new Set;function A(){if(r)return;r=document.createElement("div"),r.dataset.ano="",s=r.attachShadow({mode:"open"});let c=document.createElement("style");c.textContent=ze,s.appendChild(c),n=document.createElement("canvas"),n.className="ano-canvas-overlay",s.appendChild(n),document.body.appendChild(r),m(),window.addEventListener("resize",m),window.addEventListener("scroll",$)}function m(){if(!n)return;let c=window.devicePixelRatio||1;n.width=window.innerWidth*c,n.height=window.innerHeight*c,n.style.width=window.innerWidth+"px",n.style.height=window.innerHeight+"px",a=n.getContext("2d"),a.scale(c,c),$()}function v(){p||(A(),p=!0,n.classList.add("active"),n.addEventListener("pointerdown",C),n.addEventListener("pointermove",I),n.addEventListener("pointerup",z),n.addEventListener("pointerleave",z))}function g(){p=!1,n&&(n.classList.remove("active"),n.removeEventListener("pointerdown",C),n.removeEventListener("pointermove",I),n.removeEventListener("pointerup",z),n.removeEventListener("pointerleave",z)),l&&f()}function C(c){c.button===0&&(l=!0,n.setPointerCapture(c.pointerId),i={points:[{x:c.clientX,y:c.clientY}],color:o.drawColor,width:o.drawWidth},a.beginPath(),a.strokeStyle=i.color,a.lineWidth=i.width,a.lineCap="round",a.lineJoin="round",a.moveTo(c.clientX,c.clientY))}function I(c){!l||!i||(i.points.push({x:c.clientX,y:c.clientY}),a.lineTo(c.clientX,c.clientY),a.stroke(),a.beginPath(),a.moveTo(c.clientX,c.clientY))}function z(){l&&f()}function L(c){let k=c.points,R=1/0,T=1/0,E=-1/0,O=-1/0;for(let H of k)H.x<R&&(R=H.x),H.y<T&&(T=H.y),H.x>E&&(E=H.x),H.y>O&&(O=H.y);let D=(R+E)/2,F=(T+O)/2,J=r.style.display;r.style.display="none";let j=document.elementFromPoint(D,F);if(r.style.display=J,!j||j===document.documentElement)return null;let P=j.getBoundingClientRect();return P.width<1||P.height<1?null:{selector:ee(j),rect:{x:P.x,y:P.y,width:P.width,height:P.height}}}function f(){if(l=!1,!i||i.points.length<2){i=null;return}let c=w(i),k=L(i),R;if(k){let{rect:O}=k,D=i.points.map(F=>({x:(F.x-O.x)/O.width,y:(F.y-O.y)/O.height}));R=[{...i,points:D}]}else R=[i];let T=t.add({type:"drawing",comment:"",strokes:R,context:c,anchor:k,viewport:{scrollX:window.scrollX,scrollY:window.scrollY,width:window.innerWidth,height:window.innerHeight}});d.add(T.id);let E=i?i.points:[];i=null,e.events.emit("drawing:created",T,E)}function w(c){let k=c.points,R=1/0,T=1/0,E=-1/0,O=-1/0;for(let u of k)u.x<R&&(R=u.x),u.y<T&&(T=u.y),u.x>E&&(E=u.x),u.y>O&&(O=u.y);let D={x:Math.round(R+window.scrollX),y:Math.round(T+window.scrollY),width:Math.round(E-R),height:Math.round(O-T)},F=r.style.display;r.style.display="none";let J=new Set,j=[],P=Math.min(k.length,20),H=Math.max(1,Math.floor(k.length/P));for(let u=0;u<k.length;u+=H){let N=k[u],B=document.elementFromPoint(N.x,N.y);if(!B||B===document.body||B===document.documentElement||B.dataset?.ano!==void 0)continue;let Q=ee(B);if(J.has(Q))continue;J.add(Q);let G=b(B);j.push({selector:Q,tagName:B.tagName,text:G,role:B.getAttribute("role")||void 0,ariaLabel:B.getAttribute("aria-label")||void 0})}r.style.display=F;let K=j.map(u=>{let N=u.tagName.toLowerCase();return u.text?`${N}("${S(u.text,60)}")`:N}),h=K.length>0?`Drawing over: ${K.join(", ")}`:"Drawing on empty area";return{boundingBox:D,elements:j,description:h}}function b(c){let k=c.getAttribute("aria-label");if(k)return k.trim();let R=c.getAttribute("alt");if(R)return R.trim();let T="";for(let O of c.childNodes)O.nodeType===Node.TEXT_NODE&&(T+=O.textContent);return T=T.trim(),T||(c.textContent||"").trim().slice(0,120)}function S(c,k){return c.length>k?c.slice(0,k)+"...":c}function $(){if(!a)return;a.clearRect(0,0,n.width,n.height);let c=t.getByType("drawing");for(let k of c)Y(k)}function Y(c){if(!a||!c.strokes)return;let{anchor:k,viewport:R}=c,T=null;if(k)try{let D=document.querySelector(k.selector);D&&(T=D.getBoundingClientRect())}catch{}let E=1/0,O=1/0;for(let D of c.strokes)if(!(D.points.length<2)){if(a.beginPath(),a.strokeStyle=D.color,a.lineCap="round",a.lineJoin="round",T){let F=T.width/k.rect.width,J=T.height/k.rect.height;a.lineWidth=D.width*Math.min(F,J);let j=D.points[0];a.moveTo(j.x*T.width+T.x,j.y*T.height+T.y);for(let P=1;P<D.points.length;P++){let H=D.points[P];a.lineTo(H.x*T.width+T.x,H.y*T.height+T.y)}for(let P of D.points){let H=P.x*T.width+T.x,K=P.y*T.height+T.y;H<E&&(E=H),K<O&&(O=K)}}else{let F=R?window.scrollX-R.scrollX:0,J=R?window.scrollY-R.scrollY:0;a.lineWidth=D.width;let j=D.points[0];a.moveTo(j.x-F,j.y-J);for(let P=1;P<D.points.length;P++){let H=D.points[P];a.lineTo(H.x-F,H.y-J)}for(let P of D.points){let H=P.x-F,K=P.y-J;H<E&&(E=H),K<O&&(O=K)}}a.stroke()}if(c.index!=null&&isFinite(E)){let F=E,J=O;a.save(),a.beginPath(),a.arc(F,J,9,0,Math.PI*2),a.fillStyle="rgba(0,0,0,0.6)",a.fill(),a.fillStyle="#fff",a.font="bold 10px -apple-system, BlinkMacSystemFont, sans-serif",a.textAlign="center",a.textBaseline="middle",a.fillText(String(c.index),F,J),a.restore()}}function U(c){return d.add(c.id),$(),!0}function _(c){d.delete(c),$()}function W(){d.clear(),a&&a.clearRect(0,0,n.width,n.height)}function X(c,k){let R=t.getByType("drawing");for(let T=R.length-1;T>=0;T--){let E=R[T],O=y(E);if(!O)continue;let D=10;if(c>=O.x-D&&c<=O.x+O.width+D&&k>=O.y-D&&k<=O.y+O.height+D)return E}return null}function y(c){let{anchor:k,viewport:R,strokes:T}=c;if(!T||T.length===0)return null;let E=null;if(k)try{let j=document.querySelector(k.selector);j&&(E=j.getBoundingClientRect())}catch{}let O=1/0,D=1/0,F=-1/0,J=-1/0;for(let j of T)for(let P of j.points){let H,K;if(E)H=P.x*E.width+E.x,K=P.y*E.height+E.y;else{let h=R?window.scrollX-R.scrollX:0,u=R?window.scrollY-R.scrollY:0;H=P.x-h,K=P.y-u}H<O&&(O=H),K<D&&(D=K),H>F&&(F=H),K>J&&(J=K)}return isFinite(O)?{x:O,y:D,width:F-O,height:J-D}:null}function x(){g(),W(),window.removeEventListener("resize",m),window.removeEventListener("scroll",$),r&&(r.remove(),r=null,s=null,n=null,a=null)}return{init:A,enable:v,disable:g,applyDrawing:U,removeDrawing:_,removeAll:W,redrawAll:$,hitTest:X,destroy:x}}var de=!!navigator.mediaDevices?.getDisplayMedia&&!!window.MediaRecorder&&typeof MediaRecorder.isTypeSupported=="function"&&MediaRecorder.isTypeSupported("video/webm")&&!!window.BroadcastChannel,yt=`<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"><title>Ano Recording</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;font-size:13px;background:#1e293b;color:#f1f5f9;display:flex;align-items:center;justify-content:center;min-height:100vh;padding:12px}
.wrap{display:flex;align-items:center;gap:10px}
.dot{width:10px;height:10px;border-radius:50%;background:#ef4444;animation:p 1s ease-in-out infinite;flex-shrink:0}
@keyframes p{0%,100%{opacity:1}50%{opacity:.3}}
.timer{font-weight:600;font-variant-numeric:tabular-nums;font-size:15px;min-width:44px}
button{padding:5px 14px;border-radius:6px;border:1px solid rgba(255,255,255,.25);background:transparent;color:#fff;cursor:pointer;font-size:13px;transition:background .15s}
button:hover{background:rgba(255,255,255,.12)}
#start{background:#ef4444;border-color:#ef4444;font-weight:600;padding:8px 20px;font-size:14px}
#start:hover{background:#dc2626}
.msg{color:#94a3b8;font-size:12px;text-align:center}
</style></head><body>
<div id="app"><button id="start">Share Tab &amp; Record</button></div>
<script>
var ch=new BroadcastChannel('ano-recording');
var rec,chunks=[],startTime=0,stream,timerIv;
ch.onmessage=function(e){
if(e.data.type==='stop')doStop();
if(e.data.type==='ping'&&rec&&rec.state==='recording')ch.postMessage({type:'pong',startTime:startTime});
};
document.getElementById('start').onclick=function(){startCapture()};
function startCapture(){
navigator.mediaDevices.getDisplayMedia({video:{frameRate:30}}).then(function(s){
stream=s;
var mime='video/webm';
if(typeof MediaRecorder.isTypeSupported==='function'&&MediaRecorder.isTypeSupported('video/webm;codecs=vp9'))mime='video/webm;codecs=vp9';
rec=new MediaRecorder(stream,{mimeType:mime});
chunks=[];
rec.ondataavailable=function(e){if(e.data.size>0)chunks.push(e.data)};
rec.onstop=onStop;
rec.start(500);
startTime=Date.now();
stream.getVideoTracks()[0].onended=function(){doStop()};
document.getElementById('app').innerHTML='<div class="wrap"><span class="dot"></span><span class="timer" id="t">0:00</span><button id="stopbtn">Stop</button></div>';
document.getElementById('stopbtn').onclick=function(){doStop()};
timerIv=setInterval(function(){
var sec=Math.floor((Date.now()-startTime)/1000);
var el=document.getElementById('t');
if(el)el.textContent=Math.floor(sec/60)+':'+(sec%60).toString().padStart(2,'0');
},250);
ch.postMessage({type:'started',startTime:startTime});
}).catch(function(){
ch.postMessage({type:'cancelled'});
try{window.close()}catch(e){}
});
}
function doStop(){if(!rec||rec.state==='inactive')return;rec.stop()}
function onStop(){
clearInterval(timerIv);
if(stream)stream.getTracks().forEach(function(t){t.stop()});
var blob=new Blob(chunks,{type:'video/webm'});
var duration=Date.now()-startTime;
ch.postMessage({type:'stopped',duration:duration,blob:blob});
document.getElementById('app').innerHTML='<div class="msg">Recording saved. Closing\\u2026</div>';
setTimeout(function(){try{window.close()}catch(e){}},2000);
}
window.onbeforeunload=function(){if(rec&&rec.state==='recording')doStop()};
<\/script></body></html>`;function Xe(e){let t=new BroadcastChannel("ano-recording"),o=!1,r=null,s=0,n=null,a=null,p=0;t.onmessage=L=>{let{data:f}=L;f.type==="started"?(o=!0,s=f.startTime,e.events.emit("recording:started")):f.type==="stopped"?m(f):f.type==="pong"?o||(o=!0,s=f.startTime):f.type==="cancelled"&&e.events.emit("recording:cancelled")};function l(){o||A()}function i(){t.postMessage({type:"stop"})}function d(){return o}function A(){if(r=window.open("","ano-recorder","width=460,height=600,top=60,left=60"),!r){console.warn("[Ano] Popup blocked \u2014 allow popups for screen recording."),e.events.emit("recording:cancelled");return}r.document.open(),r.document.write(yt),r.document.close()}function m(L){o=!1,L.blob&&(n=L.blob,a=URL.createObjectURL(L.blob),p=L.duration||0),e.events.emit("recording:stopped",{blob:n,blobUrl:a,duration:p}),r=null}function v(){return n}function g(){return a}function C(){a&&URL.revokeObjectURL(a),n=null,a=null,p=0}function I(L){let f=e.store.get(L);f&&f.blobUrl&&URL.revokeObjectURL(f.blobUrl)}function z(){o&&i(),C();try{t.close()}catch{}let L=e.store.getByType("recording");for(let f of L)f.blobUrl&&URL.revokeObjectURL(f.blobUrl)}return setTimeout(()=>t.postMessage({type:"ping"}),100),{startRecording:l,stopRecording:i,isRecording:d,getBlob:v,getBlobUrl:g,clearBlob:C,removeRecording:I,destroy:z}}var ve="ano-session",xt=/password|cc-|cvv|ssn|secret|token/i,wt=0;function kt(){return"ses_"+Date.now().toString(36)+(wt++).toString(36)+Math.random().toString(36).slice(2,6)}function Ye(e){let t=!1,o=null,r=0,s=[],n=[],a=null,p=new WeakMap,l=0,i=null,d={},A=["log","warn","error","info"];function m(h){if(!h)return"unknown";let u=h.tagName.toLowerCase();if(u==="button"||u==="input"&&h.type==="submit"){let B=h.textContent?.trim()||h.value||"";return B?`button("${te(B,40)}")`:"button"}if(u==="a"){let B=h.textContent?.trim()||"";return B?`link("${te(B,40)}")`:`link(${h.href||""})`}if(u==="input")return`input[name="${h.name||h.id||h.type}"]`;if(u==="textarea")return`textarea[name="${h.name||h.id||"textarea"}"]`;if(u==="select"){let B=h.name||h.id||"select";return`select${B!=="select"?`[name="${B}"]`:""}`}if(u==="label"){let B=h.textContent?.trim()||"";return B?`label("${te(B,40)}")`:"label"}if(u==="img")return`img(${h.alt||h.src?.split("/").pop()||""})`;let N=h.textContent?.trim();if(N&&N.length<60&&h.children.length===0)return`${u}("${te(N,40)}")`;if(h.id)return`${u}#${h.id}`;if(h.className&&typeof h.className=="string"){let B=h.className.split(/\s+/).filter(Boolean).slice(0,2).join(".");if(B)return`${u}.${B}`}return u}function v(h){if(h.type==="password")return!0;let u=h.autocomplete||"";return xt.test(u)}function g(h){if(!h)return!1;if(h.closest?.("[data-ano]"))return!0;let u=h;for(;u;){if(u.host&&u.host.dataset&&u.host.dataset.ano!==void 0)return!0;u=u.parentNode}return!1}function C(h,u,N,B,Q){let G={time:Date.now()-r,action:h,target:u||null,selector:N||null,value:B??null,url:Q||window.location.href};s.push(G),y(),e.events.emit("session:action",s.length)}function I(h){if(g(h.target))return;let u=h.target,N=null;try{N=ee(u)}catch{}C("click",m(u),N,null)}function z(h){if(g(h.target))return;let u=h.target,N=p.get(u);N&&clearTimeout(N);let B=setTimeout(()=>{p.delete(u);let Q=v(u)?"[redacted]":u.value,G=null;try{G=ee(u)}catch{}C("type",m(u),G,Q)},500);p.set(u,B)}function L(h){if(g(h.target))return;let u=h.target,N=u.tagName.toLowerCase(),B=u.type?.toLowerCase();if(N==="select"){let Q=u.options?.[u.selectedIndex]?.text||u.value,G=null;try{G=ee(u)}catch{}C("select",m(u),G,Q)}else if(B==="checkbox"||B==="radio"){let Q=u.checked?"checked":"unchecked",G=null;try{G=ee(u)}catch{}C("check",m(u),G,Q)}}function f(){i||(i=setTimeout(()=>{i=null;let h=window.scrollY;Math.abs(h-l)<100||(l=h,C("scroll",null,null,`y=${Math.round(h)}`))},300))}function w(h){if(g(h.target))return;let u=h.target,N=null;try{N=ee(u)}catch{}C("submit",m(u),N,null)}function b(h){let u=h.message||"Unknown error",N=h.filename?` at ${h.filename}:${h.lineno}:${h.colno}`:"";C("error",null,null,`${u}${N}`)}function S(h){let u=h.reason,N;if(u instanceof Error)N=`${u.name}: ${u.message}`;else try{N=JSON.stringify(u)}catch{N=String(u)}C("error","unhandledrejection",null,te(N,300))}function $(){Y(),X()}function Y(){a&&(clearTimeout(a),a=null)}function U(){for(let h of A)d[h]=console[h],console[h]=(...u)=>{if(d[h].apply(console,u),typeof u[0]=="string"&&u[0].startsWith("[Ano]"))return;let N=W(u);C(`console.${h}`,null,null,N)}}function _(){for(let h of A)d[h]&&(console[h]=d[h],delete d[h])}function W(h){let u=h.map(N=>{if(N===null)return"null";if(N===void 0)return"undefined";if(typeof N=="string")return N;if(typeof N=="number"||typeof N=="boolean")return String(N);if(N instanceof Error)return`${N.name}: ${N.message}`;try{let B=JSON.stringify(N);return B.length>200?B.slice(0,200)+"...":B}catch{return String(N)}});return te(u.join(" "),500)}function X(){if(t)try{sessionStorage.setItem(ve,JSON.stringify({active:!0,sessionId:o,startTime:r,actions:s,pages:n}))}catch{}}function y(){a&&clearTimeout(a),a=setTimeout(X,200)}function x(){try{sessionStorage.removeItem(ve)}catch{}}function c(){document.addEventListener("click",I,!0),document.addEventListener("input",z,!0),document.addEventListener("change",L,!0),document.addEventListener("scroll",f,{capture:!0,passive:!0}),document.addEventListener("submit",w,!0),window.addEventListener("beforeunload",$),window.addEventListener("error",b),window.addEventListener("unhandledrejection",S)}function k(){document.removeEventListener("click",I,!0),document.removeEventListener("input",z,!0),document.removeEventListener("change",L,!0),document.removeEventListener("scroll",f,{capture:!0}),document.removeEventListener("submit",w,!0),window.removeEventListener("beforeunload",$),window.removeEventListener("error",b),window.removeEventListener("unhandledrejection",S)}function R(){return t=!0,o=kt(),r=Date.now(),s=[],n=[window.location.href],l=window.scrollY,X(),c(),U(),o}function T(h){t=!0,o=h.sessionId,r=h.startTime,s=h.actions||[],n=h.pages||[],l=window.scrollY;let u=window.location.href;n.includes(u)||n.push(u),C("navigate",document.title,null,u,u),c(),U()}function E(){if(!t)return null;t=!1,Y(),k(),_(),x(),i&&(clearTimeout(i),i=null);let h=Date.now()-r,u=O(h,s,n),N={sessionId:o,duration:h,actions:s.slice(),pages:n.slice(),description:u},B=o;return s=[],n=[],r=0,o=null,N}function O(h,u,N){let Q=[`Session (${Math.round(h/1e3)}s, ${u.length} actions, ${N.length} pages):`];for(let G=0;G<u.length;G++){let q=u[G],st=(q.time/1e3).toFixed(1),Z;switch(q.action){case"click":Z=`Clicked ${q.target}`;break;case"type":Z=`Typed "${te(q.value||"",40)}" in ${q.target}`;break;case"select":Z=`Selected "${q.value}" in ${q.target}`;break;case"check":Z=`${q.value==="checked"?"Checked":"Unchecked"} ${q.target}`;break;case"scroll":Z=`Scrolled to ${q.value}`;break;case"submit":Z=`Submitted ${q.target}`;break;case"navigate":Z=`Navigated to ${q.value}`;break;case"console.log":Z=`console.log: ${te(q.value||"",80)}`;break;case"console.warn":Z=`console.warn: ${te(q.value||"",80)}`;break;case"console.error":Z=`console.error: ${te(q.value||"",80)}`;break;case"console.info":Z=`console.info: ${te(q.value||"",80)}`;break;case"error":Z=`ERROR: ${te(q.value||"",80)}`;break;default:Z=`${q.action} ${q.target||""}`}Q.push(`${G+1}. [${st}s] ${Z}`)}return Q.join(`
`)}function D(){return t}function F(){return o}function J(){return r}function j(){return s.length}function P(h){}function H(){t&&(t=!1,k(),_(),x(),i&&(clearTimeout(i),i=null),a&&(clearTimeout(a),a=null)),s=[],n=[],o=null}function K(){try{let h=sessionStorage.getItem(ve);if(!h)return;let u=JSON.parse(h);u&&u.active&&(T(u),e.events.emit("session:resumed",{sessionId:u.sessionId,startTime:u.startTime}))}catch{}}return setTimeout(K,50),{start:R,stop:E,isActive:D,getSessionId:F,getStartTime:J,getActionCount:j,checkResume:K,removeSession:P,destroy:H}}function te(e,t){return e?e.length>t?e.slice(0,t)+"...":e:""}function M(e,t={},...o){let r=document.createElement(e);for(let[s,n]of Object.entries(t))s==="className"?r.className=n:s==="style"&&typeof n=="object"?Object.assign(r.style,n):s.startsWith("on")&&typeof n=="function"?r.addEventListener(s.slice(2).toLowerCase(),n):s==="html"?r.innerHTML=n:r.setAttribute(s,n);for(let s of o)s!=null&&(typeof s=="string"?r.appendChild(document.createTextNode(s)):r.appendChild(s));return r}function oe(e){let t={highlight:'<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>',pin:'<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>',draw:'<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 19l7-7 3 3-7 7-3-3z"/><path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/><path d="M2 2l7.586 7.586"/></svg>',navigate:'<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 11l19-9-9 19-2-8-8-2z"/></svg>',close:'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>',download:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>',upload:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>',trash:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>',chevron:'<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>',record:'<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="4" fill="currentColor" stroke="none"/></svg>',stop:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="6" y="6" width="12" height="12" rx="1" fill="currentColor" stroke="none"/></svg>',session:'<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>',annotation:'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>',link:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>'},o=document.createElement("span");return o.innerHTML=t[e]||"",o.style.display="inline-flex",o.style.alignItems="center",o}var Ct=[{id:"highlight",label:"Highlight",icon:"highlight",shortcut:"Alt+H"},{id:"pin",label:"Pin",icon:"pin",shortcut:"Alt+P"},{id:"draw",label:"Draw",icon:"draw",shortcut:"Alt+D"},{id:"navigate",label:"Navigate",icon:"navigate",shortcut:"Alt+N"}];function We(e){let t=null,o=null,r=null,s={},n=null,a=null,p=null,l=null;function i(){t=document.createElement("div"),t.dataset.ano="",o=t.attachShadow({mode:"open"});let L=document.createElement("style");L.textContent=Ue,o.appendChild(L),ne(t,e.config.theme),r=M("div",{className:"ano-toolbar"}),o.appendChild(r),document.body.appendChild(t),d()}function d(){C(),s={},r.innerHTML="";let L=M("button",{className:"ano-start-session",onClick:()=>e.events.emit("session:start")},oe("session"),M("span",{className:"ano-btn-label"},"Start Session"));if(r.appendChild(L),de){let f=M("label",{className:"ano-video-toggle"});l=document.createElement("input"),l.type="checkbox",l.checked=e.config.videoRecording,f.appendChild(l),f.appendChild(oe("record")),f.appendChild(document.createTextNode("Video")),r.appendChild(f)}}function A(L){C(),s={},r.innerHTML="";for(let S of Ct){let $=M("button",{className:"ano-toolbar-btn",title:S.label,onClick:()=>e.setMode(S.id)},oe(S.icon),M("span",{className:"tooltip"},`${S.label} (${S.shortcut})`));s[S.id]=$,r.appendChild($)}r.appendChild(M("div",{className:"ano-toolbar-divider"}));let f=M("div",{className:"ano-session-status"});f.appendChild(M("span",{className:"ano-session-dot"})),n=M("span",{className:"ano-session-timer"},"0:00"),f.appendChild(n),a=M("span",{className:"ano-session-count"},"(0)"),f.appendChild(a);let w=M("button",{className:"ano-end-session",onClick:()=>e.events.emit("session:end")},oe("stop"),M("span",{className:"ano-btn-label"},"End"));f.appendChild(w),r.appendChild(f);let b=()=>{if(!n)return;let S=Date.now()-L,$=Math.floor(S/1e3),Y=Math.floor($/60),U=$%60;n.textContent=`${Y}:${U.toString().padStart(2,"0")}`};b(),p=setInterval(b,250)}function m(L){a&&(a.textContent=`(${L})`)}function v(){return l?l.checked:!1}function g(L){for(let[f,w]of Object.entries(s))w.classList.toggle("active",f===L)}function C(){p&&(clearInterval(p),p=null),n=null,a=null}function I(L){t&&ne(t,L)}function z(){C(),t&&(t.remove(),t=null,o=null,r=null,s={},l=null)}return{render:i,renderIdle:d,renderActive:A,setActive:g,updateCount:m,getVideoToggleState:v,updateTheme:I,destroy:z}}function Je(e){let{store:t}=e,o=null,r=null,s=null,n=null;function a(){if(o)return;o=document.createElement("div"),o.dataset.ano="",r=o.attachShadow({mode:"open"});let g=document.createElement("style");g.textContent=Pe,r.appendChild(g),ne(o,e.config.theme),document.body.appendChild(o)}function p(g,C){if(a(),s===g)return;i(),s=g;let I=t.get(g);if(!I)return;let z=M("div",{className:"ano-popover"}),L=M("div",{className:"ano-popover-body"}),f=M("textarea",{placeholder:"Add a comment..."});f.value=I.comment||"",L.appendChild(f),z.appendChild(L);let w=M("div",{className:"ano-popover-actions"}),b=M("button",{className:"ano-popover-btn delete",onClick:()=>{e.events.emit("annotation:delete",g),i()}},"Delete"),S=M("button",{className:"ano-popover-btn",onClick:()=>i()},"Cancel"),$=M("button",{className:"ano-popover-btn save",onClick:()=>{t.update(g,{comment:f.value}),i()}},"Save");w.appendChild(b),w.appendChild(S),w.appendChild($),z.appendChild(w);let Y=M("div",{className:"ano-popover-arrow"});z.appendChild(Y),r.appendChild(z),requestAnimationFrame(()=>{l(z,Y,C),f.focus();function U(_){o&&!o.shadowRoot.contains(_.target)&&!o.contains(_.target)&&(t.update(g,{comment:f.value}),i())}document.addEventListener("click",U,!0),n=()=>{document.removeEventListener("click",U,!0)}}),f.addEventListener("keydown",U=>{U.key==="Enter"&&(U.metaKey||U.ctrlKey)&&(t.update(g,{comment:f.value}),i()),U.key==="Escape"&&(t.update(g,{comment:f.value}),i()),U.stopPropagation()})}function l(g,C,I){let z=g.getBoundingClientRect(),L=window.innerWidth,f=window.innerHeight,w,b,S="top";w=I.bottom+8,w+z.height>f&&(w=I.top-z.height-8,S="bottom"),b=I.left+I.width/2-z.width/2,b=Math.max(8,Math.min(b,L-z.width-8)),g.style.top=`${w}px`,g.style.left=`${b}px`,C.className=`ano-popover-arrow ${S}`;let $=I.left+I.width/2-b-6;C.style.left=`${Math.max(12,Math.min($,z.width-24))}px`}function i(){if(n&&(n(),n=null),!r)return;let g=r.querySelector(".ano-popover");g&&g.remove(),s=null}function d(){return s!==null}function A(){return s}function m(g){o&&ne(o,g)}function v(){i(),o&&(o.remove(),o=null,r=null)}return{init:a,show:p,hide:i,isOpen:d,getCurrentId:A,updateTheme:m,destroy:v}}function Ve(e){let t=null,o=null;function r(m){i(),t=document.createElement("div"),t.dataset.ano="",o=t.attachShadow({mode:"open"});let v=document.createElement("style");v.textContent=He,o.appendChild(v),ne(t,e.config.theme);let g=M("div",{className:"ano-end-overlay"});g.addEventListener("click",X=>{X.target===g&&l()});let C=M("div",{className:"ano-end-dialog"}),I=M("button",{className:"ano-end-close",onClick:()=>l()});I.appendChild(oe("close")),C.appendChild(M("div",{className:"ano-end-header"},M("h2",{},"Report Ready"),I));let z=M("div",{className:"ano-end-summary"});if(z.appendChild(s(p(m.duration),"Duration")),z.appendChild(s(String(m.actionCount),"Actions")),z.appendChild(s(String(m.pageCount),"Pages")),z.appendChild(s(String(m.annotationCount),"Annotations")),m.hasRecording){let X=M("div",{className:"ano-end-badge"});X.appendChild(oe("record")),X.appendChild(document.createTextNode("Video recorded")),z.appendChild(X)}if(C.appendChild(z),m.annotations&&m.annotations.length>0){let X=M("div",{className:"ano-end-annotations"});X.appendChild(M("h3",{},"Annotations"));let y=M("div",{className:"ano-end-ann-list"}),x=0;for(let c of m.annotations){if(c.type==="session"||c.type==="recording")continue;let k=M("div",{className:"ano-end-ann-card"});c.type==="highlight"?(k.appendChild(n("highlight","Highlight")),c.quote&&k.appendChild(M("div",{className:"ano-end-ann-text"},`"${a(c.quote,120)}"`))):c.type==="pin"?(x++,k.appendChild(n("pin",`Pin #${x}`)),c.target?.description&&k.appendChild(M("div",{className:"ano-end-ann-text"},c.target.description))):c.type==="drawing"&&k.appendChild(n("drawing","Drawing")),c.comment&&k.appendChild(M("div",{className:"ano-end-ann-comment"},c.comment)),y.appendChild(k)}X.appendChild(y),C.appendChild(X)}let L=M("div",{className:"ano-end-actions"}),f=M("button",{onClick:()=>l()},"Dismiss"),w=M("button",{onClick:()=>{w.textContent="Uploading\u2026",w.disabled=!0,e.events.emit("share")}},"Get Link"),b=M("div",{className:"ano-end-link-result"});b.style.display="none";let S=M("input",{readOnly:!0,className:"ano-end-link-input"}),$=M("button",{className:"ano-end-link-copy",onClick:()=>{navigator.clipboard.writeText(S.value).then(()=>{$.textContent="Copied!",setTimeout(()=>{$.textContent="Copy"},2e3)})}},"Copy");b.appendChild(S),b.appendChild($);let Y=e.events.on("share:complete",X=>{w.style.display="none",S.value=X,b.style.display=""}),U=e.events.on("share:error",()=>{w.textContent="Failed \u2014 retry",w.disabled=!1}),_=i;i=function(){Y(),U(),_()};let W=M("button",{className:"primary",onClick:()=>{e.events.emit("export:json"),l()}},"Export JSON");if(L.appendChild(f),L.appendChild(w),m.hasRecording){let X=M("button",{onClick:()=>{e.events.emit("export:video"),l()}},"Export Video");L.appendChild(X)}L.appendChild(W),C.appendChild(L),C.appendChild(b),g.appendChild(C),o.appendChild(g),document.body.appendChild(t)}function s(m,v){return M("div",{className:"ano-end-stat"},M("div",{className:"ano-end-stat-value"},m),M("div",{className:"ano-end-stat-label"},v))}function n(m,v){let g=M("div",{className:`ano-end-ann-type ${m}`});return g.appendChild(M("span",{className:"dot"})),g.appendChild(document.createTextNode(v)),g}function a(m,v){return!m||m.length<=v?m||"":m.slice(0,v)+"\u2026"}function p(m){let v=Math.floor((m||0)/1e3),g=Math.floor(v/60),C=v%60;return`${g}:${C.toString().padStart(2,"0")}`}function l(){i(),e.events.emit("session:dismissed")}function i(){t&&(t.remove(),t=null,o=null)}function d(){return t!==null}function A(){i()}return{show:r,hide:i,dismiss:l,isOpen:d,destroy:A}}function qe(e){let t=!1,o={"alt+h":()=>{e.sessionState==="active"&&e.setMode("highlight")},"alt+p":()=>{e.sessionState==="active"&&e.setMode("pin")},"alt+d":()=>{e.sessionState==="active"&&e.setMode("draw")},"alt+n":()=>{e.sessionState==="active"&&e.setMode("navigate")},"alt+s":()=>{e.sessionState==="idle"?e.events.emit("session:start"):e.sessionState==="active"&&e.events.emit("session:end")},"alt+e":()=>e.events.emit("export"),escape:()=>{e.popover.isOpen()?e.popover.hide():e.sessionState==="active"?e.events.emit("session:end"):e.endDialog&&e.endDialog.isOpen()&&e.endDialog.dismiss()}};function r(i){let d=i.target.tagName;if(d==="INPUT"||d==="TEXTAREA"||d==="SELECT"){if(i.key==="Escape"&&(i.target.closest?.("[data-ano]")||n(i.target))){o.escape();return}return}let A=s(i);o[A]&&(i.preventDefault(),i.stopPropagation(),o[A]())}function s(i){let d=[];return i.altKey&&d.push("alt"),i.ctrlKey&&d.push("ctrl"),i.metaKey&&d.push("meta"),i.shiftKey&&d.push("shift"),d.push(i.key.toLowerCase()),d.join("+")}function n(i){let d=i;for(;d;){if(d.host&&d.host.dataset&&d.host.dataset.ano!==void 0)return!0;d=d.parentNode}return!1}function a(){t||(t=!0,document.addEventListener("keydown",r,!0))}function p(){t=!1,document.removeEventListener("keydown",r,!0)}function l(){p()}return{enable:a,disable:p,destroy:l}}function be(e,t=[]){let o=ie(e,t),r=JSON.stringify(o,null,2),s=new Blob([r],{type:"application/json"}),n=URL.createObjectURL(s),a=document.createElement("a");a.href=n,a.download=`annotations-${Ze()}.json`,a.style.display="none",document.body.appendChild(a),a.click(),setTimeout(()=>{URL.revokeObjectURL(n),a.remove()},100);let p=e.getByType("recording");for(let i of p)i.blob&&ue(i.blob,`recording-${i.id}.webm`);let l=e.getByType("session");for(let i of l)i.blob&&ue(i.blob,`session-${i.sessionId||i.id}.webm`);return o}function Ge(e,t=[]){let o=ie(e,t),r=JSON.stringify(o,null,2),s=new Blob([r],{type:"application/json"}),n=URL.createObjectURL(s),a=document.createElement("a");return a.href=n,a.download=`annotations-${Ze()}.json`,a.style.display="none",document.body.appendChild(a),a.click(),setTimeout(()=>{URL.revokeObjectURL(n),a.remove()},100),o}function Qe(e){let t=e.getByType("recording");for(let r of t)r.blob&&ue(r.blob,`recording-${r.id}.webm`);let o=e.getByType("session");for(let r of o)r.blob&&ue(r.blob,`session-${r.sessionId||r.id}.webm`)}function ue(e,t){let o=URL.createObjectURL(e),r=document.createElement("a");r.href=o,r.download=t,r.style.display="none",document.body.appendChild(r),r.click(),setTimeout(()=>{URL.revokeObjectURL(o),r.remove()},100)}function ie(e,t=[]){let o=e.getAll().map(a=>{let p=Ke(a);return p.pageUrl=p.pageUrl||window.location.href,p.pageTitle=p.pageTitle||document.title,p}),r=t.map(a=>{let p=Ke(a);return p.pageUrl=p.pageUrl||a.pageUrl||"unknown",p.pageTitle=p.pageTitle||a.pageTitle||"",p}),s=new Set(o.map(a=>a.id)),n=[...o];for(let a of r)s.has(a.id)||(s.add(a.id),n.push(a));return n.sort((a,p)=>a.createdAt-p.createdAt),{version:"1.0",exportedAt:new Date().toISOString(),pageUrl:window.location.href,pageTitle:document.title,environment:St(),annotations:n,summary:Tt(n)}}function St(){let e=navigator,t=screen,o=e.connection||e.mozConnection||e.webkitConnection,r={userAgent:e.userAgent,platform:e.platform,language:e.language,languages:e.languages?[...e.languages]:[e.language],timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,timezoneOffset:new Date().getTimezoneOffset(),screen:{width:t.width,height:t.height,devicePixelRatio:window.devicePixelRatio,colorDepth:t.colorDepth,orientation:t.orientation?.type||null},viewport:{width:window.innerWidth,height:window.innerHeight},deviceMemory:e.deviceMemory||null,hardwareConcurrency:e.hardwareConcurrency||null,touchSupport:e.maxTouchPoints>0,cookiesEnabled:e.cookieEnabled,doNotTrack:e.doNotTrack||null};return o&&(r.connection={effectiveType:o.effectiveType||null,downlink:o.downlink||null,rtt:o.rtt||null,saveData:o.saveData||!1}),r}function Ke(e){let t={};return t.id=e.id,t.type=e.type,t.comment=e.comment||"",t.createdAt=e.createdAt,e.type==="highlight"?(t.text=e.text,t.context=e.context||null,t._anchoring={selectors:e.selectors},e.color&&(t.color=e.color)):e.type==="pin"?(t.index=e.index,t.context=e.context||null,t._anchoring={targetSelector:e.targetSelector,targetMeta:e.targetMeta}):e.type==="drawing"?(t.context=e.context||null,t._anchoring={strokes:e.strokes,viewport:e.viewport}):e.type==="recording"?(t.duration=e.duration,t.region=e.region,t.context=e.context||null,t._anchoring={viewport:e.viewport,file:`recording-${e.id}.webm`}):e.type==="session"&&(t.duration=e.duration,t.pages=e.pages,t.context=e.context||null,t.sessionId=e.sessionId||null,t.annotationIds=e.annotationIds||[],t.hasRecording=e.hasRecording||!1,t._anchoring={actions:e.actions},e.blob&&(t._anchoring.file=`session-${e.sessionId||e.id}.webm`)),e.pageUrl&&(t.pageUrl=e.pageUrl),e.pageTitle&&(t.pageTitle=e.pageTitle),e._orphaned&&(t.orphaned=!0),t}function Tt(e){let t=new Map;for(let r of e){let s=r.pageUrl||"unknown";t.has(s)||t.set(s,[]),t.get(s).push(r)}let o=[];for(let[r,s]of t){t.size>1&&o.push(`
--- ${r} ---`);for(let n of s){let a=n.comment?` \u2014 "${n.comment}"`:"";if(n.type==="highlight"){let p=n.context?.element?` in <${n.context.element.tagName?.toLowerCase()||"element"}>`:"",l=n.context?.pagePath?` (${n.context.pagePath.join(" > ")})`:"";o.push(`[Highlight] "${Mt(n.text,80)}"${p}${l}${a}`)}else if(n.type==="pin"){let p=n.context?.description||`element #${n.index}`;o.push(`[Pin #${n.index}] ${p}${a}`)}else if(n.type==="drawing"){let p=n.context?.description||"freehand drawing";o.push(`[Drawing] ${p}${a}`)}else if(n.type==="recording"){let p=Math.round((n.duration||0)/1e3),l=n.context?.description||"screen recording";o.push(`[Recording ${p}s] ${l}${a}`)}else if(n.type==="session"){let p=Math.round((n.duration||0)/1e3),l=n.context?.description||"session recording";o.push(`[Session ${p}s] ${l}${a}`)}}}return o.join(`
`).trim()}function Mt(e,t){return e?e.length>t?e.slice(0,t)+"...":e:""}function Ze(){let e=new Date;return`${e.getFullYear()}-${pe(e.getMonth()+1)}-${pe(e.getDate())}_${pe(e.getHours())}${pe(e.getMinutes())}`}function pe(e){return e.toString().padStart(2,"0")}function ye(e){return new Promise(t=>{let o=document.createElement("input");o.type="file",o.accept=".json",o.style.display="none",document.body.appendChild(o),o.addEventListener("change",async()=>{let r=o.files[0];if(!r){o.remove(),t({success:!1,error:"No file selected"});return}try{let s=await r.text(),n=JSON.parse(s),a=se(e,n);t(a)}catch(s){t({success:!1,error:s.message})}finally{o.remove()}}),o.click()})}function se(e,t){if(!t||!t.annotations||!Array.isArray(t.annotations))return{success:!1,error:"Invalid annotation data"};let{store:o,highlightManager:r,pinManager:s,drawingManager:n}=e,a={imported:0,orphaned:0,orphans:[]};for(let p of t.annotations){let l={...p};l._anchoring&&(Object.assign(l,l._anchoring),delete l._anchoring);let i=o.add(l),d=!1;i.type==="highlight"?d=r.applyHighlight(i):i.type==="pin"?d=s.applyPin(i):i.type==="drawing"?d=n.applyDrawing(i):(i.type==="recording"||i.type==="session")&&(d=!0),d?a.imported++:(a.orphaned++,a.orphans.push(i.id),o.update(i.id,{_orphaned:!0}))}return{success:!0,...a}}var et="https://share.mk/files/";async function tt(e,t){let o=await fetch(et,{method:"POST",headers:{"Tus-Resumable":"1.0.0","Upload-Length":String(e.byteLength),"Upload-Metadata":t.map(([a,p])=>`${a} ${btoa(p)}`).join(",")}});if(!o.ok)throw new Error(`Upload failed: ${o.status}`);let r=o.headers.get("Location");if(!r)throw new Error("No Location header in response");let s=r.startsWith("http")?r:new URL(r,et).href,n=await fetch(s,{method:"PATCH",headers:{"Tus-Resumable":"1.0.0","Upload-Offset":"0","Content-Type":"application/offset+octet-stream"},body:e});if(!n.ok)throw new Error(`Patch failed: ${n.status}`);return s}async function nt(e,t,o){try{o.emit("share:uploading");let r=ie(e,t),s=[];for(let i of e.getAll())if((i.type==="recording"||i.type==="session")&&i.blob){let d=i.type==="recording"?`recording-${i.id}.webm`:`session-${i.sessionId||i.id}.webm`;s.push({id:i.id,type:i.type,sessionId:i.sessionId,blob:i.blob,filename:d})}let n=new Map;for(let i of s){let d=new Uint8Array(await i.blob.arrayBuffer()),A=await tt(d,[["filename",i.filename],["content-type","video/webm"],["expires-in","7d"]]);n.set(i.filename,A)}if(n.size>0)for(let i of r.annotations)i._anchoring?.file&&n.has(i._anchoring.file)&&(i._anchoring.file=n.get(i._anchoring.file));let a=JSON.stringify(r,null,2),p=new TextEncoder().encode(a),l=await tt(p,[["filename","annotations.json"],["content-type","application/json"],["expires-in","7d"]]);try{await navigator.clipboard.writeText(l)}catch{}return o.emit("share:complete",l),l}catch(r){return o.emit("share:error",r),null}}var ot="ano:",re=null;function rt(e={}){if(re)return console.warn("[Ano] Already initialized. Call Ano.destroy() first."),re.api;let t=window!==window.top,o=Ce(e),r=Me(),s=le(),n={config:o,store:r,events:s,mode:"navigate",sessionState:"idle",currentSessionId:null,toolbar:null,popover:null,endDialog:null,highlightManager:null,pinManager:null,drawingManager:null,recordingManager:null,sessionManager:null,shortcutManager:null,setMode:null};n.highlightManager=Oe(n),n.pinManager=De(n),n.drawingManager=_e(n),de&&(n.recordingManager=Xe(n)),n.sessionManager=Ye(n);let a={render:()=>{},renderIdle:()=>{},renderActive:()=>{},setActive:()=>{},updateCount:()=>{},getVideoToggleState:()=>!1,destroy:()=>{}},p={show:()=>{},destroy:()=>{}};n.toolbar=t?a:We(n),n.popover=Je(n),n.endDialog=t?p:Ve(n),n.shortcutManager=qe(n),n.setMode=v=>{if(!(!t&&n.sessionState!=="active"&&v!=="navigate")&&(Nt(n,n.mode),n.mode=v,Et(n,v),!t)){n.toolbar.setActive(v);for(let g of document.querySelectorAll("iframe"))try{g.contentWindow?.postMessage({source:"ano-parent",type:"mode:set",payload:v},"*")}catch{}}},Lt(n),je(),n.drawingManager.init(),n.toolbar.render(),n.popover.init(),o.shortcuts&&!t&&n.shortcutManager.enable();let l=null,i=null;t||($t(n),i=r.on("change",()=>{l&&clearTimeout(l),l=setTimeout(()=>at(r),500)})),r.on("add",v=>{n.sessionState==="active"&&n.currentSessionId&&v.type!=="session"&&!v.sessionId&&r.update(v.id,{sessionId:n.currentSessionId})});let d=()=>n.pinManager.repositionAll();window.addEventListener("scroll",d,{passive:!0}),window.addEventListener("resize",d,{passive:!0});let A=new MutationObserver(v=>{for(let g of v)for(let C of g.removedNodes)if(C.classList?.contains("ano-highlight")&&C.dataset?.anoId){let I=C.dataset.anoId;r.get(I)&&r.update(I,{_orphaned:!0})}});if(A.observe(document.body,{childList:!0,subtree:!0}),t){let v=function(g){!g.data||g.data.source!=="ano-parent"||(g.data.type==="mode:set"?n.setMode(g.data.payload):g.data.type==="pin:hover"?n.pinManager.hoverAt(g.data.x,g.data.y):g.data.type==="pin:hover:clear"?n.pinManager.clearHover():g.data.type==="pin:click"?n.pinManager.clickAt(g.data.x,g.data.y):g.data.type==="session:start"?(n.sessionState="active",n.currentSessionId=g.data.sessionId):g.data.type==="session:end"?n.sessionState="ending":g.data.type==="session:clear"?(xe(),n.sessionState="idle",n.currentSessionId=null):g.data.type==="destroy"&&we())};r.on("add",g=>window.parent.postMessage({source:"ano-frame",type:"annotation:add",payload:ke(g),frameUrl:location.href},"*")),r.on("update",g=>window.parent.postMessage({source:"ano-frame",type:"annotation:update",payload:ke(g),frameUrl:location.href},"*")),r.on("remove",g=>window.parent.postMessage({source:"ano-frame",type:"annotation:remove",payload:g.id,frameUrl:location.href},"*")),window.addEventListener("message",v),n._cleanupChildMessage=()=>window.removeEventListener("message",v)}if(!t){let v=function(g){if(!g.data||g.data.source!=="ano-frame")return;let{type:C,payload:I,frameUrl:z}=g.data;C==="annotation:add"?r.add({...I,frameUrl:z}):C==="annotation:update"?r.update(I.id,{...I,frameUrl:z}):C==="annotation:remove"&&r.remove(I)};window.addEventListener("message",v),n._cleanupFrameMessage=()=>window.removeEventListener("message",v)}let m={getAll:()=>r.getAll(),toJSON:()=>ie(r,ae()),export:()=>be(r,ae()),importFile:()=>ye(n),import:v=>se(n,v),setMode:v=>n.setMode(v),share:()=>s.emit("share"),clear:()=>xe(),destroy:()=>we(),startSession:()=>s.emit("session:start"),endSession:()=>s.emit("session:end")};return re={ctx:n,api:m,repositionHandler:d,observer:A,unsubPersist:i,persistTimer:l,isChildFrame:t},m}function it(){we()}function xe(){if(!re)return;let{ctx:e,isChildFrame:t}=re;if(!t)for(let p of document.querySelectorAll("iframe"))try{p.contentWindow?.postMessage({source:"ano-parent",type:"session:clear"},"*")}catch{}let{store:o,highlightManager:r,pinManager:s,drawingManager:n,sessionManager:a}=e;for(let p of o.getAll())p.type==="highlight"?r.removeHighlight(p.id):p.type==="pin"?s.removePin(p.id):p.type==="drawing"?n.removeDrawing(p.id):p.type==="session"?a.removeSession(p.id):p.type==="recording"&&e.recordingManager&&e.recordingManager.removeRecording(p.id);o.clear(),n.redrawAll(),Rt()}function we(){if(!re)return;let{ctx:e,repositionHandler:t,observer:o,unsubPersist:r,persistTimer:s,isChildFrame:n}=re;if(!n)for(let a of document.querySelectorAll("iframe"))try{a.contentWindow?.postMessage({source:"ano-parent",type:"destroy"},"*")}catch{}r&&r(),s&&clearTimeout(s),o.disconnect(),window.removeEventListener("scroll",t),window.removeEventListener("resize",t),e.shortcutManager.destroy(),e.popover.destroy(),e.endDialog.destroy(),e.toolbar.destroy(),e.highlightManager.destroy(),e.pinManager.destroy(),e.drawingManager.destroy(),e.recordingManager&&e.recordingManager.destroy(),e.sessionManager.destroy(),e._cleanupHighlightClick&&e._cleanupHighlightClick(),e._cleanupFrameMessage&&e._cleanupFrameMessage(),e._cleanupChildMessage&&e._cleanupChildMessage(),n||at(e.store),e.store.clear(),e.store.destroy(),e.events.clear(),Fe(),re=null}function Et(e,t){switch(t){case"highlight":e.highlightManager.enable();break;case"pin":e.pinManager.enable();break;case"draw":e.drawingManager.enable();break;case"navigate":break}}function Nt(e,t){switch(t){case"highlight":e.highlightManager.disable();break;case"pin":e.pinManager.disable();break;case"draw":e.drawingManager.disable();break}}function At(e,t=5e3){return new Promise(o=>{let r=Date.now(),s=()=>{let n=e.getBlob();if(n){o(n);return}if(Date.now()-r>=t){o(null);return}setTimeout(s,100)};s()})}function fe(){return ot+location.pathname}function at(e){try{let t=e.getAll().map(ke);localStorage.setItem(fe(),JSON.stringify(t))}catch{}}function ke(e){let t={...e};return delete t.blob,delete t.blobUrl,delete t._marks,t.pageUrl||(t.pageUrl=window.location.href),t.pageTitle||(t.pageTitle=document.title),t}function ae(){let e=fe(),t=[];try{for(let o=0;o<localStorage.length;o++){let r=localStorage.key(o);if(!r.startsWith(ot)||r===e)continue;let s=localStorage.getItem(r);if(!s)continue;let n=JSON.parse(s);Array.isArray(n)&&t.push(...n)}}catch{}return t}function $t(e){try{let r=localStorage.getItem(fe());if(r){let s=JSON.parse(r);Array.isArray(s)&&s.length>0&&se(e,{annotations:s})}}catch{}let o=ae().filter(r=>r.type==="session"||r.type==="recording");if(o.length>0){let r=new Set(e.store.getAll().map(n=>n.id)),s=o.filter(n=>!r.has(n.id));s.length>0&&se(e,{annotations:s})}}function Rt(){try{localStorage.removeItem(fe())}catch{}}function Lt(e){let{store:t,events:o,popover:r,highlightManager:s,pinManager:n,drawingManager:a}=e;o.on("session:start",()=>{if(e.sessionState!=="idle")return;let l=e.sessionManager.start();e.sessionState="active",e.currentSessionId=l,e.toolbar.getVideoToggleState()&&e.recordingManager&&e.recordingManager.startRecording(),e.toolbar.renderActive(e.sessionManager.getStartTime()),e.setMode("navigate");for(let i of document.querySelectorAll("iframe"))try{i.contentWindow?.postMessage({source:"ano-parent",type:"session:start",sessionId:l},"*")}catch{}}),o.on("session:end",async()=>{if(e.sessionState!=="active")return;let l=e.recordingManager?.isRecording(),i=e.sessionManager.stop();if(!i)return;l&&e.recordingManager.stopRecording(),e.setMode("navigate"),e.sessionState="ending",e.toolbar.renderIdle();for(let I of document.querySelectorAll("iframe"))try{I.contentWindow?.postMessage({source:"ano-parent",type:"session:end"},"*")}catch{}let d=null,A=null;l&&(d=await At(e.recordingManager),d&&(A=e.recordingManager.getBlobUrl()));let v=t.getAll().filter(I=>I.sessionId===i.sessionId&&I.type!=="session"),g=v.map(I=>I.id),C={type:"session",sessionId:i.sessionId,comment:"",duration:i.duration,actions:i.actions,pages:i.pages,context:{description:i.description},annotationIds:g,hasRecording:!!d};d&&(C.blob=d,C.blobUrl=A),t.add(C),e.endDialog.show({duration:i.duration,actionCount:i.actions.length,pageCount:i.pages.length,annotationCount:g.length,hasRecording:!!d,annotations:v})}),o.on("session:dismissed",()=>{e.sessionState="idle",e.currentSessionId=null,e.recordingManager&&e.recordingManager.clearBlob(),xe()}),o.on("session:action",l=>{e.toolbar.updateCount(l)}),o.on("session:resumed",l=>{e.sessionState="active",e.currentSessionId=l.sessionId,e.toolbar.renderActive(l.startTime)}),o.on("recording:stopped",l=>{if(e.sessionState==="ending"||e.sessionState==="idle"){let i=t.getByType("session");for(let d=i.length-1;d>=0;d--){let A=i[d];if(!A.blob&&A.hasRecording===!1&&l.blob){t.update(A.id,{blob:l.blob,blobUrl:l.blobUrl,hasRecording:!0});break}}}}),o.on("session:maxDuration",()=>{o.emit("session:end")}),o.on("highlight:created",l=>{let i=s.getMarksForAnnotation(l.id);if(i.length>0){let d=i[0].getBoundingClientRect();r.show(l.id,d)}}),o.on("pin:created",l=>{e.setMode("navigate");let i=document.querySelector(`[data-ano-id="${l.id}"]`);if(i){let d=i.getBoundingClientRect();r.show(l.id,d)}}),o.on("drawing:created",(l,i)=>{if(e.setMode("navigate"),i&&i.length>0){let d=i[i.length-1],A={x:d.x,y:d.y,top:d.y,left:d.x,bottom:d.y+1,right:d.x+1,width:1,height:1};r.show(l.id,A)}}),o.on("pin:click",l=>{let i=document.querySelector(`[data-ano-id="${l.id}"]`);if(i){let d=i.getBoundingClientRect();r.show(l.id,d)}}),o.on("annotation:focus",l=>{if(!l.frameUrl)if(l.type==="highlight"){let i=s.getMarksForAnnotation(l.id);if(i.length>0){i[0].scrollIntoView({behavior:"smooth",block:"center"});let d=i[0].getBoundingClientRect();setTimeout(()=>r.show(l.id,d),300)}}else l.type==="pin"&&(n.scrollToPin(l.id),setTimeout(()=>{let i=document.querySelector(`[data-ano-id="${l.id}"]`);if(i){let d=i.getBoundingClientRect();r.show(l.id,d)}},300))}),o.on("annotation:delete",l=>{let i=t.get(l);i&&(i.type==="highlight"?s.removeHighlight(l):i.type==="pin"?n.removePin(l):i.type==="drawing"?a.removeDrawing(l):i.type==="recording"&&e.recordingManager?e.recordingManager.removeRecording(l):i.type==="session"&&e.sessionManager.removeSession(l),t.remove(l))}),o.on("export",()=>{be(t,ae())}),o.on("export:json",()=>{Ge(t,ae())}),o.on("export:video",()=>{Qe(t)}),o.on("import",()=>{ye(e)}),o.on("share",()=>{nt(t,ae(),o)});function p(l){let i=l.target.closest?.(".ano-highlight");if(i&&i.dataset.anoId){l.stopPropagation();let d=i.getBoundingClientRect();r.show(i.dataset.anoId,d);return}if(e.mode==="navigate"){let d=a.hitTest(l.clientX,l.clientY);if(d){l.stopPropagation();let A={x:l.clientX,y:l.clientY,top:l.clientY,left:l.clientX,bottom:l.clientY+1,right:l.clientX+1,width:1,height:1};r.show(d.id,A)}}}document.addEventListener("click",p,!0),e._cleanupHighlightClick=()=>{document.removeEventListener("click",p,!0)}}var V=null;function Ot(e={}){return V=rt(e),V}function Dt(){V&&V.clear()}function Bt(){it(),V=null}function Ut(){return V?V.getAll():[]}function Pt(){return V?V.toJSON():null}function zt(){if(V)return V.export()}function Ht(){if(V)return V.importFile()}function jt(e){if(V)return V.import(e)}function Ft(e){V&&V.setMode(e)}function _t(){V&&V.startSession()}function Xt(){V&&V.endSession()}return ft(Yt);})();
