var Ano=(()=>{var ue=Object.defineProperty;var ot=Object.getOwnPropertyDescriptor;var rt=Object.getOwnPropertyNames;var it=Object.prototype.hasOwnProperty;var at=(e,t)=>{for(var n in t)ue(e,n,{get:t[n],enumerable:!0})},st=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of rt(t))!it.call(e,o)&&o!==n&&ue(e,o,{get:()=>t[o],enumerable:!(r=ot(t,o))||r.enumerable});return e};var lt=e=>st(ue({},"__esModule",{value:!0}),e);var jt={};at(jt,{clear:()=>Lt,destroy:()=>Rt,endSession:()=>Ht,export:()=>Dt,getAll:()=>It,import:()=>Pt,importFile:()=>Bt,init:()=>At,setMode:()=>zt,startSession:()=>Ut,toJSON:()=>Ot});var ct={theme:"light",mode:"navigate",highlightColor:"#fde047",pinColor:"#3b82f6",drawColor:"#ef4444",drawWidth:3,shortcuts:!0,recordMaxDuration:3e4,recordFrameRate:30,sessionMaxDuration:3e5,videoRecording:!1};function be(e={}){return{...ct,...e}}function se(){let e=new Map;return{on(t,n){return e.has(t)||e.set(t,new Set),e.get(t).add(n),()=>e.get(t)?.delete(n)},off(t,n){e.get(t)?.delete(n)},emit(t,n){e.get(t)?.forEach(r=>r(n))},clear(){e.clear()}}}var ve="abcdefghijklmnopqrstuvwxyz0123456789";function xe(){let e="",t=crypto.getRandomValues(new Uint8Array(8));for(let n=0;n<8;n++)e+=ve[t[n]%ve.length];return e}function ye(){let e=new Map,t=se(),n=0;function r(y){let h=y.id||xe(),v={...y,id:h,createdAt:y.createdAt||Date.now()};return v.type==="pin"&&v.index==null&&(n++,v.index=n),e.set(h,v),t.emit("add",v),t.emit("change",{type:"add",annotation:v}),v}function o(y,h){let v=e.get(y);if(!v)return null;let L={...v,...h,id:y};return e.set(y,L),t.emit("update",L),t.emit("change",{type:"update",annotation:L}),L}function i(y){let h=e.get(y);return h?(e.delete(y),t.emit("remove",h),t.emit("change",{type:"remove",annotation:h}),!0):!1}function a(y){return e.get(y)||null}function f(){return Array.from(e.values())}function l(y){return f().filter(h=>h.type===y)}function s(){let y=f();e.clear(),n=0,t.emit("clear",y),t.emit("change",{type:"clear",annotations:y})}function c(){let y=l("pin");n=y.length>0?Math.max(...y.map(h=>h.index)):0}return{add:r,update:o,remove:i,get:a,getAll:f,getByType:l,clear:s,resetPinCounter:c,on:t.on,off:t.off,emit:t.emit,destroy:t.clear}}function we(e){let t=e.toString();if(!t)return null;let n=document.body,r=n.textContent||"",o=document.createRange();o.setStart(n,0),o.setEnd(e.startContainer,e.startOffset);let i=o.toString(),a=Math.max(0,i.length-32),f=i.slice(a),l=document.createRange();l.setStart(e.endContainer,e.endOffset),l.setEnd(n,n.childNodes.length);let c=l.toString().slice(0,32);return{type:"TextQuoteSelector",exact:t,prefix:f,suffix:c}}function ke(e){if(!e||!e.exact)return null;let n=document.body.textContent||"",{exact:r,prefix:o,suffix:i}=e,a=[],f=0;for(;;){let c=n.indexOf(r,f);if(c===-1)break;a.push(c),f=c+1}if(a.length===0)return null;let l=a[0],s=-1;for(let c of a){let y=0;if(o){let h=n.slice(Math.max(0,c-o.length),c);h===o?y+=2:h.endsWith(o.slice(-8))&&(y+=1)}if(i){let h=n.slice(c+r.length,c+r.length+i.length);h===i?y+=2:h.startsWith(i.slice(0,8))&&(y+=1)}y>s&&(s=y,l=c)}return dt(l,l+r.length)}function dt(e,t){let n=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT),r=0,o=null,i=0,a=null,f=0;for(;n.nextNode();){let l=n.currentNode,s=l.textContent.length;if(!o&&r+s>e&&(o=l,i=e-r),r+s>=t){a=l,f=t-r;break}r+=s}if(!o||!a)return null;try{let l=document.createRange();return l.setStart(o,i),l.setEnd(a,f),l}catch{return null}}function Se(e){let t=document.body,n=document.createRange();n.setStart(t,0),n.setEnd(e.startContainer,e.startOffset);let r=n.toString().length,o=r+e.toString().length;return{type:"TextPositionSelector",start:r,end:o}}function Ce(e){if(!e||e.start==null||e.end==null)return null;let{start:t,end:n}=e,r=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT),o=0,i=null,a=0,f=null,l=0;for(;r.nextNode();){let s=r.currentNode,c=s.textContent.length;if(!i&&o+c>t&&(i=s,a=t-o),o+c>=n){f=s,l=n-o;break}o+=c}if(!i||!f)return null;try{let s=document.createRange();return s.setStart(i,a),s.setEnd(f,l),s}catch{return null}}function q(e){if(e.id){let o=`#${CSS.escape(e.id)}`;if(Te(o))return o}let t=[],n=e;for(;n&&n!==document.body&&n!==document.documentElement;){let o=n.tagName.toLowerCase();if(n.id){o=`#${CSS.escape(n.id)}`,t.unshift(o);break}let i=n.parentElement;if(i){let a=Array.from(i.children).filter(f=>f.tagName===n.tagName);if(a.length>1){let f=a.indexOf(n)+1;o+=`:nth-of-type(${f})`}}t.unshift(o),n=i}t[0]&&!t[0].startsWith("#")&&t.unshift("body");let r=t.join(" > ");return Te(r),r}function Ee(e){return{tagName:e.tagName,textContent:(e.textContent||"").trim().slice(0,100),className:e.className||""}}function fe(e,t){try{let n=document.querySelector(e);if(n)return n}catch{}if(t){let n=document.querySelectorAll(t.tagName?.toLowerCase()||"*");for(let r of n)if((r.textContent||"").trim().slice(0,100)===t.textContent)return r}return null}function Te(e){try{return document.querySelectorAll(e).length===1}catch{return!1}}function Me(e){if(!e)return null;if(e.textPosition){let t=Ce(e.textPosition);if(t&&pt(t,e.textQuote?.exact))return t}if(e.textQuote){let t=ke(e.textQuote);if(t)return t}return null}function pt(e,t){return t?e.toString()===t:!0}function $e(e){let{store:t,config:n}=e,r=!1,o=new Map;function i(){r||(r=!0,document.addEventListener("mouseup",f,!0))}function a(){r=!1,document.removeEventListener("mouseup",f,!0)}function f(d){if(Ne(d.target))return;let k=window.getSelection();if(!k||k.isCollapsed||!k.rangeCount)return;let x=k.getRangeAt(0),w=x.toString().trim();if(!w)return;let N={textQuote:we(x),textPosition:Se(x)},P=L(x,w),g=l(x);if(g.length===0)return;let m=t.add({type:"highlight",text:w,comment:"",selectors:N,context:P,color:n.highlightColor});o.set(m.id,g),g.forEach(S=>{S.dataset.anoId=m.id}),k.removeAllRanges(),e.events.emit("highlight:created",m)}function l(d){let k=[],x=s(d);if(x.length===0)return k;for(let w=0;w<x.length;w++){let N=x[w],P=0,g=N.textContent.length;if(w===0&&(P=N===d.startContainer?d.startOffset:0),w===x.length-1&&(g=N===d.endContainer?d.endOffset:N.textContent.length),P===g)continue;let m=N;P>0&&(m=N.splitText(P),g-=P),g<m.textContent.length&&m.splitText(g);let S=document.createElement("mark");S.className="ano-highlight",m.parentNode.insertBefore(S,m),S.appendChild(m),k.push(S)}return k}function s(d){let k=[],x=document.createTreeWalker(d.commonAncestorContainer.nodeType===Node.TEXT_NODE?d.commonAncestorContainer.parentNode:d.commonAncestorContainer,NodeFilter.SHOW_TEXT),w=!1;for(;x.nextNode();){let N=x.currentNode;if((N===d.startContainer||d.startContainer.nodeType!==Node.TEXT_NODE&&d.startContainer.contains(N))&&(w=!0),w&&!Ne(N.parentNode)&&k.push(N),N===d.endContainer||d.endContainer.nodeType!==Node.TEXT_NODE&&d.endContainer.contains(N))break}return k}function c(d){if(o.has(d.id))return!0;let k=Me(d.selectors);if(!k)return!1;let x=l(k);return x.length===0?!1:(o.set(d.id,x),x.forEach(w=>{w.dataset.anoId=d.id,d.color&&w.style.setProperty("--ano-hl-color",d.color)}),!0)}function y(d){let k=o.get(d);if(k){for(let x of k){let w=x.parentNode;if(w){for(;x.firstChild;)w.insertBefore(x.firstChild,x);w.removeChild(x),w.normalize()}}o.delete(d)}}function h(){for(let d of[...o.keys()])y(d)}function v(d){return o.get(d)||[]}function L(d,k){let x=d.commonAncestorContainer;x.nodeType===Node.TEXT_NODE&&(x=x.parentElement);let w=C(x),N={selector:q(w),tagName:w.tagName,text:B(O(w),200)},P=[],g=w;for(;g&&g!==document.body;){let b=g.tagName.toLowerCase(),$=g.id?`#${g.id}`:"",R=g.getAttribute("role")||"",A=b+$;R&&(A+=`[role=${R}]`),P.unshift(A),g=g.parentElement}let m=w.textContent||"",S=m.indexOf(k),Y="";if(S!==-1){let b=m.slice(Math.max(0,S-80),S).trim(),$=m.slice(S+k.length,S+k.length+80).trim();Y=(b?"..."+b+" ":"")+"["+B(k,100)+"]"+($?" "+$+"...":"")}return{element:N,pagePath:P,surroundingText:Y}}function C(d){let k=new Set(["P","H1","H2","H3","H4","H5","H6","LI","TD","TH","BLOCKQUOTE","FIGCAPTION","CAPTION","LABEL","A","BUTTON","ARTICLE","SECTION","NAV","HEADER","FOOTER","MAIN","ASIDE","DETAILS","SUMMARY"]),x=d;for(;x&&x!==document.body;){if(k.has(x.tagName)||x.id||x.getAttribute("role"))return x;x=x.parentElement}return d}function O(d){if(d.children.length===0)return(d.textContent||"").trim();let k="";for(let x of d.childNodes)if(x.nodeType===Node.TEXT_NODE)k+=x.textContent;else if(x.nodeType===Node.ELEMENT_NODE){let w=getComputedStyle(x).display;(w==="inline"||w==="inline-block")&&(k+=x.textContent)}return k.trim()||(d.textContent||"").trim().slice(0,200)}function B(d,k){return d.length>k?d.slice(0,k)+"...":d}function T(){a(),h()}return{enable:i,disable:a,applyHighlight:c,removeHighlight:y,removeAll:h,getMarksForAnnotation:v,destroy:T}}function Ne(e){if(!e)return!1;if(e.closest&&e.closest("[data-ano]"))return!0;let t=e;for(;t;){if(t.host&&t.host.dataset&&t.host.dataset.ano!==void 0||t.dataset&&t.dataset.ano!==void 0)return!0;t=t.parentNode}return!1}function Le(e){let{store:t,config:n}=e,r=!1,o=new Map,i=null,a=null;function f(){r||(r=!0,s(),document.addEventListener("mousemove",h,!0))}function l(){r=!1,c(),document.removeEventListener("mousemove",h,!0)}function s(){a=document.createElement("div"),a.className="ano-pin-overlay active",a.dataset.ano="",a.addEventListener("click",v,!0),a.addEventListener("mousemove",y),document.body.appendChild(a),i=document.createElement("div"),i.className="ano-pin-hover-outline",i.dataset.ano="",document.body.appendChild(i)}function c(){a&&(a.removeEventListener("click",v,!0),a.removeEventListener("mousemove",y),a.remove(),a=null),i&&(i.remove(),i=null)}function y(g){a.style.pointerEvents="none";let m=document.elementFromPoint(g.clientX,g.clientY);if(a.style.pointerEvents="auto",m&&m!==document.body&&m!==document.documentElement&&!Ae(m)){let S=m.getBoundingClientRect();i.style.display="block",i.style.left=`${S.left+window.scrollX}px`,i.style.top=`${S.top+window.scrollY}px`,i.style.width=`${S.width}px`,i.style.height=`${S.height}px`}else i.style.display="none"}function h(){}function v(g){g.preventDefault(),g.stopPropagation(),a.style.pointerEvents="none";let m=document.elementFromPoint(g.clientX,g.clientY);if(a.style.pointerEvents="auto",!m||m===document.body||m===document.documentElement||Ae(m))return;let S=q(m),Y=Ee(m),b=x(m),$=t.add({type:"pin",comment:"",targetSelector:S,targetMeta:Y,context:b});L($,m),e.events.emit("pin:created",$)}function L(g,m){let S=document.createElement("div");S.className="ano-pin-marker",S.dataset.ano="",S.dataset.anoId=g.id,S.textContent=g.index,S.style.setProperty("--ano-pin-color",n.pinColor),document.body.appendChild(S),C(S,m),o.set(g.id,{marker:S,target:m}),S.addEventListener("click",Y=>{Y.stopPropagation(),e.events.emit("pin:click",g)})}function C(g,m){let S=m.getBoundingClientRect();g.style.left=`${S.left+window.scrollX-12}px`,g.style.top=`${S.top+window.scrollY-12}px`}function O(){for(let[g,{marker:m,target:S}]of o)document.body.contains(S)&&C(m,S)}function B(g){if(o.has(g.id))return!0;let m=fe(g.targetSelector,g.targetMeta);return m?(L(g,m),!0):!1}function T(g){let m=o.get(g);m&&(m.marker.remove(),o.delete(g))}function d(){for(let[g]of[...o])T(g)}function k(g){let m=o.get(g);m&&m.target.scrollIntoView({behavior:"smooth",block:"center"})}function x(g){let m=g.tagName.toLowerCase(),S={},Y=["href","src","action","type","name","placeholder","value","alt","title","role","aria-label","aria-describedby","data-testid","for","method"];for(let H of Y){let U=g.getAttribute(H);U&&(S[H]=U.length>120?U.slice(0,120)+"...":U)}let b=w(g),$=[],R=g;for(;R&&R!==document.body;){let H=R.tagName.toLowerCase();if(R.id)H+=`#${R.id}`;else if(R.className&&typeof R.className=="string"){let U=R.className.trim().split(/\s+/).slice(0,2).join(".");U&&(H+=`.${U}`)}R.getAttribute("role")&&(H+=`[role=${R.getAttribute("role")}]`),$.unshift(H),R=R.parentElement}let A=[],I=g.parentElement;if(I)for(let H of I.children){if(H===g)continue;let U=H.tagName.toLowerCase(),_=N((H.textContent||"").trim(),60);if(_&&A.push(`${U}("${_}")`),A.length>=4)break}let z=`${m}`;b&&(z+=`("${N(b,80)}")`),S.type&&(z+=`[type=${S.type}]`),S.href&&(z+=`[href=${N(S.href,60)}]`),S.role&&(z+=`[role=${S.role}]`);let W=I?I.tagName.toLowerCase():"";return W&&(z+=` inside ${W}`),I?.id&&(z+=`#${I.id}`),{description:z,attributes:Object.keys(S).length>0?S:void 0,visibleText:b||void 0,pagePath:$,siblings:A.length>0?A:void 0}}function w(g){let m=g.getAttribute("aria-label");if(m)return m.trim();let S=g.getAttribute("alt");if(S)return S.trim();let Y=g.getAttribute("title");if(Y)return Y.trim();let b="";for(let $ of g.childNodes)$.nodeType===Node.TEXT_NODE&&(b+=$.textContent);return b=b.trim(),b||(g.textContent||"").trim().slice(0,150)}function N(g,m){return g.length>m?g.slice(0,m)+"...":g}function P(){l(),d()}return{enable:f,disable:l,applyPin:B,removePin:T,removeAll:d,repositionAll:O,scrollToPin:k,destroy:P}}function Ae(e){if(!e)return!1;let t=e;for(;t;){if(t.dataset&&t.dataset.ano!==void 0||t.host&&t.host.dataset&&t.host.dataset.ano!==void 0)return!0;t=t.parentNode}return!1}var Re={light:{"--ano-bg":"#ffffff","--ano-bg-secondary":"#f8fafc","--ano-bg-hover":"#f1f5f9","--ano-border":"#e2e8f0","--ano-text":"#1e293b","--ano-text-secondary":"#64748b","--ano-accent":"#3b82f6","--ano-accent-hover":"#2563eb","--ano-highlight":"#fde047","--ano-pin":"#3b82f6","--ano-draw":"#ef4444","--ano-danger":"#ef4444","--ano-danger-hover":"#dc2626","--ano-shadow":"0 4px 24px rgba(0,0,0,0.12)","--ano-shadow-sm":"0 2px 8px rgba(0,0,0,0.08)"},dark:{"--ano-bg":"#1e293b","--ano-bg-secondary":"#0f172a","--ano-bg-hover":"#334155","--ano-border":"#475569","--ano-text":"#f1f5f9","--ano-text-secondary":"#94a3b8","--ano-accent":"#60a5fa","--ano-accent-hover":"#3b82f6","--ano-highlight":"#fbbf24","--ano-pin":"#60a5fa","--ano-draw":"#f87171","--ano-danger":"#f87171","--ano-danger-hover":"#ef4444","--ano-shadow":"0 4px 24px rgba(0,0,0,0.4)","--ano-shadow-sm":"0 2px 8px rgba(0,0,0,0.3)"}};var Ie=`
  :host {
    all: initial;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  .ano-toolbar {
    position: fixed;
    top: 12px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 2px;
    padding: 4px;
    background: var(--ano-bg);
    border: 1px solid var(--ano-border);
    border-radius: 10px;
    box-shadow: var(--ano-shadow);
    z-index: 2147483646;
    user-select: none;
  }
  .ano-toolbar-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    border-radius: 8px;
    border: none;
    background: transparent;
    color: var(--ano-text-secondary);
    cursor: pointer;
    transition: all 0.15s;
    font-size: 18px;
    position: relative;
  }
  .ano-toolbar-btn:hover {
    background: var(--ano-bg-hover);
    color: var(--ano-text);
  }
  .ano-toolbar-btn.active {
    background: var(--ano-accent);
    color: #fff;
  }
  .ano-toolbar-btn .tooltip {
    position: absolute;
    bottom: -30px;
    left: 50%;
    transform: translateX(-50%);
    padding: 3px 8px;
    background: var(--ano-text);
    color: var(--ano-bg);
    font-size: 11px;
    border-radius: 4px;
    white-space: nowrap;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.15s;
  }
  .ano-toolbar-btn:hover .tooltip {
    opacity: 1;
  }
  .ano-toolbar-divider {
    width: 1px;
    margin: 6px 3px;
    background: var(--ano-border);
    flex-shrink: 0;
  }
  .ano-start-session {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 6px 14px;
    border-radius: 8px;
    border: none;
    background: var(--ano-accent);
    color: #fff;
    cursor: pointer;
    transition: all 0.15s;
    font-size: 13px;
    font-weight: 600;
    font-family: inherit;
    white-space: nowrap;
  }
  .ano-start-session:hover {
    background: var(--ano-accent-hover);
  }
  .ano-video-toggle {
    display: flex;
    align-items: center;
    gap: 5px;
    padding: 0 8px;
    font-size: 12px;
    color: var(--ano-text-secondary);
    cursor: pointer;
    user-select: none;
    white-space: nowrap;
  }
  .ano-video-toggle input {
    margin: 0;
    cursor: pointer;
  }
  .ano-session-status {
    display: flex;
    align-items: center;
    gap: 8px;
  }
  @keyframes ano-pulse-dot { 0%,100%{opacity:1} 50%{opacity:.3} }
  .ano-session-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: #22c55e;
    animation: ano-pulse-dot 1s ease-in-out infinite;
    flex-shrink: 0;
  }
  .ano-session-timer {
    font-size: 13px;
    font-weight: 600;
    font-variant-numeric: tabular-nums;
    color: var(--ano-text);
    min-width: 36px;
  }
  .ano-session-count {
    font-size: 12px;
    color: var(--ano-text-secondary);
    white-space: nowrap;
  }
  .ano-end-session {
    display: flex;
    align-items: center;
    gap: 5px;
    padding: 5px 12px;
    border-radius: 8px;
    border: none;
    background: var(--ano-danger);
    color: #fff;
    cursor: pointer;
    transition: all 0.15s;
    font-size: 12px;
    font-weight: 600;
    font-family: inherit;
    white-space: nowrap;
  }
  .ano-end-session:hover {
    background: var(--ano-danger-hover);
  }
  .ano-btn-label {
    font-family: inherit;
  }
`,Oe=`
  :host {
    all: initial;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    font-size: 14px;
    color: var(--ano-text);
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  .ano-popover {
    position: fixed;
    width: 280px;
    background: var(--ano-bg);
    border: 1px solid var(--ano-border);
    border-radius: 10px;
    box-shadow: var(--ano-shadow);
    z-index: 2147483647;
    overflow: hidden;
  }
  .ano-popover-body {
    padding: 12px;
  }
  .ano-popover textarea {
    width: 100%;
    min-height: 60px;
    padding: 8px;
    border: 1px solid var(--ano-border);
    border-radius: 6px;
    background: var(--ano-bg-secondary);
    color: var(--ano-text);
    font-family: inherit;
    font-size: 13px;
    resize: vertical;
    outline: none;
    transition: border-color 0.15s;
  }
  .ano-popover textarea:focus {
    border-color: var(--ano-accent);
  }
  .ano-popover-actions {
    display: flex;
    justify-content: flex-end;
    gap: 6px;
    padding: 8px 12px;
    border-top: 1px solid var(--ano-border);
    background: var(--ano-bg-secondary);
  }
  .ano-popover-btn {
    padding: 5px 12px;
    border-radius: 6px;
    border: 1px solid var(--ano-border);
    background: var(--ano-bg);
    color: var(--ano-text);
    font-size: 12px;
    cursor: pointer;
    transition: all 0.15s;
  }
  .ano-popover-btn:hover {
    background: var(--ano-bg-hover);
  }
  .ano-popover-btn.save {
    background: var(--ano-accent);
    color: #fff;
    border-color: var(--ano-accent);
  }
  .ano-popover-btn.save:hover {
    background: var(--ano-accent-hover);
  }
  .ano-popover-btn.delete {
    color: var(--ano-danger);
    border-color: var(--ano-danger);
  }
  .ano-popover-btn.delete:hover {
    background: var(--ano-danger);
    color: #fff;
  }
  .ano-popover-arrow {
    position: absolute;
    width: 12px;
    height: 12px;
    background: var(--ano-bg);
    border: 1px solid var(--ano-border);
    transform: rotate(45deg);
  }
  .ano-popover-arrow.top {
    bottom: -7px;
    border-top: none;
    border-left: none;
  }
  .ano-popover-arrow.bottom {
    top: -7px;
    border-bottom: none;
    border-right: none;
  }
`,De=`
  :host {
    all: initial;
  }
  .ano-canvas-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    z-index: 2147483645;
    pointer-events: none;
  }
  .ano-canvas-overlay.active {
    pointer-events: auto;
    cursor: crosshair;
  }
`,ut=`
  .ano-highlight {
    background-color: var(--ano-hl-color, #fde047);
    cursor: pointer;
    border-radius: 2px;
    transition: background-color 0.15s;
  }
  .ano-highlight:hover {
    filter: brightness(0.9);
  }
`,ft=`
  .ano-pin-marker {
    position: absolute;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: var(--ano-pin-color, #3b82f6);
    color: #fff;
    font-size: 12px;
    font-weight: 700;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 2147483644;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    transition: transform 0.15s;
    pointer-events: auto;
    user-select: none;
  }
  .ano-pin-marker:hover {
    transform: scale(1.2);
  }
  .ano-pin-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    z-index: 2147483643;
    pointer-events: none;
  }
  .ano-pin-overlay.active {
    pointer-events: auto;
    cursor: crosshair;
  }
  .ano-pin-hover-outline {
    position: absolute;
    border: 2px dashed #3b82f6;
    background: rgba(59, 130, 246, 0.08);
    border-radius: 3px;
    pointer-events: none;
    z-index: 2147483643;
    transition: all 0.1s;
  }
`,Be=`
  :host {
    all: initial;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    font-size: 14px;
    color: var(--ano-text);
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  .ano-end-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0,0,0,0.4);
    z-index: 2147483647;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .ano-end-dialog {
    background: var(--ano-bg);
    border: 1px solid var(--ano-border);
    border-radius: 14px;
    box-shadow: var(--ano-shadow);
    width: 400px;
    max-width: 90vw;
    overflow: hidden;
  }
  .ano-end-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px 20px;
    border-bottom: 1px solid var(--ano-border);
  }
  .ano-end-header h2 {
    font-size: 16px;
    font-weight: 700;
    color: var(--ano-text);
  }
  .ano-end-close {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 28px;
    height: 28px;
    border-radius: 6px;
    border: none;
    background: transparent;
    color: var(--ano-text-secondary);
    cursor: pointer;
    transition: all 0.15s;
    font-size: 18px;
  }
  .ano-end-close:hover {
    background: var(--ano-bg-hover);
    color: var(--ano-text);
  }
  .ano-end-summary {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    padding: 20px;
  }
  .ano-end-stat {
    padding: 12px;
    border-radius: 10px;
    background: var(--ano-bg-secondary);
    border: 1px solid var(--ano-border);
    text-align: center;
  }
  .ano-end-stat-value {
    font-size: 22px;
    font-weight: 700;
    color: var(--ano-text);
    font-variant-numeric: tabular-nums;
  }
  .ano-end-stat-label {
    font-size: 11px;
    color: var(--ano-text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-top: 2px;
  }
  .ano-end-badge {
    grid-column: 1 / -1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    padding: 8px;
    border-radius: 8px;
    background: var(--ano-bg-secondary);
    border: 1px solid var(--ano-border);
    font-size: 12px;
    color: var(--ano-text-secondary);
  }
  .ano-end-actions {
    display: flex;
    gap: 8px;
    padding: 16px 20px;
    border-top: 1px solid var(--ano-border);
    justify-content: flex-end;
  }
  .ano-end-actions button {
    padding: 7px 16px;
    border-radius: 8px;
    border: 1px solid var(--ano-border);
    background: var(--ano-bg);
    color: var(--ano-text);
    font-size: 13px;
    font-family: inherit;
    cursor: pointer;
    transition: all 0.15s;
  }
  .ano-end-actions button:hover {
    background: var(--ano-bg-hover);
  }
  .ano-end-actions button.primary {
    background: var(--ano-accent);
    color: #fff;
    border-color: var(--ano-accent);
  }
  .ano-end-actions button.primary:hover {
    background: var(--ano-accent-hover);
  }
  .ano-end-annotations {
    padding: 0 20px 16px;
  }
  .ano-end-annotations h3 {
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--ano-text-secondary);
    margin-bottom: 8px;
  }
  .ano-end-ann-list {
    max-height: 280px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 6px;
  }
  .ano-end-ann-card {
    padding: 8px 10px;
    border: 1px solid var(--ano-border);
    border-radius: 8px;
    background: var(--ano-bg-secondary);
  }
  .ano-end-ann-type {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 3px;
  }
  .ano-end-ann-type .dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    flex-shrink: 0;
  }
  .ano-end-ann-type.highlight { color: #ca8a04; }
  .ano-end-ann-type.highlight .dot { background: var(--ano-highlight); }
  .ano-end-ann-type.pin { color: var(--ano-pin); }
  .ano-end-ann-type.pin .dot { background: var(--ano-pin); }
  .ano-end-ann-type.drawing { color: var(--ano-draw); }
  .ano-end-ann-type.drawing .dot { background: var(--ano-draw); }
  .ano-end-ann-text {
    font-size: 13px;
    color: var(--ano-text);
    line-height: 1.4;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
  }
  .ano-end-ann-comment {
    font-size: 12px;
    color: var(--ano-text-secondary);
    font-style: italic;
    line-height: 1.4;
    margin-top: 2px;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
  }
`;function Pe(){let e="ano-host-styles";if(document.getElementById(e))return;let t=document.createElement("style");t.id=e,t.textContent=ut+ft,document.head.appendChild(t)}function ze(){document.getElementById("ano-host-styles")?.remove()}function ee(e,t){let n=Re[t]||Re.light;for(let[r,o]of Object.entries(n))e.style.setProperty(r,o)}function Ue(e){let{store:t,config:n}=e,r=null,o=null,i=null,a=null,f=!1,l=!1,s=null,c=new Set;function y(){if(r)return;r=document.createElement("div"),r.dataset.ano="",o=r.attachShadow({mode:"open"});let b=document.createElement("style");b.textContent=De,o.appendChild(b),i=document.createElement("canvas"),i.className="ano-canvas-overlay",o.appendChild(i),document.body.appendChild(r),h(),window.addEventListener("resize",h),window.addEventListener("scroll",N)}function h(){if(!i)return;let b=window.devicePixelRatio||1;i.width=window.innerWidth*b,i.height=window.innerHeight*b,i.style.width=window.innerWidth+"px",i.style.height=window.innerHeight+"px",a=i.getContext("2d"),a.scale(b,b),N()}function v(){f||(y(),f=!0,i.classList.add("active"),i.addEventListener("pointerdown",C),i.addEventListener("pointermove",O),i.addEventListener("pointerup",B),i.addEventListener("pointerleave",B))}function L(){f=!1,i&&(i.classList.remove("active"),i.removeEventListener("pointerdown",C),i.removeEventListener("pointermove",O),i.removeEventListener("pointerup",B),i.removeEventListener("pointerleave",B)),l&&d()}function C(b){b.button===0&&(l=!0,i.setPointerCapture(b.pointerId),s={points:[{x:b.clientX,y:b.clientY}],color:n.drawColor,width:n.drawWidth},a.beginPath(),a.strokeStyle=s.color,a.lineWidth=s.width,a.lineCap="round",a.lineJoin="round",a.moveTo(b.clientX,b.clientY))}function O(b){!l||!s||(s.points.push({x:b.clientX,y:b.clientY}),a.lineTo(b.clientX,b.clientY),a.stroke(),a.beginPath(),a.moveTo(b.clientX,b.clientY))}function B(){l&&d()}function T(b){let $=b.points,R=1/0,A=1/0,I=-1/0,z=-1/0;for(let K of $)K.x<R&&(R=K.x),K.y<A&&(A=K.y),K.x>I&&(I=K.x),K.y>z&&(z=K.y);let W=(R+I)/2,H=(A+z)/2,U=r.style.pointerEvents;r.style.pointerEvents="none";let _=document.elementFromPoint(W,H);if(r.style.pointerEvents=U,!_||_===document.documentElement)return null;let Q=_.getBoundingClientRect();return Q.width<1||Q.height<1?null:{selector:q(_),rect:{x:Q.x,y:Q.y,width:Q.width,height:Q.height}}}function d(){if(l=!1,!s||s.points.length<2){s=null;return}let b=k(s),$=T(s),R;if($){let{rect:I}=$,z=s.points.map(W=>({x:(W.x-I.x)/I.width,y:(W.y-I.y)/I.height}));R=[{...s,points:z}]}else R=[s];let A=t.add({type:"drawing",comment:"",strokes:R,context:b,anchor:$,viewport:{scrollX:window.scrollX,scrollY:window.scrollY,width:window.innerWidth,height:window.innerHeight}});c.add(A.id),s=null,e.events.emit("drawing:created",A)}function k(b){let $=b.points,R=1/0,A=1/0,I=-1/0,z=-1/0;for(let X of $)X.x<R&&(R=X.x),X.y<A&&(A=X.y),X.x>I&&(I=X.x),X.y>z&&(z=X.y);let W={x:Math.round(R+window.scrollX),y:Math.round(A+window.scrollY),width:Math.round(I-R),height:Math.round(z-A)},H=r.style.pointerEvents;r.style.pointerEvents="none";let U=new Set,_=[],Q=Math.min($.length,20),K=Math.max(1,Math.floor($.length/Q));for(let X=0;X<$.length;X+=K){let u=$[X],p=document.elementFromPoint(u.x,u.y);if(!p||p===document.body||p===document.documentElement||p.dataset?.ano!==void 0)continue;let M=q(p);if(U.has(M))continue;U.add(M);let D=x(p);_.push({selector:M,tagName:p.tagName,text:D,role:p.getAttribute("role")||void 0,ariaLabel:p.getAttribute("aria-label")||void 0})}r.style.pointerEvents=H;let ae=_.map(X=>{let u=X.tagName.toLowerCase();return X.text?`${u}("${w(X.text,60)}")`:u}),pe=ae.length>0?`Drawing over: ${ae.join(", ")}`:"Drawing on empty area";return{boundingBox:W,elements:_,description:pe}}function x(b){let $=b.getAttribute("aria-label");if($)return $.trim();let R=b.getAttribute("alt");if(R)return R.trim();let A="";for(let z of b.childNodes)z.nodeType===Node.TEXT_NODE&&(A+=z.textContent);return A=A.trim(),A||(b.textContent||"").trim().slice(0,120)}function w(b,$){return b.length>$?b.slice(0,$)+"...":b}function N(){if(!a)return;a.clearRect(0,0,i.width,i.height);let b=t.getByType("drawing");for(let $ of b)P($)}function P(b){if(!a||!b.strokes)return;let{anchor:$,viewport:R}=b,A=null;if($)try{let I=document.querySelector($.selector);I&&(A=I.getBoundingClientRect())}catch{}for(let I of b.strokes)if(!(I.points.length<2)){if(a.beginPath(),a.strokeStyle=I.color,a.lineCap="round",a.lineJoin="round",A){let z=A.width/$.rect.width,W=A.height/$.rect.height;a.lineWidth=I.width*Math.min(z,W);let H=I.points[0];a.moveTo(H.x*A.width+A.x,H.y*A.height+A.y);for(let U=1;U<I.points.length;U++){let _=I.points[U];a.lineTo(_.x*A.width+A.x,_.y*A.height+A.y)}}else{let z=R?window.scrollX-R.scrollX:0,W=R?window.scrollY-R.scrollY:0;a.lineWidth=I.width;let H=I.points[0];a.moveTo(H.x-z,H.y-W);for(let U=1;U<I.points.length;U++){let _=I.points[U];a.lineTo(_.x-z,_.y-W)}}a.stroke()}}function g(b){return c.add(b.id),N(),!0}function m(b){c.delete(b),N()}function S(){c.clear(),a&&a.clearRect(0,0,i.width,i.height)}function Y(){L(),S(),window.removeEventListener("resize",h),window.removeEventListener("scroll",N),r&&(r.remove(),r=null,o=null,i=null,a=null)}return{init:y,enable:v,disable:L,applyDrawing:g,removeDrawing:m,removeAll:S,redrawAll:N,destroy:Y}}var le=!!navigator.mediaDevices?.getDisplayMedia&&!!window.MediaRecorder&&typeof MediaRecorder.isTypeSupported=="function"&&MediaRecorder.isTypeSupported("video/webm")&&!!window.BroadcastChannel,gt=`<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"><title>Ano Recording</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;font-size:13px;background:#1e293b;color:#f1f5f9;display:flex;align-items:center;justify-content:center;min-height:100vh;padding:12px}
.wrap{display:flex;align-items:center;gap:10px}
.dot{width:10px;height:10px;border-radius:50%;background:#ef4444;animation:p 1s ease-in-out infinite;flex-shrink:0}
@keyframes p{0%,100%{opacity:1}50%{opacity:.3}}
.timer{font-weight:600;font-variant-numeric:tabular-nums;font-size:15px;min-width:44px}
button{padding:5px 14px;border-radius:6px;border:1px solid rgba(255,255,255,.25);background:transparent;color:#fff;cursor:pointer;font-size:13px;transition:background .15s}
button:hover{background:rgba(255,255,255,.12)}
#start{background:#ef4444;border-color:#ef4444;font-weight:600;padding:8px 20px;font-size:14px}
#start:hover{background:#dc2626}
.msg{color:#94a3b8;font-size:12px;text-align:center}
</style></head><body>
<div id="app"><button id="start">Share Tab &amp; Record</button></div>
<script>
var ch=new BroadcastChannel('ano-recording');
var rec,chunks=[],startTime=0,stream,timerIv;
ch.onmessage=function(e){
if(e.data.type==='stop')doStop();
if(e.data.type==='ping'&&rec&&rec.state==='recording')ch.postMessage({type:'pong',startTime:startTime});
};
document.getElementById('start').onclick=function(){startCapture()};
function startCapture(){
navigator.mediaDevices.getDisplayMedia({video:{frameRate:30}}).then(function(s){
stream=s;
var mime='video/webm';
if(typeof MediaRecorder.isTypeSupported==='function'&&MediaRecorder.isTypeSupported('video/webm;codecs=vp9'))mime='video/webm;codecs=vp9';
rec=new MediaRecorder(stream,{mimeType:mime});
chunks=[];
rec.ondataavailable=function(e){if(e.data.size>0)chunks.push(e.data)};
rec.onstop=onStop;
rec.start(500);
startTime=Date.now();
stream.getVideoTracks()[0].onended=function(){doStop()};
document.getElementById('app').innerHTML='<div class="wrap"><span class="dot"></span><span class="timer" id="t">0:00</span><button id="stopbtn">Stop</button></div>';
document.getElementById('stopbtn').onclick=function(){doStop()};
timerIv=setInterval(function(){
var sec=Math.floor((Date.now()-startTime)/1000);
var el=document.getElementById('t');
if(el)el.textContent=Math.floor(sec/60)+':'+(sec%60).toString().padStart(2,'0');
},250);
ch.postMessage({type:'started',startTime:startTime});
}).catch(function(){
ch.postMessage({type:'cancelled'});
try{window.close()}catch(e){}
});
}
function doStop(){if(!rec||rec.state==='inactive')return;rec.stop()}
function onStop(){
clearInterval(timerIv);
if(stream)stream.getTracks().forEach(function(t){t.stop()});
var blob=new Blob(chunks,{type:'video/webm'});
var duration=Date.now()-startTime;
ch.postMessage({type:'stopped',duration:duration,blob:blob});
document.getElementById('app').innerHTML='<div class="msg">Recording saved. Closing\\u2026</div>';
setTimeout(function(){try{window.close()}catch(e){}},2000);
}
window.onbeforeunload=function(){if(rec&&rec.state==='recording')doStop()};
<\/script></body></html>`;function He(e){let t=new BroadcastChannel("ano-recording"),n=!1,r=null,o=0,i=null,a=null,f=0;t.onmessage=T=>{let{data:d}=T;d.type==="started"?(n=!0,o=d.startTime,e.events.emit("recording:started")):d.type==="stopped"?h(d):d.type==="pong"?n||(n=!0,o=d.startTime):d.type==="cancelled"&&e.events.emit("recording:cancelled")};function l(){n||y()}function s(){t.postMessage({type:"stop"})}function c(){return n}function y(){if(r=window.open("","ano-recorder","width=460,height=600,top=60,left=60"),!r){console.warn("[Ano] Popup blocked \u2014 allow popups for screen recording."),e.events.emit("recording:cancelled");return}r.document.open(),r.document.write(gt),r.document.close()}function h(T){n=!1,T.blob&&(i=T.blob,a=URL.createObjectURL(T.blob),f=T.duration||0),e.events.emit("recording:stopped",{blob:i,blobUrl:a,duration:f}),r=null}function v(){return i}function L(){return a}function C(){a&&URL.revokeObjectURL(a),i=null,a=null,f=0}function O(T){let d=e.store.get(T);d&&d.blobUrl&&URL.revokeObjectURL(d.blobUrl)}function B(){n&&s(),C();try{t.close()}catch{}let T=e.store.getByType("recording");for(let d of T)d.blobUrl&&URL.revokeObjectURL(d.blobUrl)}return setTimeout(()=>t.postMessage({type:"ping"}),100),{startRecording:l,stopRecording:s,isRecording:c,getBlob:v,getBlobUrl:L,clearBlob:C,removeRecording:O,destroy:B}}var ge="ano-session",ht=/password|cc-|cvv|ssn|secret|token/i,mt=0;function bt(){return"ses_"+Date.now().toString(36)+(mt++).toString(36)+Math.random().toString(36).slice(2,6)}function je(e){let t=!1,n=null,r=0,o=[],i=[],a=null,f=new WeakMap,l=0,s=null,c={},y=["log","warn","error","info"];function h(u){if(!u)return"unknown";let p=u.tagName.toLowerCase();if(p==="button"||p==="input"&&u.type==="submit"){let D=u.textContent?.trim()||u.value||"";return D?`button("${G(D,40)}")`:"button"}if(p==="a"){let D=u.textContent?.trim()||"";return D?`link("${G(D,40)}")`:`link(${u.href||""})`}if(p==="input")return`input[name="${u.name||u.id||u.type}"]`;if(p==="textarea")return`textarea[name="${u.name||u.id||"textarea"}"]`;if(p==="select"){let D=u.name||u.id||"select";return`select${D!=="select"?`[name="${D}"]`:""}`}if(p==="label"){let D=u.textContent?.trim()||"";return D?`label("${G(D,40)}")`:"label"}if(p==="img")return`img(${u.alt||u.src?.split("/").pop()||""})`;let M=u.textContent?.trim();if(M&&M.length<60&&u.children.length===0)return`${p}("${G(M,40)}")`;if(u.id)return`${p}#${u.id}`;if(u.className&&typeof u.className=="string"){let D=u.className.split(/\s+/).filter(Boolean).slice(0,2).join(".");if(D)return`${p}.${D}`}return p}function v(u){if(u.type==="password")return!0;let p=u.autocomplete||"";return ht.test(p)}function L(u){if(!u)return!1;if(u.closest?.("[data-ano]"))return!0;let p=u;for(;p;){if(p.host&&p.host.dataset&&p.host.dataset.ano!==void 0)return!0;p=p.parentNode}return!1}function C(u,p,M,D,Z){let J={time:Date.now()-r,action:u,target:p||null,selector:M||null,value:D??null,url:Z||window.location.href};o.push(J),b(),e.events.emit("session:action",o.length)}function O(u){if(L(u.target))return;let p=u.target,M=null;try{M=q(p)}catch{}C("click",h(p),M,null)}function B(u){if(L(u.target))return;let p=u.target,M=f.get(p);M&&clearTimeout(M);let D=setTimeout(()=>{f.delete(p);let Z=v(p)?"[redacted]":p.value,J=null;try{J=q(p)}catch{}C("type",h(p),J,Z)},500);f.set(p,D)}function T(u){if(L(u.target))return;let p=u.target,M=p.tagName.toLowerCase(),D=p.type?.toLowerCase();if(M==="select"){let Z=p.options?.[p.selectedIndex]?.text||p.value,J=null;try{J=q(p)}catch{}C("select",h(p),J,Z)}else if(D==="checkbox"||D==="radio"){let Z=p.checked?"checked":"unchecked",J=null;try{J=q(p)}catch{}C("check",h(p),J,Z)}}function d(){s||(s=setTimeout(()=>{s=null;let u=window.scrollY;Math.abs(u-l)<100||(l=u,C("scroll",null,null,`y=${Math.round(u)}`))},300))}function k(u){if(L(u.target))return;let p=u.target,M=null;try{M=q(p)}catch{}C("submit",h(p),M,null)}function x(u){let p=u.message||"Unknown error",M=u.filename?` at ${u.filename}:${u.lineno}:${u.colno}`:"";C("error",null,null,`${p}${M}`)}function w(u){let p=u.reason,M;if(p instanceof Error)M=`${p.name}: ${p.message}`;else try{M=JSON.stringify(p)}catch{M=String(p)}C("error","unhandledrejection",null,G(M,300))}function N(){P(),Y()}function P(){a&&(clearTimeout(a),a=null)}function g(){for(let u of y)c[u]=console[u],console[u]=(...p)=>{if(c[u].apply(console,p),typeof p[0]=="string"&&p[0].startsWith("[Ano]"))return;let M=S(p);C(`console.${u}`,null,null,M)}}function m(){for(let u of y)c[u]&&(console[u]=c[u],delete c[u])}function S(u){let p=u.map(M=>{if(M===null)return"null";if(M===void 0)return"undefined";if(typeof M=="string")return M;if(typeof M=="number"||typeof M=="boolean")return String(M);if(M instanceof Error)return`${M.name}: ${M.message}`;try{let D=JSON.stringify(M);return D.length>200?D.slice(0,200)+"...":D}catch{return String(M)}});return G(p.join(" "),500)}function Y(){if(t)try{sessionStorage.setItem(ge,JSON.stringify({active:!0,sessionId:n,startTime:r,actions:o,pages:i}))}catch{}}function b(){a&&clearTimeout(a),a=setTimeout(Y,200)}function $(){try{sessionStorage.removeItem(ge)}catch{}}function R(){document.addEventListener("click",O,!0),document.addEventListener("input",B,!0),document.addEventListener("change",T,!0),document.addEventListener("scroll",d,{capture:!0,passive:!0}),document.addEventListener("submit",k,!0),window.addEventListener("beforeunload",N),window.addEventListener("error",x),window.addEventListener("unhandledrejection",w)}function A(){document.removeEventListener("click",O,!0),document.removeEventListener("input",B,!0),document.removeEventListener("change",T,!0),document.removeEventListener("scroll",d,{capture:!0}),document.removeEventListener("submit",k,!0),window.removeEventListener("beforeunload",N),window.removeEventListener("error",x),window.removeEventListener("unhandledrejection",w)}function I(){return t=!0,n=bt(),r=Date.now(),o=[],i=[window.location.href],l=window.scrollY,Y(),R(),g(),n}function z(u){t=!0,n=u.sessionId,r=u.startTime,o=u.actions||[],i=u.pages||[],l=window.scrollY;let p=window.location.href;i.includes(p)||i.push(p),C("navigate",document.title,null,p,p),R(),g()}function W(){if(!t)return null;t=!1,P(),A(),m(),$(),s&&(clearTimeout(s),s=null);let u=Date.now()-r,p=H(u,o,i),M={sessionId:n,duration:u,actions:o.slice(),pages:i.slice(),description:p},D=n;return o=[],i=[],r=0,n=null,M}function H(u,p,M){let Z=[`Session (${Math.round(u/1e3)}s, ${p.length} actions, ${M.length} pages):`];for(let J=0;J<p.length;J++){let F=p[J],nt=(F.time/1e3).toFixed(1),V;switch(F.action){case"click":V=`Clicked ${F.target}`;break;case"type":V=`Typed "${G(F.value||"",40)}" in ${F.target}`;break;case"select":V=`Selected "${F.value}" in ${F.target}`;break;case"check":V=`${F.value==="checked"?"Checked":"Unchecked"} ${F.target}`;break;case"scroll":V=`Scrolled to ${F.value}`;break;case"submit":V=`Submitted ${F.target}`;break;case"navigate":V=`Navigated to ${F.value}`;break;case"console.log":V=`console.log: ${G(F.value||"",80)}`;break;case"console.warn":V=`console.warn: ${G(F.value||"",80)}`;break;case"console.error":V=`console.error: ${G(F.value||"",80)}`;break;case"console.info":V=`console.info: ${G(F.value||"",80)}`;break;case"error":V=`ERROR: ${G(F.value||"",80)}`;break;default:V=`${F.action} ${F.target||""}`}Z.push(`${J+1}. [${nt}s] ${V}`)}return Z.join(`
`)}function U(){return t}function _(){return n}function Q(){return r}function K(){return o.length}function ae(u){}function pe(){t&&(t=!1,A(),m(),$(),s&&(clearTimeout(s),s=null),a&&(clearTimeout(a),a=null)),o=[],i=[],n=null}function X(){try{let u=sessionStorage.getItem(ge);if(!u)return;let p=JSON.parse(u);p&&p.active&&(z(p),e.events.emit("session:resumed",{sessionId:p.sessionId,startTime:p.startTime}))}catch{}}return setTimeout(X,50),{start:I,stop:W,isActive:U,getSessionId:_,getStartTime:Q,getActionCount:K,checkResume:X,removeSession:ae,destroy:pe}}function G(e,t){return e?e.length>t?e.slice(0,t)+"...":e:""}function E(e,t={},...n){let r=document.createElement(e);for(let[o,i]of Object.entries(t))o==="className"?r.className=i:o==="style"&&typeof i=="object"?Object.assign(r.style,i):o.startsWith("on")&&typeof i=="function"?r.addEventListener(o.slice(2).toLowerCase(),i):o==="html"?r.innerHTML=i:r.setAttribute(o,i);for(let o of n)o!=null&&(typeof o=="string"?r.appendChild(document.createTextNode(o)):r.appendChild(o));return r}function te(e){let t={highlight:'<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>',pin:'<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>',draw:'<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 19l7-7 3 3-7 7-3-3z"/><path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/><path d="M2 2l7.586 7.586"/></svg>',navigate:'<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 11l19-9-9 19-2-8-8-2z"/></svg>',close:'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>',download:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>',upload:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>',trash:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>',chevron:'<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>',record:'<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="4" fill="currentColor" stroke="none"/></svg>',stop:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="6" y="6" width="12" height="12" rx="1" fill="currentColor" stroke="none"/></svg>',session:'<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>',annotation:'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>',link:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>'},n=document.createElement("span");return n.innerHTML=t[e]||"",n.style.display="inline-flex",n.style.alignItems="center",n}var vt=[{id:"highlight",label:"Highlight",icon:"highlight",shortcut:"Alt+H"},{id:"pin",label:"Pin",icon:"pin",shortcut:"Alt+P"},{id:"draw",label:"Draw",icon:"draw",shortcut:"Alt+D"},{id:"navigate",label:"Navigate",icon:"navigate",shortcut:"Alt+N"}];function _e(e){let t=null,n=null,r=null,o={},i=null,a=null,f=null,l=null;function s(){t=document.createElement("div"),t.dataset.ano="",n=t.attachShadow({mode:"open"});let T=document.createElement("style");T.textContent=Ie,n.appendChild(T),ee(t,e.config.theme),r=E("div",{className:"ano-toolbar"}),n.appendChild(r),document.body.appendChild(t),c()}function c(){C(),o={},r.innerHTML="";let T=E("button",{className:"ano-start-session",onClick:()=>e.events.emit("session:start")},te("session"),E("span",{className:"ano-btn-label"},"Start Session"));if(r.appendChild(T),le){let d=E("label",{className:"ano-video-toggle"});l=document.createElement("input"),l.type="checkbox",l.checked=e.config.videoRecording,d.appendChild(l),d.appendChild(te("record")),d.appendChild(document.createTextNode("Video")),r.appendChild(d)}}function y(T){C(),o={},r.innerHTML="";for(let w of vt){let N=E("button",{className:"ano-toolbar-btn",title:w.label,onClick:()=>e.setMode(w.id)},te(w.icon),E("span",{className:"tooltip"},`${w.label} (${w.shortcut})`));o[w.id]=N,r.appendChild(N)}r.appendChild(E("div",{className:"ano-toolbar-divider"}));let d=E("div",{className:"ano-session-status"});d.appendChild(E("span",{className:"ano-session-dot"})),i=E("span",{className:"ano-session-timer"},"0:00"),d.appendChild(i),a=E("span",{className:"ano-session-count"},"(0)"),d.appendChild(a);let k=E("button",{className:"ano-end-session",onClick:()=>e.events.emit("session:end")},te("stop"),E("span",{className:"ano-btn-label"},"End"));d.appendChild(k),r.appendChild(d);let x=()=>{if(!i)return;let w=Date.now()-T,N=Math.floor(w/1e3),P=Math.floor(N/60),g=N%60;i.textContent=`${P}:${g.toString().padStart(2,"0")}`};x(),f=setInterval(x,250)}function h(T){a&&(a.textContent=`(${T})`)}function v(){return l?l.checked:!1}function L(T){for(let[d,k]of Object.entries(o))k.classList.toggle("active",d===T)}function C(){f&&(clearInterval(f),f=null),i=null,a=null}function O(T){t&&ee(t,T)}function B(){C(),t&&(t.remove(),t=null,n=null,r=null,o={},l=null)}return{render:s,renderIdle:c,renderActive:y,setActive:L,updateCount:h,getVideoToggleState:v,updateTheme:O,destroy:B}}function Xe(e){let{store:t}=e,n=null,r=null,o=null;function i(){if(n)return;n=document.createElement("div"),n.dataset.ano="",r=n.attachShadow({mode:"open"});let v=document.createElement("style");v.textContent=Oe,r.appendChild(v),ee(n,e.config.theme),document.body.appendChild(n)}function a(v,L){i(),l(),o=v;let C=t.get(v);if(!C)return;let O=E("div",{className:"ano-popover"}),B=E("div",{className:"ano-popover-body"}),T=E("textarea",{placeholder:"Add a comment..."});T.value=C.comment||"",B.appendChild(T),O.appendChild(B);let d=E("div",{className:"ano-popover-actions"}),k=E("button",{className:"ano-popover-btn delete",onClick:()=>{e.events.emit("annotation:delete",v),l()}},"Delete"),x=E("button",{className:"ano-popover-btn",onClick:()=>l()},"Cancel"),w=E("button",{className:"ano-popover-btn save",onClick:()=>{t.update(v,{comment:T.value}),l()}},"Save");d.appendChild(k),d.appendChild(x),d.appendChild(w),O.appendChild(d);let N=E("div",{className:"ano-popover-arrow"});O.appendChild(N),r.appendChild(O),requestAnimationFrame(()=>{f(O,N,L),T.focus()}),T.addEventListener("keydown",P=>{P.key==="Enter"&&(P.metaKey||P.ctrlKey)&&(t.update(v,{comment:T.value}),l()),P.key==="Escape"&&l(),P.stopPropagation()})}function f(v,L,C){let O=v.getBoundingClientRect(),B=window.innerWidth,T=window.innerHeight,d,k,x="top";d=C.bottom+8,d+O.height>T&&(d=C.top-O.height-8,x="bottom"),k=C.left+C.width/2-O.width/2,k=Math.max(8,Math.min(k,B-O.width-8)),v.style.top=`${d}px`,v.style.left=`${k}px`,L.className=`ano-popover-arrow ${x}`;let w=C.left+C.width/2-k-6;L.style.left=`${Math.max(12,Math.min(w,O.width-24))}px`}function l(){if(!r)return;let v=r.querySelector(".ano-popover");v&&v.remove(),o=null}function s(){return o!==null}function c(){return o}function y(v){n&&ee(n,v)}function h(){l(),n&&(n.remove(),n=null,r=null)}return{init:i,show:a,hide:l,isOpen:s,getCurrentId:c,updateTheme:y,destroy:h}}function Fe(e){let t=null,n=null;function r(h){s(),t=document.createElement("div"),t.dataset.ano="",n=t.attachShadow({mode:"open"});let v=document.createElement("style");v.textContent=Be,n.appendChild(v),ee(t,e.config.theme);let L=E("div",{className:"ano-end-overlay"});L.addEventListener("click",w=>{w.target===L&&l()});let C=E("div",{className:"ano-end-dialog"}),O=E("button",{className:"ano-end-close",onClick:()=>l()});O.appendChild(te("close")),C.appendChild(E("div",{className:"ano-end-header"},E("h2",{},"Session Complete"),O));let B=E("div",{className:"ano-end-summary"});if(B.appendChild(o(f(h.duration),"Duration")),B.appendChild(o(String(h.actionCount),"Actions")),B.appendChild(o(String(h.pageCount),"Pages")),B.appendChild(o(String(h.annotationCount),"Annotations")),h.hasRecording){let w=E("div",{className:"ano-end-badge"});w.appendChild(te("record")),w.appendChild(document.createTextNode("Video recorded")),B.appendChild(w)}if(C.appendChild(B),h.annotations&&h.annotations.length>0){let w=E("div",{className:"ano-end-annotations"});w.appendChild(E("h3",{},"Annotations"));let N=E("div",{className:"ano-end-ann-list"}),P=0;for(let g of h.annotations){if(g.type==="session"||g.type==="recording")continue;let m=E("div",{className:"ano-end-ann-card"});g.type==="highlight"?(m.appendChild(i("highlight","Highlight")),g.quote&&m.appendChild(E("div",{className:"ano-end-ann-text"},`"${a(g.quote,120)}"`))):g.type==="pin"?(P++,m.appendChild(i("pin",`Pin #${P}`)),g.target?.description&&m.appendChild(E("div",{className:"ano-end-ann-text"},g.target.description))):g.type==="drawing"&&m.appendChild(i("drawing","Drawing")),g.comment&&m.appendChild(E("div",{className:"ano-end-ann-comment"},g.comment)),N.appendChild(m)}w.appendChild(N),C.appendChild(w)}let T=E("div",{className:"ano-end-actions"}),d=E("button",{onClick:()=>l()},"Dismiss"),k=E("button",{onClick:()=>{e.events.emit("share"),l()}},"Get Link"),x=E("button",{className:"primary",onClick:()=>{e.events.emit("export"),l()}},"Export JSON");T.appendChild(d),T.appendChild(k),T.appendChild(x),C.appendChild(T),L.appendChild(C),n.appendChild(L),document.body.appendChild(t)}function o(h,v){return E("div",{className:"ano-end-stat"},E("div",{className:"ano-end-stat-value"},h),E("div",{className:"ano-end-stat-label"},v))}function i(h,v){let L=E("div",{className:`ano-end-ann-type ${h}`});return L.appendChild(E("span",{className:"dot"})),L.appendChild(document.createTextNode(v)),L}function a(h,v){return!h||h.length<=v?h||"":h.slice(0,v)+"\u2026"}function f(h){let v=Math.floor((h||0)/1e3),L=Math.floor(v/60),C=v%60;return`${L}:${C.toString().padStart(2,"0")}`}function l(){s(),e.events.emit("session:dismissed")}function s(){t&&(t.remove(),t=null,n=null)}function c(){return t!==null}function y(){s()}return{show:r,hide:s,dismiss:l,isOpen:c,destroy:y}}function Ye(e){let t=!1,n={"alt+h":()=>{e.sessionState==="active"&&e.setMode("highlight")},"alt+p":()=>{e.sessionState==="active"&&e.setMode("pin")},"alt+d":()=>{e.sessionState==="active"&&e.setMode("draw")},"alt+n":()=>{e.sessionState==="active"&&e.setMode("navigate")},"alt+s":()=>{e.sessionState==="idle"?e.events.emit("session:start"):e.sessionState==="active"&&e.events.emit("session:end")},"alt+e":()=>e.events.emit("export"),escape:()=>{e.popover.isOpen()?e.popover.hide():e.sessionState==="active"?e.events.emit("session:end"):e.endDialog&&e.endDialog.isOpen()&&e.endDialog.dismiss()}};function r(s){let c=s.target.tagName;if(c==="INPUT"||c==="TEXTAREA"||c==="SELECT"){if(s.key==="Escape"&&(s.target.closest?.("[data-ano]")||i(s.target))){n.escape();return}return}let y=o(s);n[y]&&(s.preventDefault(),s.stopPropagation(),n[y]())}function o(s){let c=[];return s.altKey&&c.push("alt"),s.ctrlKey&&c.push("ctrl"),s.metaKey&&c.push("meta"),s.shiftKey&&c.push("shift"),c.push(s.key.toLowerCase()),c.join("+")}function i(s){let c=s;for(;c;){if(c.host&&c.host.dataset&&c.host.dataset.ano!==void 0)return!0;c=c.parentNode}return!1}function a(){t||(t=!0,document.addEventListener("keydown",r,!0))}function f(){t=!1,document.removeEventListener("keydown",r,!0)}function l(){f()}return{enable:a,disable:f,destroy:l}}function he(e,t=[]){let n=oe(e,t),r=JSON.stringify(n,null,2),o=new Blob([r],{type:"application/json"}),i=URL.createObjectURL(o),a=document.createElement("a");a.href=i,a.download=`annotations-${wt()}.json`,a.style.display="none",document.body.appendChild(a),a.click(),setTimeout(()=>{URL.revokeObjectURL(i),a.remove()},100);let f=e.getByType("recording");for(let s of f)s.blob&&We(s.blob,`recording-${s.id}.webm`);let l=e.getByType("session");for(let s of l)s.blob&&We(s.blob,`session-${s.sessionId||s.id}.webm`);return n}function We(e,t){let n=URL.createObjectURL(e),r=document.createElement("a");r.href=n,r.download=t,r.style.display="none",document.body.appendChild(r),r.click(),setTimeout(()=>{URL.revokeObjectURL(n),r.remove()},100)}function oe(e,t=[]){let n=e.getAll().map(a=>{let f=Je(a);return f.pageUrl=f.pageUrl||window.location.href,f.pageTitle=f.pageTitle||document.title,f}),r=t.map(a=>{let f=Je(a);return f.pageUrl=f.pageUrl||a.pageUrl||"unknown",f.pageTitle=f.pageTitle||a.pageTitle||"",f}),o=new Set(n.map(a=>a.id)),i=[...n];for(let a of r)o.has(a.id)||(o.add(a.id),i.push(a));return i.sort((a,f)=>a.createdAt-f.createdAt),{version:"1.0",exportedAt:new Date().toISOString(),pageUrl:window.location.href,pageTitle:document.title,annotations:i,summary:xt(i)}}function Je(e){let t={};return t.id=e.id,t.type=e.type,t.comment=e.comment||"",t.createdAt=e.createdAt,e.type==="highlight"?(t.text=e.text,t.context=e.context||null,t._anchoring={selectors:e.selectors},e.color&&(t.color=e.color)):e.type==="pin"?(t.index=e.index,t.context=e.context||null,t._anchoring={targetSelector:e.targetSelector,targetMeta:e.targetMeta}):e.type==="drawing"?(t.context=e.context||null,t._anchoring={strokes:e.strokes,viewport:e.viewport}):e.type==="recording"?(t.duration=e.duration,t.region=e.region,t.context=e.context||null,t._anchoring={viewport:e.viewport,file:`recording-${e.id}.webm`}):e.type==="session"&&(t.duration=e.duration,t.pages=e.pages,t.context=e.context||null,t.sessionId=e.sessionId||null,t.annotationIds=e.annotationIds||[],t.hasRecording=e.hasRecording||!1,t._anchoring={actions:e.actions},e.blob&&(t._anchoring.file=`session-${e.sessionId||e.id}.webm`)),e.pageUrl&&(t.pageUrl=e.pageUrl),e.pageTitle&&(t.pageTitle=e.pageTitle),e._orphaned&&(t.orphaned=!0),t}function xt(e){let t=new Map;for(let r of e){let o=r.pageUrl||"unknown";t.has(o)||t.set(o,[]),t.get(o).push(r)}let n=[];for(let[r,o]of t){t.size>1&&n.push(`
--- ${r} ---`);for(let i of o){let a=i.comment?` \u2014 "${i.comment}"`:"";if(i.type==="highlight"){let f=i.context?.element?` in <${i.context.element.tagName?.toLowerCase()||"element"}>`:"",l=i.context?.pagePath?` (${i.context.pagePath.join(" > ")})`:"";n.push(`[Highlight] "${yt(i.text,80)}"${f}${l}${a}`)}else if(i.type==="pin"){let f=i.context?.description||`element #${i.index}`;n.push(`[Pin #${i.index}] ${f}${a}`)}else if(i.type==="drawing"){let f=i.context?.description||"freehand drawing";n.push(`[Drawing] ${f}${a}`)}else if(i.type==="recording"){let f=Math.round((i.duration||0)/1e3),l=i.context?.description||"screen recording";n.push(`[Recording ${f}s] ${l}${a}`)}else if(i.type==="session"){let f=Math.round((i.duration||0)/1e3),l=i.context?.description||"session recording";n.push(`[Session ${f}s] ${l}${a}`)}}}return n.join(`
`).trim()}function yt(e,t){return e?e.length>t?e.slice(0,t)+"...":e:""}function wt(){let e=new Date;return`${e.getFullYear()}-${ce(e.getMonth()+1)}-${ce(e.getDate())}_${ce(e.getHours())}${ce(e.getMinutes())}`}function ce(e){return e.toString().padStart(2,"0")}function me(e){return new Promise(t=>{let n=document.createElement("input");n.type="file",n.accept=".json",n.style.display="none",document.body.appendChild(n),n.addEventListener("change",async()=>{let r=n.files[0];if(!r){n.remove(),t({success:!1,error:"No file selected"});return}try{let o=await r.text(),i=JSON.parse(o),a=re(e,i);t(a)}catch(o){t({success:!1,error:o.message})}finally{n.remove()}}),n.click()})}function re(e,t){if(!t||!t.annotations||!Array.isArray(t.annotations))return{success:!1,error:"Invalid annotation data"};let{store:n,highlightManager:r,pinManager:o,drawingManager:i}=e,a={imported:0,orphaned:0,orphans:[]};for(let f of t.annotations){let l={...f};l._anchoring&&(Object.assign(l,l._anchoring),delete l._anchoring);let s=n.add(l),c=!1;s.type==="highlight"?c=r.applyHighlight(s):s.type==="pin"?c=o.applyPin(s):s.type==="drawing"?c=i.applyDrawing(s):(s.type==="recording"||s.type==="session")&&(c=!0),c?a.imported++:(a.orphaned++,a.orphans.push(s.id),n.update(s.id,{_orphaned:!0}))}return{success:!0,...a}}var Ve="https://share.mk/files/";async function qe(e,t,n){try{n.emit("share:uploading");let r=oe(e,t),o=JSON.stringify(r,null,2),i=new TextEncoder().encode(o),a=await fetch(Ve,{method:"POST",headers:{"Tus-Resumable":"1.0.0","Upload-Length":String(i.byteLength),"Upload-Metadata":[`filename ${btoa("annotations.json")}`,`content-type ${btoa("application/json")}`,`expires-in ${btoa("7d")}`].join(",")}});if(!a.ok)throw new Error(`Upload failed: ${a.status}`);let f=a.headers.get("Location");if(!f)throw new Error("No Location header in response");let l=f.startsWith("http")?f:new URL(f,Ve).href,s=await fetch(l,{method:"PATCH",headers:{"Tus-Resumable":"1.0.0","Upload-Offset":"0","Content-Type":"application/offset+octet-stream"},body:i});if(!s.ok)throw new Error(`Patch failed: ${s.status}`);try{await navigator.clipboard.writeText(l)}catch{}return n.emit("share:complete",l),l}catch(r){return n.emit("share:error",r),null}}var Ke="ano:",ne=null;function Ge(e={}){if(ne)return console.warn("[Ano] Already initialized. Call Ano.destroy() first."),ne.api;let t=be(e),n=ye(),r=se(),o={config:t,store:n,events:r,mode:"navigate",sessionState:"idle",currentSessionId:null,toolbar:null,popover:null,endDialog:null,highlightManager:null,pinManager:null,drawingManager:null,recordingManager:null,sessionManager:null,shortcutManager:null,setMode:null};o.highlightManager=$e(o),o.pinManager=Le(o),o.drawingManager=Ue(o),le&&(o.recordingManager=He(o)),o.sessionManager=je(o),o.toolbar=_e(o),o.popover=Xe(o),o.endDialog=Fe(o),o.shortcutManager=Ye(o),o.setMode=c=>{o.sessionState!=="active"&&c!=="navigate"||(et(o,o.mode),o.mode=c,St(o,c),o.toolbar.setActive(c))},Nt(o),Pe(),o.drawingManager.init(),o.toolbar.render(),o.popover.init(),t.shortcuts&&o.shortcutManager.enable(),Et(o);let i=null,a=n.on("change",()=>{i&&clearTimeout(i),i=setTimeout(()=>tt(n),500)});n.on("add",c=>{o.sessionState==="active"&&o.currentSessionId&&c.type!=="session"&&!c.sessionId&&n.update(c.id,{sessionId:o.currentSessionId})});let f=()=>o.pinManager.repositionAll();window.addEventListener("scroll",f,{passive:!0}),window.addEventListener("resize",f,{passive:!0});let l=new MutationObserver(c=>{for(let y of c)for(let h of y.removedNodes)if(h.classList?.contains("ano-highlight")&&h.dataset?.anoId){let v=h.dataset.anoId;n.get(v)&&n.update(v,{_orphaned:!0})}});l.observe(document.body,{childList:!0,subtree:!0});let s={getAll:()=>n.getAll(),toJSON:()=>oe(n,ie()),export:()=>he(n,ie()),importFile:()=>me(o),import:c=>re(o,c),setMode:c=>o.setMode(c),share:()=>r.emit("share"),clear:()=>kt(),destroy:()=>Ze(),startSession:()=>r.emit("session:start"),endSession:()=>r.emit("session:end")};return ne={ctx:o,api:s,repositionHandler:f,observer:l,unsubPersist:a,persistTimer:i},s}function Qe(){Ze()}function kt(){if(!ne)return;let{ctx:e}=ne,{store:t,highlightManager:n,pinManager:r,drawingManager:o,sessionManager:i}=e;for(let a of t.getAll())a.type==="highlight"?n.removeHighlight(a.id):a.type==="pin"?r.removePin(a.id):a.type==="drawing"?o.removeDrawing(a.id):a.type==="session"?i.removeSession(a.id):a.type==="recording"&&e.recordingManager&&e.recordingManager.removeRecording(a.id);t.clear(),Mt()}function Ze(){if(!ne)return;let{ctx:e,repositionHandler:t,observer:n,unsubPersist:r,persistTimer:o}=ne;r&&r(),o&&clearTimeout(o),n.disconnect(),window.removeEventListener("scroll",t),window.removeEventListener("resize",t),e.shortcutManager.destroy(),e.popover.destroy(),e.endDialog.destroy(),e.toolbar.destroy(),e.highlightManager.destroy(),e.pinManager.destroy(),e.drawingManager.destroy(),e.recordingManager&&e.recordingManager.destroy(),e.sessionManager.destroy(),e._cleanupHighlightClick&&e._cleanupHighlightClick(),tt(e.store),e.store.clear(),e.store.destroy(),e.events.clear(),ze(),ne=null}function St(e,t){switch(t){case"highlight":e.highlightManager.enable();break;case"pin":e.pinManager.enable();break;case"draw":e.drawingManager.enable();break;case"navigate":break}}function et(e,t){switch(t){case"highlight":e.highlightManager.disable();break;case"pin":e.pinManager.disable();break;case"draw":e.drawingManager.disable();break}}function Ct(e,t=5e3){return new Promise(n=>{let r=Date.now(),o=()=>{let i=e.getBlob();if(i){n(i);return}if(Date.now()-r>=t){n(null);return}setTimeout(o,100)};o()})}function de(){return Ke+location.pathname}function tt(e){try{let t=e.getAll().map(Tt);localStorage.setItem(de(),JSON.stringify(t))}catch{}}function Tt(e){let t={...e};return delete t.blob,delete t.blobUrl,delete t._marks,t.pageUrl||(t.pageUrl=window.location.href),t.pageTitle||(t.pageTitle=document.title),t}function ie(){let e=de(),t=[];try{for(let n=0;n<localStorage.length;n++){let r=localStorage.key(n);if(!r.startsWith(Ke)||r===e)continue;let o=localStorage.getItem(r);if(!o)continue;let i=JSON.parse(o);Array.isArray(i)&&t.push(...i)}}catch{}return t}function Et(e){try{let r=localStorage.getItem(de());if(r){let o=JSON.parse(r);Array.isArray(o)&&o.length>0&&re(e,{annotations:o})}}catch{}let n=ie().filter(r=>r.type==="session"||r.type==="recording");if(n.length>0){let r=new Set(e.store.getAll().map(i=>i.id)),o=n.filter(i=>!r.has(i.id));o.length>0&&re(e,{annotations:o})}}function Mt(){try{localStorage.removeItem(de())}catch{}}function Nt(e){let{store:t,events:n,popover:r,highlightManager:o,pinManager:i,drawingManager:a}=e;n.on("session:start",()=>{if(e.sessionState!=="idle")return;let l=e.sessionManager.start();e.sessionState="active",e.currentSessionId=l,e.toolbar.getVideoToggleState()&&e.recordingManager&&e.recordingManager.startRecording(),e.toolbar.renderActive(e.sessionManager.getStartTime()),e.setMode("navigate")}),n.on("session:end",async()=>{if(e.sessionState!=="active")return;let l=e.recordingManager?.isRecording(),s=e.sessionManager.stop();if(!s)return;l&&e.recordingManager.stopRecording(),et(e,e.mode),e.mode="navigate",e.sessionState="ending",e.toolbar.renderIdle();let c=null,y=null;l&&(c=await Ct(e.recordingManager),c&&(y=e.recordingManager.getBlobUrl()));let v=t.getAll().filter(O=>O.sessionId===s.sessionId&&O.type!=="session"),L=v.map(O=>O.id),C={type:"session",sessionId:s.sessionId,comment:"",duration:s.duration,actions:s.actions,pages:s.pages,context:{description:s.description},annotationIds:L,hasRecording:!!c};c&&(C.blob=c,C.blobUrl=y),t.add(C),e.endDialog.show({duration:s.duration,actionCount:s.actions.length,pageCount:s.pages.length,annotationCount:L.length,hasRecording:!!c,annotations:v})}),n.on("session:dismissed",()=>{e.sessionState="idle",e.currentSessionId=null,e.recordingManager&&e.recordingManager.clearBlob()}),n.on("session:action",l=>{e.toolbar.updateCount(l)}),n.on("session:resumed",l=>{e.sessionState="active",e.currentSessionId=l.sessionId,e.toolbar.renderActive(l.startTime)}),n.on("recording:stopped",l=>{if(e.sessionState==="ending"||e.sessionState==="idle"){let s=t.getByType("session");for(let c=s.length-1;c>=0;c--){let y=s[c];if(!y.blob&&y.hasRecording===!1&&l.blob){t.update(y.id,{blob:l.blob,blobUrl:l.blobUrl,hasRecording:!0});break}}}}),n.on("session:maxDuration",()=>{n.emit("session:end")}),n.on("highlight:created",l=>{let s=o.getMarksForAnnotation(l.id);if(s.length>0){let c=s[0].getBoundingClientRect();r.show(l.id,c)}}),n.on("pin:created",l=>{e.setMode("navigate");let s=document.querySelector(`[data-ano-id="${l.id}"]`);if(s){let c=s.getBoundingClientRect();r.show(l.id,c)}}),n.on("drawing:created",()=>{}),n.on("pin:click",l=>{let s=document.querySelector(`[data-ano-id="${l.id}"]`);if(s){let c=s.getBoundingClientRect();r.show(l.id,c)}}),n.on("annotation:focus",l=>{if(l.type==="highlight"){let s=o.getMarksForAnnotation(l.id);if(s.length>0){s[0].scrollIntoView({behavior:"smooth",block:"center"});let c=s[0].getBoundingClientRect();setTimeout(()=>r.show(l.id,c),300)}}else l.type==="pin"&&(i.scrollToPin(l.id),setTimeout(()=>{let s=document.querySelector(`[data-ano-id="${l.id}"]`);if(s){let c=s.getBoundingClientRect();r.show(l.id,c)}},300))}),n.on("annotation:delete",l=>{let s=t.get(l);s&&(s.type==="highlight"?o.removeHighlight(l):s.type==="pin"?i.removePin(l):s.type==="drawing"?a.removeDrawing(l):s.type==="recording"&&e.recordingManager?e.recordingManager.removeRecording(l):s.type==="session"&&e.sessionManager.removeSession(l),t.remove(l))}),n.on("export",()=>{he(t,ie())}),n.on("import",()=>{me(e)}),n.on("share",()=>{qe(t,ie(),n)});function f(l){let s=l.target.closest?.(".ano-highlight");if(s&&s.dataset.anoId){l.stopPropagation();let c=s.getBoundingClientRect();r.show(s.dataset.anoId,c)}}document.addEventListener("click",f,!0),e._cleanupHighlightClick=()=>{document.removeEventListener("click",f,!0)}}var j=null;function At(e={}){return j=Ge(e),j}function Lt(){j&&j.clear()}function Rt(){Qe(),j=null}function It(){return j?j.getAll():[]}function Ot(){return j?j.toJSON():null}function Dt(){if(j)return j.export()}function Bt(){if(j)return j.importFile()}function Pt(e){if(j)return j.import(e)}function zt(e){j&&j.setMode(e)}function Ut(){j&&j.startSession()}function Ht(){j&&j.endSession()}return lt(jt);})();
